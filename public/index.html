<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ouvidoria - Duque de Caxias - Dashboard</title>
    <link rel="icon" type="image/png" href="/dc-logo.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
      :root {
        --bg: #0b1020;
        --panel: #0f172a;
        --muted: #94a3b8;
        --primary: #22d3ee; /* cyan */
        --accent: #a78bfa;  /* violet */
        --success: #34d399; /* green */
        --danger: #fb7185;  /* rose */
      }
      body { background: radial-gradient(1200px 600px at top left, rgba(34,211,238,0.08), transparent 60%), radial-gradient(1200px 600px at bottom right, rgba(167,139,250,0.08), transparent 60%), var(--bg); }
      .glass { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.08); }
      .neon { text-shadow: 0 0 12px rgba(34,211,238,0.65), 0 0 24px rgba(167,139,250,0.45); }
      .glow-ring { box-shadow: 0 0 0 2px rgba(34,211,238,0.15), 0 0 32px rgba(34,211,238,0.25); }
      .skeleton { background: rgba(255,255,255,0.06); }
      canvas { max-height: 340px; }
      
      /* Estilos do menu lateral */
      nav[id="sideMenu"] div[data-page].active {
        background: linear-gradient(90deg, rgba(34,211,238,0.15) 0%, rgba(34,211,238,0.05) 100%);
        border-left: 3px solid #22d3ee;
        color: #22d3ee;
        font-weight: 600;
      }
      
      nav[id="sideMenu"] div[data-page]:hover:not(.active) {
        background: rgba(255,255,255,0.05);
      }
      
      nav[id="sideMenu"] .unit-category-header:hover {
        background: rgba(255,255,255,0.05);
      }
      
      nav[id="sideMenu"] .unit-category-header[data-category].expanded .unit-category-arrow {
        transform: rotate(90deg);
      }
      
      nav[id="sideMenu"] .unit-category-content[data-category-content] {
        animation: slideDown 0.2s ease-out;
      }
      
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      .animate-fade-in {
        animation: fadeIn 0.3s ease-out;
      }
      
      /* Estilos para elementos com filtro ativo */
      .filter-active {
        border-color: rgba(34, 211, 238, 0.6) !important;
        background: rgba(34, 211, 238, 0.1) !important;
        box-shadow: 0 0 20px rgba(34, 211, 238, 0.3) !important;
      }
      
      .filter-active-title {
        padding: 12px 20px;
        background: linear-gradient(90deg, rgba(34, 211, 238, 0.1), rgba(34, 211, 238, 0.05));
        border-left: 4px solid #22d3ee;
        border-radius: 8px;
        margin-bottom: 16px;
      }
      
      /* AnimaÃ§Ãµes removidas para melhor performance */
      .cora-avatar {
        position: relative;
      }
      .cora-avatar::before {
        content: '';
        position: absolute;
        inset: -10px;
        border-radius: 50%;
        background: linear-gradient(45deg, rgba(34,211,238,0.3), rgba(167,139,250,0.3));
        filter: blur(20px);
        z-index: -1;
      }
      .glow-text {
        text-shadow: 0 0 20px rgba(34,211,238,0.5), 0 0 40px rgba(167,139,250,0.3);
      }

      /* Scrollbar moderna global: preta e levemente deslocada para fora dos cards */
      :where(.overflow-y-auto, .overflow-auto, .overflow-y-scroll, .overflow-x-auto, .overflow-x-scroll) {
        padding-right: 12px;
        margin-right: -12px;
      }
      body { scrollbar-gutter: stable; }

      /* WebKit (Chrome, Safari, Edge) */
      :where(html, body, .overflow-y-auto, .overflow-auto, .overflow-y-scroll, .overflow-x-auto, .overflow-x-scroll)::-webkit-scrollbar {
        width: 12px;
        height: 12px;
      }
      :where(html, body, .overflow-y-auto, .overflow-auto, .overflow-y-scroll, .overflow-x-auto, .overflow-x-scroll)::-webkit-scrollbar-track {
        background: transparent;
      }
      :where(html, body, .overflow-y-auto, .overflow-auto, .overflow-y-scroll, .overflow-x-auto, .overflow-x-scroll)::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #0a0a0a, #1a1a1a);
        border-radius: 10px;
        border: 2px solid transparent;
        background-clip: padding-box;
      }
      :where(html, body, .overflow-y-auto, .overflow-auto, .overflow-y-scroll, .overflow-x-auto, .overflow-x-scroll)::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #111, #222);
      }

      /* Firefox */
      :where(html, body, .overflow-y-auto, .overflow-auto, .overflow-y-scroll, .overflow-x-auto, .overflow-x-scroll) {
        scrollbar-width: thin;
        scrollbar-color: #000000 transparent;
      }
    </style>
  </head>
  <body class="text-slate-100">
    <div class="min-h-screen grid grid-cols-12 gap-6 p-6">
      <aside class="col-span-12 lg:col-span-3 xl:col-span-2 glass rounded-2xl p-5 ">
        <div class="flex items-center gap-3 mb-6">
          <img src="/dc-logo.png" alt="Duque de Caxias" class="h-12 w-auto object-contain" />
          <div>
            <div class="text-lg font-semibold">Ouvidoria Caxias</div>
            <div class="text-xs text-slate-400">Dashboard Futurista</div>
          </div>
        </div>
        <nav id="sideMenu" class="space-y-3 text-sm">
          <!-- ğŸ  SEÃ‡ÃƒO: INÃCIO -->
          <div class="space-y-1">
            <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider px-3 mb-2">ğŸ  InÃ­cio</div>
            <div data-page="home" class="active px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ  Home</div>
            <div data-page="main" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ“Š VisÃ£o Geral</div>
            <a href="/chat" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer block transition-colors">ğŸ’¬ Cora - Chat</a>
          </div>
          
          <!-- ğŸ“Š SEÃ‡ÃƒO: ANÃLISES PRINCIPAIS -->
          <div class="space-y-1 pt-2 border-t border-white/10">
            <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider px-3 mb-2">ğŸ“Š AnÃ¡lises Principais</div>
            <div data-page="orgao-mes" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ¢ Por Ã“rgÃ£o e MÃªs</div>
            <div data-page="tempo-medio" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">â±ï¸ Tempo MÃ©dio</div>
            <div data-page="tema" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ“‘ Por Tema</div>
            <div data-page="assunto" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ“ Por Assunto</div>
            <div data-page="cadastrante" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ‘¤ Por Cadastrante</div>
            <div data-page="reclamacoes" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸš¨ ReclamaÃ§Ãµes e DenÃºncias</div>
            <div data-page="projecao-2026" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ“ˆ ProjeÃ§Ã£o 2026</div>
          </div>
          
          <!-- ğŸ¥ SEÃ‡ÃƒO: UNIDADES DE SAÃšDE -->
          <div class="space-y-1 pt-2 border-t border-white/10">
            <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider px-3 mb-2">ğŸ¥ Unidades de SaÃºde</div>
            
            <!-- Hospitais -->
            <div class="mb-1">
              <div class="unit-category-header text-xs text-slate-300 px-3 py-1.5 font-medium hover:bg-white/5 rounded-lg cursor-pointer flex items-center justify-between transition-colors" data-category="hospitais">
                <span>ğŸ¥ Hospitais</span>
                <span class="unit-category-arrow transition-transform duration-200 text-slate-500">â–¶</span>
              </div>
              <div class="unit-category-content pl-2 space-y-0.5 mt-1" data-category-content="hospitais" style="display: none;">
                <div data-page="unit-hospital-olho" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">Hospital do Olho</div>
                <div data-page="unit-hospital-duque" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">Hospital Duque</div>
                <div data-page="unit-hospital-infantil" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">Hospital Infantil</div>
                <div data-page="unit-hospital-moacyr" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">Hospital Moacyr</div>
                <div data-page="unit-hospital-veterinario" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">Hospital VeterinÃ¡rio</div>
                <div data-page="unit-maternidade-santa-cruz" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">Maternidade Santa Cruz</div>
              </div>
            </div>
            
            <!-- UPH -->
            <div class="mb-1">
              <div class="unit-category-header text-xs text-slate-300 px-3 py-1.5 font-medium hover:bg-white/5 rounded-lg cursor-pointer flex items-center justify-between transition-colors" data-category="uph">
                <span>ğŸ¥ UPH</span>
                <span class="unit-category-arrow transition-transform duration-200 text-slate-500">â–¶</span>
              </div>
              <div class="unit-category-content pl-2 space-y-0.5 mt-1" data-category-content="uph" style="display: none;">
                <div data-page="unit-uph-pilar" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPH Pilar</div>
                <div data-page="unit-uph-saracuruna" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPH Saracuruna</div>
                <div data-page="unit-uph-xerem" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPH XerÃ©m</div>
                <div data-page="unit-uph-campos-eliseos" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPH Campos ElÃ­seos</div>
                <div data-page="unit-uph-parque-equitativa" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPH Parque Equitativa</div>
                <div data-page="unit-uph-imbarie" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPH ImbariÃª</div>
              </div>
            </div>
            
            <!-- UPA -->
            <div class="mb-1">
              <div class="unit-category-header text-xs text-slate-300 px-3 py-1.5 font-medium hover:bg-white/5 rounded-lg cursor-pointer flex items-center justify-between transition-colors" data-category="upa">
                <span>ğŸš‘ UPA</span>
                <span class="unit-category-arrow transition-transform duration-200 text-slate-500">â–¶</span>
              </div>
              <div class="unit-category-content pl-2 space-y-0.5 mt-1" data-category-content="upa" style="display: none;">
                <div data-page="unit-upa-beira-mar" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPA Beira Mar</div>
                <div data-page="unit-upa-walter-garcia" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPA Walter Garcia</div>
                <div data-page="unit-upa-sarapui" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UPA SarapuÃ­</div>
              </div>
            </div>
            
            <!-- Outros -->
            <div class="mb-1">
              <div class="unit-category-header text-xs text-slate-300 px-3 py-1.5 font-medium hover:bg-white/5 rounded-lg cursor-pointer flex items-center justify-between transition-colors" data-category="outros">
                <span>ğŸ“ Outros</span>
                <span class="unit-category-arrow transition-transform duration-200 text-slate-500">â–¶</span>
              </div>
              <div class="unit-category-content pl-2 space-y-0.5 mt-1" data-category-content="outros" style="display: none;">
                <div data-page="unit-adao" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">Hospital AdÃ£o</div>
                <div data-page="unit-cer-iv" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">CER IV</div>
                <div data-page="unit-ubs-antonio-granja" class="px-3 py-1.5 rounded-lg hover:bg-white/5 cursor-pointer text-xs transition-colors">UBS Antonio Granja</div>
              </div>
            </div>
          </div>
          
          <!-- ğŸ“ˆ SEÃ‡ÃƒO: RELATÃ“RIOS POR DIMENSÃƒO -->
          <div class="space-y-1 pt-2 border-t border-white/10">
            <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider px-3 mb-2">ğŸ“ˆ RelatÃ³rios por DimensÃ£o</div>
            <div data-page="secretaria" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ›ï¸ Secretarias</div>
            <div data-page="secretarias-distritos" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ—ºï¸ Secretarias e Distritos</div>
            <div data-page="tipo" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ“‹ Tipos de ManifestaÃ§Ã£o</div>
            <div data-page="status" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ“Š Status</div>
            <div data-page="categoria" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ“‚ Tema</div>
            <div data-page="setor" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ¢ Unidade de Cadastro</div>
            <div data-page="responsavel" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ‘¥ ResponsÃ¡veis</div>
            <div data-page="canal" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">ğŸ“¡ Canais</div>
            <div data-page="prioridade" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">âš¡ Prioridades</div>
          </div>
        </nav>
        <div class="mt-8 pt-6 border-t border-white/10">
          <div class="text-xs font-semibold text-slate-300 mb-4 uppercase tracking-wider">Equipe ResponsÃ¡vel</div>
          <div class="space-y-3 text-xs">
            <div class="pb-2 border-b border-white/5">
              <div class="text-slate-400 mb-1">Ouvidoria Geral</div>
              <div class="text-slate-200 font-medium">Edrisio Avelino</div>
              <div class="text-slate-500 text-[10px] mt-0.5">Ouvidor Geral</div>
            </div>
            <div class="space-y-2">
              <div>
                <div class="text-slate-200 font-medium">Nilton Quaresma</div>
                <div class="text-slate-500 text-[10px]">Diretor de Ouvidoria</div>
              </div>
              <div>
                <div class="text-slate-200 font-medium">David Freitas</div>
                <div class="text-slate-500 text-[10px]">Diretor de AnÃ¡lise de Dados</div>
              </div>
            </div>
            <div class="pt-2 mt-2 border-t border-white/5">
              <div class="text-slate-400 mb-2 text-[10px] uppercase tracking-wide">Analistas EstratÃ©gicos da Ouvidoria</div>
              <div class="space-y-1 text-slate-300">
                <div class="text-[11px]">â€¢ Nikolas Brian</div>
                <div class="text-[11px]">â€¢ Rildo Luiz</div>
                <div class="text-[11px]">â€¢ Wellington Ribeiro</div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <main id="pages" class="col-span-12 lg:col-span-9 xl:col-span-10 space-y-6">
        <!-- Indicador de Filtros Ativos -->
        <div id="filterIndicator" class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 z-50"></div>
        
        <!-- TÃ­tulo dinÃ¢mico da pÃ¡gina (mostra filtro ativo) -->
        <div id="pageTitle" class="mb-4"></div>
        
        <!-- PÃ¡gina Home: ApresentaÃ§Ã£o da Cora -->
        <section id="page-home" class="">
          <div class="glass rounded-2xl p-8 md:p-12 text-center">
            <!-- Logo/Ãcone da Cora com animaÃ§Ã£o -->
            <div class="mb-8">
              <div class="inline-block relative">
                <div class="cora-avatar w-32 h-32 md:w-40 md:h-40 mx-auto rounded-full bg-gradient-to-br from-cyan-400 via-purple-500 to-pink-500 flex items-center justify-center text-6xl md:text-7xl">
                  ğŸ¤–
                </div>
                <div class="absolute inset-0 rounded-full bg-cyan-400/20 blur-2xl"></div>
              </div>
            </div>
            
            <!-- TÃ­tulo principal -->
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 neon">
              OlÃ¡, Gestor Municipal! ğŸ‘‹
            </h1>
            <h2 class="text-2xl md:text-4xl font-bold text-cyan-300 mb-8">
              Eu sou a <span class="text-purple-400">Cora</span>
            </h2>
            
            <!-- SubtÃ­tulo -->
            <p class="text-lg md:text-xl text-slate-300 mb-12 max-w-3xl mx-auto ">
              Sua assistente virtual inteligente especializada em anÃ¡lises de ouvidoria
            </p>
            
            <!-- Cards de funcionalidades -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
              <!-- Card 1: Chat Inteligente -->
              <div class="glass rounded-xl p-6 hover:scale-105 transition-transform duration-100">
                <div class="text-4xl mb-4">ğŸ’¬</div>
                <h3 class="text-xl font-bold text-cyan-300 mb-2">Chat Inteligente</h3>
                <p class="text-sm text-slate-400">
                  FaÃ§a perguntas em linguagem natural e receba respostas precisas baseadas em dados reais do banco de dados
                </p>
              </div>
              
              <!-- Card 2: AnÃ¡lises em Tempo Real -->
              <div class="glass rounded-xl p-6 hover:scale-105 transition-transform duration-100">
                <div class="text-4xl mb-4">ğŸ“Š</div>
                <h3 class="text-xl font-bold text-purple-300 mb-2">AnÃ¡lises em Tempo Real</h3>
                <p class="text-sm text-slate-400">
                  Acesso direto ao banco de dados para fornecer informaÃ§Ãµes atualizadas e precisas
                </p>
              </div>
              
              <!-- Card 3: Processamento Inteligente -->
              <div class="glass rounded-xl p-6 hover:scale-105 transition-transform duration-100">
                <div class="text-4xl mb-4">ğŸ§ </div>
                <h3 class="text-xl font-bold text-pink-300 mb-2">Processamento Inteligente</h3>
                <p class="text-sm text-slate-400">
                  AnÃ¡lise avanÃ§ada de dados com capacidade de cÃ¡lculos matemÃ¡ticos e anÃ¡lises estatÃ­sticas
                </p>
              </div>
            </div>
            
            <!-- Como funciona -->
            <div class="glass rounded-xl p-8 mb-8 max-w-4xl mx-auto ">
              <h3 class="text-2xl font-bold text-cyan-300 mb-6 flex items-center justify-center gap-2">
                <span>âš¡</span> Como Funciona
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
                <div class="flex items-start gap-4">
                  <div class="flex-shrink-0 w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center text-cyan-300 font-bold text-lg">
                    1
                  </div>
                  <div>
                    <h4 class="font-semibold text-white mb-1">VocÃª faz uma pergunta</h4>
                    <p class="text-sm text-slate-400">
                      Pergunte sobre secretarias, setores, temas, protocolos, bairros, ou qualquer informaÃ§Ã£o da ouvidoria
                    </p>
                  </div>
                </div>
                
                <div class="flex items-start gap-4">
                  <div class="flex-shrink-0 w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-300 font-bold text-lg">
                    2
                  </div>
                  <div>
                    <h4 class="font-semibold text-white mb-1">Cora busca no banco</h4>
                    <p class="text-sm text-slate-400">
                      Sistema inteligente identifica palavras-chave e busca dados relevantes automaticamente no banco de dados
                    </p>
                  </div>
                </div>
                
                <div class="flex items-start gap-4">
                  <div class="flex-shrink-0 w-10 h-10 rounded-full bg-pink-500/20 flex items-center justify-center text-pink-300 font-bold text-lg">
                    3
                  </div>
                  <div>
                    <h4 class="font-semibold text-white mb-1">Sistema processa e responde</h4>
                    <p class="text-sm text-slate-400">
                      AnÃ¡lise inteligente dos dados, faz cÃ¡lculos quando necessÃ¡rio e formata uma resposta clara e objetiva
                    </p>
                  </div>
                </div>
                
                <div class="flex items-start gap-4">
                  <div class="flex-shrink-0 w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-300 font-bold text-lg">
                    4
                  </div>
                  <div>
                    <h4 class="font-semibold text-white mb-1">Resposta formatada</h4>
                    <p class="text-sm text-slate-400">
                      Receba respostas em Markdown com formataÃ§Ã£o profissional, nÃºmeros destacados e informaÃ§Ãµes organizadas
                    </p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Exemplos de perguntas -->
            <div class="glass rounded-xl p-8 max-w-4xl mx-auto mb-8 ">
              <h3 class="text-xl font-bold text-purple-300 mb-4">ğŸ’¡ Exemplos de Perguntas</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                <div class="bg-slate-800/50 rounded-lg p-4 border border-cyan-500/20">
                  <p class="text-sm text-cyan-200">"Qual a secretaria com mais reclamaÃ§Ãµes?"</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 border border-purple-500/20">
                  <p class="text-sm text-purple-200">"Quantas UPAs temos?"</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 border border-pink-500/20">
                  <p class="text-sm text-pink-200">"O que tem no protocolo C-0000.0000.0000.0000/25?"</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 border border-emerald-500/20">
                  <p class="text-sm text-emerald-200">"Qual o bairro com mais reclamaÃ§Ãµes?"</p>
                </div>
              </div>
            </div>
            
            <!-- BotÃ£o de aÃ§Ã£o -->
            <div class="Up">
              <a href="/chat" class="inline-block px-8 py-4 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-xl font-bold text-lg hover:scale-105 transition-transform duration-100 glow-ring">
                ğŸš€ ComeÃ§ar a Conversar com a Cora
              </a>
            </div>
          </div>
        </section>
        
        <!-- Painel principal: VisÃ£o Geral (refatorado) -->
        <section id="page-main" style="display: none;">
          <!-- Header -->
          <header class="glass rounded-2xl p-6 mb-6 relative overflow-hidden">
            <div class="absolute inset-0 opacity-30" style="background: radial-gradient(600px 220px at 8% 0%, rgba(34,211,238,0.22), transparent 60%), radial-gradient(600px 220px at 92% 100%, rgba(167,139,250,0.22), transparent 60%)"></div>
            <div class="relative flex flex-wrap items-center justify-between gap-4">
              <div class="flex items-center gap-4">
                <img src="/dc-logo.png" alt="Duque de Caxias" class="h-14 w-auto object-contain" />
                <div>
                  <h1 class="text-xl md:text-2xl font-bold neon">VisÃ£o Geral â€¢ InteligÃªncia EstratÃ©gicas</h1>
                  <div class="text-slate-400 text-xs">Dados interligados: clique para filtrar todo o painel</div>
                </div>
              </div>
            </div>
          </header>

          <!-- ========== SEÃ‡ÃƒO 1: KPIs PRINCIPAIS ========== -->
          <section class="mb-6">
            <div class="flex items-center gap-2 mb-4">
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent"></div>
              <h2 class="text-sm font-semibold text-cyan-400 uppercase tracking-wider px-3">ğŸ“Š Indicadores Principais</h2>
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent"></div>
            </div>
            <div class="grid grid-cols-12 gap-6">
              <div class="col-span-12 md:col-span-4 glass rounded-2xl p-5 hover:scale-[1.02] transition-transform">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-slate-400 text-sm font-medium">Total de ManifestaÃ§Ãµes</div>
                  <div class="text-2xl">ğŸ“ˆ</div>
                </div>
                <div class="flex items-end gap-3 mt-2">
                  <div id="kpiTotal" class="text-3xl font-extrabold text-cyan-300">â€”</div>
                  <div id="kpiTotalDelta" class="text-xs text-slate-400 mb-1">â€”</div>
                </div>
                <canvas id="sparkTotal" height="32" class="mt-3"></canvas>
              </div>
              <div class="col-span-12 md:col-span-4 glass rounded-2xl p-5 hover:scale-[1.02] transition-transform">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-slate-400 text-sm font-medium">Ãšltimos 7 dias</div>
                  <div class="text-2xl">ğŸ“…</div>
                </div>
                <div class="flex items-end gap-3 mt-2">
                  <div id="kpi7" class="text-3xl font-extrabold text-violet-300">â€”</div>
                  <div id="kpi7Delta" class="text-xs text-slate-400 mb-1">â€”</div>
                </div>
                <canvas id="spark7" height="32" class="mt-3"></canvas>
              </div>
              <div class="col-span-12 md:col-span-4 glass rounded-2xl p-5 hover:scale-[1.02] transition-transform">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-slate-400 text-sm font-medium">Ãšltimos 30 dias</div>
                  <div class="text-2xl">ğŸ“Š</div>
                </div>
                <div class="flex items-end gap-3 mt-2">
                  <div id="kpi30" class="text-3xl font-extrabold text-emerald-300">â€”</div>
                  <div id="kpi30Delta" class="text-xs text-slate-400 mb-1">â€”</div>
                </div>
                <canvas id="spark30" height="32" class="mt-3"></canvas>
              </div>
            </div>
          </section>

          <!-- ========== SEÃ‡ÃƒO 2: INSIGHTS E ANÃLISES ========== -->
          <section class="mb-6">
            <div class="flex items-center gap-2 mb-4">
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-emerald-500/50 to-transparent"></div>
              <h2 class="text-sm font-semibold text-emerald-400 uppercase tracking-wider px-3">ğŸ’¡ Insights e AnÃ¡lises</h2>
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-emerald-500/50 to-transparent"></div>
            </div>
            <div class="grid grid-cols-12 gap-6">
              <div class="col-span-12 xl:col-span-8 glass rounded-2xl p-5">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="font-semibold text-emerald-300 text-lg">ğŸ¤– AnÃ¡lise Inteligente com IA</h3>
                  <button id="btnRefreshInsights" class="px-3 py-1.5 text-xs rounded-lg bg-emerald-500/20 border border-emerald-500/30 text-emerald-300 hover:bg-emerald-500/30 transition-colors">
                    ğŸ”„ Atualizar
                  </button>
                </div>
                
                <!-- Insights gerados pela IA -->
                <div id="insightsAIBox" class="space-y-3 mb-4">
                  <div class="flex items-center justify-center py-4">
                    <div class="text-slate-400">Gerando insights...</div>
                  </div>
                </div>
                
                <!-- Insights bÃ¡sicos -->
                <div class="border-t border-white/10 pt-4">
                  <div class="text-xs text-slate-400 mb-2 font-medium">ğŸ“Š Resumo RÃ¡pido</div>
                  <div id="insightsBox" class="text-sm text-slate-300 space-y-2">
                    <div class="flex items-center justify-center py-4">
                      <div class="text-slate-400">Carregando...</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Status Overview -->
              <div class="col-span-12 xl:col-span-4 glass rounded-2xl p-5">
                <h3 class="font-semibold text-cyan-300 text-lg mb-4">ğŸ“Š Status Atual</h3>
                <div id="statusOverviewCards" class="space-y-3">
                  <div class="text-center text-slate-400 py-4">Carregando...</div>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== SEÃ‡ÃƒO 3: TENDÃŠNCIAS E DISTRIBUIÃ‡Ã•ES ========== -->
          <section class="mb-6">
            <div class="flex items-center gap-2 mb-4">
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-blue-500/50 to-transparent"></div>
              <h2 class="text-sm font-semibold text-blue-400 uppercase tracking-wider px-3">ğŸ“ˆ TendÃªncias e DistribuiÃ§Ãµes</h2>
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-blue-500/50 to-transparent"></div>
            </div>
            <div class="grid grid-cols-12 gap-6">
              <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="font-semibold text-cyan-300">ğŸ“Š TendÃªncia Mensal (12M)</h3>
                </div>
                <div class="rounded-xl overflow-hidden bg-slate-900/30 p-2">
                  <canvas id="chartTrend"></canvas>
                </div>
              </div>
              <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="font-semibold text-violet-300">ğŸ¯ Funil por Status</h3>
                </div>
                <div class="rounded-xl overflow-hidden bg-slate-900/30 p-2">
                  <canvas id="chartFunnelStatus"></canvas>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== SEÃ‡ÃƒO 4: RANKINGS PRINCIPAIS ========== -->
          <section class="mb-6">
            <div class="flex items-center gap-2 mb-4">
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-purple-500/50 to-transparent"></div>
              <h2 class="text-sm font-semibold text-purple-400 uppercase tracking-wider px-3">ğŸ† Rankings Principais</h2>
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-purple-500/50 to-transparent"></div>
            </div>
            <div class="grid grid-cols-12 gap-6">
              <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="font-semibold text-cyan-300">ğŸ›ï¸ Top Ã“rgÃ£os (Top 10)</h3>
                </div>
                <div class="rounded-xl overflow-hidden bg-slate-900/30 p-2">
                  <canvas id="chartTopOrgaos"></canvas>
                </div>
              </div>
              <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="font-semibold text-emerald-300">ğŸ“‘ Top Temas</h3>
                </div>
                <div class="rounded-xl overflow-hidden bg-slate-900/30 p-2">
                  <canvas id="chartTopTemas"></canvas>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== SEÃ‡ÃƒO 5: HEATMAP E ANÃLISES AVANÃ‡ADAS ========== -->
          <section class="mb-6">
            <div class="flex items-center gap-2 mb-4">
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-amber-500/50 to-transparent"></div>
              <h2 class="text-sm font-semibold text-amber-400 uppercase tracking-wider px-3">ğŸ”¥ AnÃ¡lises AvanÃ§adas</h2>
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-amber-500/50 to-transparent"></div>
            </div>
            <div class="grid grid-cols-12 gap-6">
              <div class="col-span-12 glass rounded-2xl p-5">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="font-semibold text-amber-300">ğŸ—ºï¸ Heatmap: MÃªs Ã— DimensÃ£o</h3>
                  <div>
                    <select id="heatmapDim" class="bg-slate-900/60 border border-white/10 rounded-lg px-3 py-2 text-sm glow-ring hover:border-amber-500/50 transition-colors">
                      <option>Categoria</option>
                      <option>Secretaria</option>
                      <option>Setor</option>
                      <option>Tipo</option>
                      <option>Status</option>
                      <option>Bairro</option>
                      <option>UAC</option>
                      <option>Responsavel</option>
                      <option>Canal</option>
                      <option>Prioridade</option>
                    </select>
                  </div>
                </div>
                <div id="heatmap" class="overflow-auto rounded-xl border border-white/10 bg-slate-900/20"></div>
              </div>
            </div>
          </section>
          <!-- ========== SEÃ‡ÃƒO 6: DISTRIBUIÃ‡ÃƒO POR STATUS ========== -->
          <section class="mb-6">
            <div class="flex items-center gap-2 mb-4">
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-rose-500/50 to-transparent"></div>
              <h2 class="text-sm font-semibold text-rose-400 uppercase tracking-wider px-3">ğŸ“‹ DistribuiÃ§Ã£o Detalhada</h2>
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-rose-500/50 to-transparent"></div>
            </div>
            <div class="grid grid-cols-12 gap-6">
              <div class="col-span-12 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-rose-300">ğŸ“Š DistribuiÃ§Ã£o por Status</h3>
                <div class="flex items-center gap-2">
                  <button id="btnMarcarTodosStatus" class="px-3 py-1.5 text-xs rounded-lg bg-cyan-500/20 text-cyan-300 hover:bg-cyan-500/30 border border-cyan-500/30 transition-colors duration-100">
                    âœ“ Marcar Todos
                  </button>
                  <button id="btnDesmarcarTodosStatus" class="px-3 py-1.5 text-xs rounded-lg bg-slate-500/20 text-slate-300 hover:bg-slate-500/30 border border-slate-500/30 transition-colors duration-100">
                    âœ— Desmarcar Todos
                  </button>
                </div>
              </div>
            <div class="grid grid-cols-12 gap-4">
              <div class="col-span-12 lg:col-span-5 rounded-xl overflow-hidden bg-slate-900/30 flex items-center justify-center">
                <canvas id="chartStatus"></canvas>
              </div>
              <div class="col-span-12 lg:col-span-7">
                <div class="mb-3 flex items-center gap-4 text-xs px-2 py-2 rounded-lg bg-slate-900/30 border border-white/5">
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-emerald-400 shadow-sm shadow-emerald-400/50"></div>
                    <span class="text-slate-300 font-medium">Encerradas</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-amber-400 shadow-sm shadow-amber-400/50"></div>
                    <span class="text-slate-300 font-medium">Ativas</span>
                  </div>
                  <div class="ml-auto text-slate-500 text-[10px]">
                    Clique nos itens para mostrar/ocultar
                  </div>
                </div>
                <div id="statusLegend" class="max-h-[400px] overflow-y-auto pr-2 space-y-1 text-xs">
                  <!-- Legenda serÃ¡ preenchida dinamicamente -->
                </div>
              </div>
            </div>
          </div>
        </section>
          <!-- ========== SEÃ‡ÃƒO 7: VISUALIZAÃ‡Ã•ES AVANÃ‡ADAS ========== -->
          <section class="mb-6">
            <div class="flex items-center gap-2 mb-4">
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-indigo-500/50 to-transparent"></div>
              <h2 class="text-sm font-semibold text-indigo-400 uppercase tracking-wider px-3">ğŸ¨ VisualizaÃ§Ãµes AvanÃ§adas</h2>
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-indigo-500/50 to-transparent"></div>
            </div>
            <div class="grid grid-cols-12 gap-6">
              <!-- Sankey Diagram: Fluxo Tema â†’ Ã“rgÃ£o â†’ Status -->
              <div class="col-span-12 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-4 text-cyan-400">ğŸŒŠ Fluxo de ManifestaÃ§Ãµes: Tema â†’ Ã“rgÃ£o â†’ Status</h3>
                <div id="sankeyChart" style="height: 500px;"></div>
              </div>
              
              <!-- TreeMap: ProporÃ§Ã£o por Categoria -->
              <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-4 text-violet-400">ğŸ—ºï¸ ProporÃ§Ã£o por Categoria (TreeMap)</h3>
                <div id="treemapChart" style="height: 400px;"></div>
              </div>
              
              <!-- Mapa de Calor GeogrÃ¡fico -->
              <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-4 text-emerald-400">ğŸ“ DistribuiÃ§Ã£o GeogrÃ¡fica por Bairro</h3>
                <div id="mapChart" style="height: 400px;"></div>
              </div>
            </div>
          </section>
        
        </section>
        
        <!-- PÃ¡gina Cora - Chat -->
        <section id="page-cora-chat" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6 relative overflow-hidden">
            <div class="absolute inset-0 opacity-30" style="background: radial-gradient(600px 200px at 10% 0%, rgba(167,139,250,0.25), transparent 60%)"></div>
            <div class="relative">
              <h2 class="neon text-xl font-bold mb-2">ğŸ’¬ Cora - Chat</h2>
              <p class="text-slate-400 text-sm">Assistente virtual para dÃºvidas e suporte</p>
            </div>
          </header>
          <div class="glass rounded-2xl p-5">
            <div id="chatContainer" class="flex flex-col h-[600px] bg-slate-900/30 rounded-xl border border-white/10 overflow-hidden">
              <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-3">
                <div class="flex items-start gap-3">
                  <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0">
                    <span class="text-white text-sm font-bold">C</span>
                  </div>
                  <div class="flex-1">
                    <div class="bg-slate-800/60 rounded-lg p-3 text-sm text-slate-200">
                      <div class="font-semibold text-purple-300 mb-1">Cora</div>
                      <div>OlÃ¡! Sou a Cora, sua assistente virtual. Como posso ajudar vocÃª hoje Gestor Municipal?</div>
                    </div>
                    <div class="text-xs text-slate-500 mt-1 ml-1">Agora</div>
                  </div>
                </div>
              </div>
              <div class="border-t border-white/10 p-4">
                <form id="chatForm" class="flex gap-2" onsubmit="return false;">
                  <input 
                    type="text" 
                    id="chatInput" 
                    placeholder="Digite sua mensagem..." 
                    class="flex-1 bg-slate-800/60 border border-white/10 rounded-lg px-4 py-2 text-sm text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500/50"
                    autocomplete="off"
                  />
                  <button 
                    type="button" 
                    id="chatSubmitBtn"
                    class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg text-white font-semibold hover:from-purple-600 hover:to-pink-600 transition-all glow-ring"
                  >
                    Enviar
                  </button>
                </form>
              </div>
            </div>
          </div>
        </section>
        
        <!-- PÃ¡gina por Categoria -->
        <section id="page-categoria" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Tema</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-fuchsia-400">Top Temas</h3>
              <canvas id="chartCategoria"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-fuchsia-400">Heatmap MÃªs x Categoria</h3>
              <div id="heatmapCategoria" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-fuchsia-400">Categorias por MÃªs</h3>
              <canvas id="chartCategoriaMes"></canvas>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina por Status -->
        <section id="page-status" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Status</h2></header>
          
          <!-- Abas para diferentes visualizaÃ§Ãµes -->
          <div class="mb-6 flex gap-2 border-b border-white/10">
            <button class="tab-status px-4 py-2 font-semibold text-sm transition-colors border-b-2 border-cyan-400 text-cyan-400" data-tab="status">
              Por Status
            </button>
            <button class="tab-status px-4 py-2 font-semibold text-sm transition-colors border-b-2 border-transparent text-slate-400 hover:text-slate-300" data-tab="tema">
              Por Tema
            </button>
            <button class="tab-status px-4 py-2 font-semibold text-sm transition-colors border-b-2 border-transparent text-slate-400 hover:text-slate-300" data-tab="orgao">
              Por Ã“rgÃ£o
            </button>
          </div>
          
          <!-- ConteÃºdo da aba Por Status -->
          <div id="status-tab-content" class="tab-content">
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-sky-400">DistribuiÃ§Ã£o por Status</h3>
              <canvas id="chartStatusPage"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-sky-400">Heatmap MÃªs x Status</h3>
              <div id="heatmapStatus" class="overflow-auto rounded-xl border border-white/10"></div>
              </div>
              <div class="col-span-12 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-4 text-sky-400">Status por MÃªs</h3>
                <canvas id="chartStatusMes"></canvas>
              </div>
            </div>
          </div>
          
          <!-- ConteÃºdo da aba Por Tema -->
          <div id="tema-tab-content" class="tab-content hidden">
            <div class="grid grid-cols-12 gap-6">
              <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-2 text-sky-400">Status por Tema</h3>
                <canvas id="chartStatusTema"></canvas>
              </div>
              <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-2 text-sky-400">Heatmap MÃªs x Tema</h3>
                <div id="heatmapStatusTema" class="overflow-auto rounded-xl border border-white/10"></div>
              </div>
            </div>
          </div>
          
          <!-- ConteÃºdo da aba Por Ã“rgÃ£o -->
          <div id="orgao-tab-content" class="tab-content hidden">
            <div class="grid grid-cols-12 gap-6">
              <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-2 text-sky-400">Status por Ã“rgÃ£o</h3>
                <canvas id="chartStatusOrgao"></canvas>
              </div>
              <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-2 text-sky-400">Heatmap MÃªs x Ã“rgÃ£o</h3>
                <div id="heatmapStatusOrgao" class="overflow-auto rounded-xl border border-white/10"></div>
              </div>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina por Bairro -->
        <section id="page-bairro" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Bairros</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-amber-400">Top Bairros</h3>
              <canvas id="chartBairro"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-amber-400">Heatmap MÃªs x Bairro</h3>
              <div id="heatmapBairro" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-amber-400">Bairros por MÃªs</h3>
              <canvas id="chartBairroMes"></canvas>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina Por Ã“rgÃ£o e MÃªs (alinhado com Looker Studio) -->
        <section id="page-orgao-mes" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Por Ã“rgÃ£o e MÃªs</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <!-- Painel Esquerdo: ManifestaÃ§Ãµes por Ã“rgÃ£o -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-xl text-cyan-400">ManifestaÃ§Ãµes por Ã“rgÃ£o</h3>
                <div class="text-xs text-slate-400">Total de Ã³rgÃ£os: <span id="totalOrgaos">â€”</span></div>
              </div>
              <div class="space-y-2 max-h-[600px] overflow-y-auto">
                <div id="listaOrgaos" class="space-y-1">
                  <!-- SerÃ¡ preenchido dinamicamente -->
                </div>
              </div>
              <div class="mt-6 pt-4 border-t border-white/10">
                <div class="text-xs text-slate-400 mb-2">INDICADORES</div>
                <div class="flex items-center gap-3">
                  <img src="/dc-logo.png" alt="Duque de Caxias" class="h-8 w-auto object-contain" />
                  <div class="text-xs text-slate-300">FALA CIDADÃƒO!</div>
                </div>
              </div>
            </div>
            
            <!-- Painel Direito: ManifestaÃ§Ãµes por MÃªs -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-xl text-violet-400">ManifestaÃ§Ãµes por MÃªs</h3>
              </div>
              <div class="mb-6">
                <canvas id="chartOrgaoMes"></canvas>
              </div>
              <!-- KPI Total -->
              <div class="mt-6 glass rounded-xl p-6 text-center" style="background: linear-gradient(135deg, rgba(34,211,238,0.15), rgba(167,139,250,0.15));">
                <div class="text-sm text-slate-400 mb-2">ManifestaÃ§Ãµes</div>
                <div id="totalOrgaoMes" class="text-5xl font-extrabold text-cyan-300 mb-2">â€”</div>
                <div class="text-xs text-slate-400">TOTAL CADASTRADAS ATÃ‰ O MOMENTO</div>
              </div>
            </div>
            
            <!-- Tabela Por Ã“rgÃ£o e MÃªs -->
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Tabela: ManifestaÃ§Ãµes por Ã“rgÃ£o e MÃªs</h3>
              <div class="overflow-x-auto">
                <div id="tabelaOrgaoMes" class="min-w-full">
                  <!-- SerÃ¡ preenchido dinamicamente -->
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina por Secretaria -->
        <section id="page-secretaria" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">AnÃ¡lise por Secretaria (Ã“rgÃ£o)</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-cyan-400">Registros por Secretaria</h3>
              <canvas id="chartSecretaria"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-cyan-400">Top 10 Secretarias (Rank)</h3>
              <ul id="rankSecretaria" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Secretarias por MÃªs</h3>
              <canvas id="chartSecretariaMes"></canvas>
            </div>
          </div>
        </section>
        
        <!-- PÃ¡gina Secretarias e Distritos -->
        <section id="page-secretarias-distritos" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6">
            <h2 class="neon text-xl font-bold">Secretarias e Distritos</h2>
            <p class="text-slate-400 text-sm mt-2">AnÃ¡lise de secretarias municipais por distrito</p>
          </header>
          
          <div class="grid grid-cols-12 gap-6">
            <!-- Lista de Distritos -->
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Distritos de Duque de Caxias</h3>
              <div id="listaDistritos" class="space-y-3 max-h-[600px] overflow-y-auto">
                <!-- Preenchido dinamicamente -->
              </div>
            </div>
            
            <!-- Secretarias por Distrito Selecionado -->
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">
                Secretarias do <span id="distritoSelecionadoNome" class="text-cyan-300">Selecione um distrito</span>
              </h3>
              <div id="listaSecretarias" class="space-y-3">
                <div class="text-center text-slate-400 py-8">Selecione um distrito para ver as secretarias</div>
              </div>
            </div>
            
            <!-- EstatÃ­sticas Gerais -->
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-emerald-400">EstatÃ­sticas</h3>
              <div id="estatisticasDistritos" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Preenchido dinamicamente -->
              </div>
            </div>
            
            <!-- GrÃ¡fico de Secretarias por Distrito -->
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-amber-400">DistribuiÃ§Ã£o de Secretarias por Distrito</h3>
              <canvas id="chartSecretariasDistritos"></canvas>
            </div>
          </div>
        </section>
        
        <!-- PÃ¡gina por Tipo de ManifestaÃ§Ã£o -->
        <section id="page-tipo" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Tipos de ManifestaÃ§Ã£o</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-violet-400">DistribuiÃ§Ã£o por Tipo (ReclamaÃ§Ã£o/Elogio/...)</h3>
              <canvas id="chartTipo"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-violet-400">Top Tipos (Rank)</h3>
              <ul id="rankTipo" class="space-y-2"></ul>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina por Setor -->
        <section id="page-setor" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">AnÃ¡lise por Setor/Departamento</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-emerald-400">Registros por Setor</h3>
              <canvas id="chartSetor"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-emerald-400">Top 10 Unidades de Cadastro (Rank)</h3>
              <ul id="rankSetor" class="space-y-2"></ul>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina por UAC (Unidade de Atendimento ao CidadÃ£o) -->
        <section id="page-uac" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Unidades de Atendimento ao CidadÃ£o (UAC)</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-cyan-400">Total por UAC</h3>
              <canvas id="chartUAC"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-cyan-400">Top 10 UACs (Rank)</h3>
              <ul id="rankUAC" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-cyan-400">Heatmap MÃªs x UAC</h3>
              <div id="heatmapUAC" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina por ResponsÃ¡veis -->
        <section id="page-responsavel" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">ResponsÃ¡veis pelo Tratamento da Demanda</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-violet-400">DistribuiÃ§Ã£o por ResponsÃ¡vel</h3>
              <canvas id="chartResponsavel"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-violet-400">Top ResponsÃ¡veis (Rank)</h3>
              <ul id="rankResponsavel" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-violet-400">Heatmap MÃªs x ResponsÃ¡vel</h3>
              <div id="heatmapResponsavel" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina por Canal -->
        <section id="page-canal" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Canais de Atendimento</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-emerald-400">DistribuiÃ§Ã£o por Canal</h3>
              <canvas id="chartCanal"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-emerald-400">Top Canais (Rank)</h3>
              <ul id="rankCanal" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-emerald-400">Heatmap MÃªs x Canal</h3>
              <div id="heatmapCanal" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina por Prioridade -->
        <section id="page-prioridade" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Prioridades das Demandas</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-rose-400">DistribuiÃ§Ã£o por Prioridade</h3>
              <canvas id="chartPrioridade"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 ">
              <h3 class="font-semibold mb-2 text-rose-400">Ranking de Prioridades</h3>
              <ul id="rankPrioridade" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-rose-400">Heatmap MÃªs x Prioridade</h3>
              <div id="heatmapPrioridade" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina Tempo MÃ©dio de Atendimento -->
        <section id="page-tempo-medio" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6">
              <h2 class="neon text-xl font-bold">Tempo MÃ©dio de Atendimento / Dias</h2>
          </header>
          
          <!-- EstatÃ­sticas Gerais -->
          <div class="grid grid-cols-12 gap-6 mb-6">
            <div class="col-span-12 md:col-span-3 glass rounded-2xl p-5">
              <div class="text-slate-400 text-sm mb-2">MÃ©dia Geral</div>
              <div id="statMedia" class="text-3xl font-extrabold text-cyan-300">â€”</div>
              <div class="text-xs text-slate-500 mt-1">dias</div>
            </div>
            <div class="col-span-12 md:col-span-3 glass rounded-2xl p-5">
              <div class="text-slate-400 text-sm mb-2">Mediana</div>
              <div id="statMediana" class="text-3xl font-extrabold text-purple-300">â€”</div>
              <div class="text-xs text-slate-500 mt-1">dias</div>
            </div>
            <div class="col-span-12 md:col-span-3 glass rounded-2xl p-5">
              <div class="text-slate-400 text-sm mb-2">MÃ­nimo</div>
              <div id="statMinimo" class="text-3xl font-extrabold text-emerald-300">â€”</div>
              <div class="text-xs text-slate-500 mt-1">dias</div>
            </div>
            <div class="col-span-12 md:col-span-3 glass rounded-2xl p-5">
              <div class="text-slate-400 text-sm mb-2">MÃ¡ximo</div>
              <div id="statMaximo" class="text-3xl font-extrabold text-red-300">â€”</div>
              <div class="text-xs text-slate-500 mt-1">dias</div>
            </div>
          </div>

          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Tempo MÃ©dio por Ã“rgÃ£o/Unidade</h3>
              <canvas id="chartTempoMedio"></canvas>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Ranking</h3>
              <div id="listaTempoMedio" class="space-y-2 max-h-[500px] overflow-y-auto"></div>
            </div>
            
            <!-- GrÃ¡fico por Dia -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">TendÃªncia DiÃ¡ria (Ãšltimos 30 dias)</h3>
              <canvas id="chartTempoMedioDia"></canvas>
            </div>
            
            <!-- GrÃ¡fico por Semana -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">TendÃªncia Semanal (Ãšltimas 12 semanas)</h3>
              <canvas id="chartTempoMedioSemana"></canvas>
            </div>
            
            <!-- GrÃ¡fico por MÃªs -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">TendÃªncia Mensal (Ãšltimos 12 meses)</h3>
              <canvas id="chartTempoMedioMes"></canvas>
            </div>
            
            <!-- Tempo MÃ©dio por Unidade de Cadastro -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Tempo MÃ©dio por Unidade de Cadastro</h3>
              <canvas id="chartTempoMedioUnidade"></canvas>
            </div>
            
            <!-- Tempo MÃ©dio por Unidade de Cadastro por MÃªs -->
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-emerald-400">Tempo MÃ©dio por Unidade de Cadastro por MÃªs</h3>
              <canvas id="chartTempoMedioUnidadeMes"></canvas>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina Por Tema -->
        <section id="page-tema" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">ManifestaÃ§Ãµes por Tema</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">DistribuiÃ§Ã£o por Tema</h3>
              <canvas id="chartTema"></canvas>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-violet-400">Status Geral</h3>
              </div>
              <canvas id="chartStatusTema"></canvas>
              <div id="statusTemaInfo" class="mt-4 space-y-2 text-sm"></div>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Filtro / MÃªs</h3>
              <canvas id="chartTemaMes"></canvas>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-violet-400">Lista Completa de Temas</h3>
                <div id="filtrosTemaInfo" class="text-xs text-slate-400"></div>
              </div>
              <div id="listaTemas" class="space-y-2 max-h-[500px] overflow-y-auto"></div>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina Por Assunto -->
        <section id="page-assunto" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total por Assunto</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-emerald-400">Top 15 Assuntos</h3>
                <span class="text-xs text-slate-400">(Lista completa abaixo)</span>
              </div>
              <div style="height: 500px; position: relative;">
              <canvas id="chartAssunto"></canvas>
              </div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-emerald-400">Status</h3>
              </div>
              <canvas id="chartStatusAssunto"></canvas>
              <div id="statusAssuntoInfo" class="mt-4 space-y-2 text-sm"></div>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-emerald-400">Lista Completa de Assuntos</h3>
              <div id="listaAssuntos" class="space-y-2 max-h-[500px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-emerald-400">Assuntos por MÃªs</h3>
              <canvas id="chartAssuntoMes"></canvas>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina Por Cadastrante -->
        <section id="page-cadastrante" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6">
            <div class="flex items-center justify-between mb-2">
              <h2 class="neon text-xl font-bold">Por Cadastrante / Unidade</h2>
              <div id="filtrosCadastranteInfo" class="text-xs text-slate-400"></div>
            </div>
          </header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Por Servidor</h3>
              <div id="listaServidores" class="space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Unidades de Cadastro</h3>
              <div id="listaUnidadesCadastro" class="space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Filtro / MÃªs</h3>
              <canvas id="chartCadastranteMes"></canvas>
            </div>
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5 text-center" style="background: linear-gradient(135deg, rgba(34,211,238,0.15), rgba(167,139,250,0.15));">
              <div class="text-sm text-slate-400 mb-2">ManifestaÃ§Ãµes</div>
              <div id="totalCadastrante" class="text-6xl font-extrabold text-cyan-300 mb-2">â€”</div>
              <div class="text-xs text-slate-400">TOTAL CADASTRADAS ATÃ‰ O MOMENTO</div>
            </div>
            <!-- GrÃ¡ficos adicionais que aparecem quando hÃ¡ filtro ativo -->
            <div id="graficosFiltrados" class="col-span-12 grid grid-cols-12 gap-6" style="display: none;">
              <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-4 text-amber-400">Por Tema (Filtrado)</h3>
                <canvas id="chartCadastranteTema"></canvas>
              </div>
              <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-4 text-pink-400">Por Assunto (Filtrado)</h3>
                <canvas id="chartCadastranteAssunto"></canvas>
              </div>
              <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
                <h3 class="font-semibold mb-4 text-emerald-400">Por Status (Filtrado)</h3>
                <canvas id="chartCadastranteStatus"></canvas>
              </div>
            </div>
          </div>
        </section>
        <!-- PÃ¡gina ReclamaÃ§Ãµes e DenÃºncias -->
        <section id="page-reclamacoes" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos (ReclamaÃ§Ãµes e DenÃºncias)</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-rose-400">Assuntos</h3>
              <div id="listaReclamacoes" class="space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-rose-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas id="chartReclamacoesTipo"></canvas>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-rose-400">Quantidade por MÃªs</h3>
              <canvas id="chartReclamacoesMes"></canvas>
            </div>
          </div>
        </section>
        
        <!-- PÃ¡gina ProjeÃ§Ã£o 2026 -->
        <section id="page-projecao-2026" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6">
            <h2 class="neon text-xl font-bold">ğŸ“ˆ ProjeÃ§Ã£o 2026</h2>
            <p class="text-slate-400 text-sm mt-2">AnÃ¡lise de tendÃªncias e projeÃ§Ãµes baseadas em dados histÃ³ricos</p>
          </header>
          
          <div class="grid grid-cols-12 gap-6">
            <!-- GrÃ¡fico de TendÃªncia Mensal -->
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">TendÃªncia Mensal (HistÃ³rico + ProjeÃ§Ã£o)</h3>
              <canvas id="chartProjecaoMensal"></canvas>
            </div>
            
            <!-- ProjeÃ§Ã£o por Tema -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Top Temas (ProjeÃ§Ã£o)</h3>
              <canvas id="chartProjecaoTema"></canvas>
            </div>
            
            <!-- Status Projetado -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-emerald-400">DistribuiÃ§Ã£o por Status (ProjeÃ§Ã£o)</h3>
              <canvas id="chartProjecaoStatus"></canvas>
              <div id="projecaoStatusInfo" class="mt-4 space-y-2 text-sm"></div>
            </div>
            
            <!-- Resumo de ProjeÃ§Ãµes -->
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-amber-400">Resumo de ProjeÃ§Ãµes para 2026</h3>
              <div id="resumoProjecao" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Preenchido dinamicamente -->
              </div>
            </div>
          </div>
        </section>
        
        <!-- PÃ¡ginas de Unidades -->
        <section id="page-unit-adao" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital AdÃ£o</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-cer-iv" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos CER IV</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-olho" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital do Olho</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-duque" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital Duque</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-infantil" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital Infantil</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-moacyr" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital Moacyr</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-maternidade-santa-cruz" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Maternidade Santa Cruz</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-upa-beira-mar" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPA Beira Mar</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-pilar" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Pilar</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-saracuruna" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Saracuruna</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-xerem" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH XerÃ©m</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-veterinario" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital VeterinÃ¡rio</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-upa-walter-garcia" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPA Walter Garcia</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-campos-eliseos" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Campos ElÃ­seos</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-parque-equitativa" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Parque Equitativa</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-ubs-antonio-granja" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UBS Antonio Granja</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-upa-sarapui" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPA SarapuÃ­</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-imbarie" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH ImbariÃª</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de AÃ§Ã£o</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
      </main>
      
      <!-- Widget de Chat Flutuante (sempre visÃ­vel) -->
      <div id="chatWidget" class="fixed bottom-6 right-6 z-50">
        <div id="chatWidgetToggle" class="w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 shadow-lg cursor-pointer flex items-center justify-center hover:scale-110 transition-transform glow-ring">
          <span class="text-white text-2xl">ğŸ’¬</span>
        </div>
        <div id="chatWidgetWindow" class="hidden absolute bottom-20 right-0 w-80 h-96 glass rounded-2xl border border-white/10 shadow-2xl flex flex-col overflow-hidden">
          <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-4 border-b border-white/10 flex items-center justify-between">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                <span class="text-white text-sm font-bold">C</span>
              </div>
              <div>
                <div class="font-semibold text-slate-200">Cora</div>
                <div class="text-xs text-slate-400">Online</div>
              </div>
            </div>
            <button id="chatWidgetClose" class="text-slate-400 hover:text-slate-200 transition-colors duration-100">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <div id="chatWidgetMessages" class="flex-1 overflow-y-auto p-4 space-y-3">
            <div class="flex items-start gap-2">
              <div class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0">
                <span class="text-white text-xs font-bold">C</span>
              </div>
              <div class="flex-1">
                <div class="bg-slate-800/60 rounded-lg p-2 text-xs text-slate-200">
                  OlÃ¡! Como posso ajudar?
                </div>
              </div>
            </div>
          </div>
          <div class="border-t border-white/10 p-3">
            <form id="chatWidgetForm" class="flex gap-2" onsubmit="return false;">
              <input 
                type="text" 
                id="chatWidgetInput" 
                placeholder="Digite..." 
                class="flex-1 bg-slate-800/60 border border-white/10 rounded-lg px-3 py-2 text-xs text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-purple-500/50"
                autocomplete="off"
              />
              <button 
                type="button" 
                id="chatWidgetSubmitBtn"
                class="px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg text-white text-xs font-semibold hover:from-purple-600 hover:to-pink-600 transition-all"
              >
                â†’
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    
    <!-- MÃ³dulos JavaScript modulares -->
    <script src="/scripts/config.js"></script>
    <script src="/scripts/dateUtils.js"></script>
    <script src="/scripts/api.js"></script>
    <script src="/scripts/utils.js"></script>
    <script src="/scripts/filters.js"></script>
    <script src="/scripts/charts.js"></script>
    <script src="/scripts/data.js"></script>
    <script src="/scripts/main.js"></script>
    <!-- Script de testes (carregar apenas se ?test=true na URL) -->
    <script src="/scripts/test.js"></script>
    <script src="/scripts/test-pages.js"></script>
    
    <script>
      // Registrar plugin de datalabels
      if (typeof ChartDataLabels !== 'undefined') {
        Chart.register(ChartDataLabels);
      }
      
      // FunÃ§Ã£o movida para scripts/utils.js
      // Alias para compatibilidade
      function createEnhancedTooltip() {
        if (window.utils?.createEnhancedTooltip) {
          return window.utils.createEnhancedTooltip();
        }
        // Fallback
        return {
          enabled: true,
          backgroundColor: 'rgba(15, 23, 42, 0.95)',
          titleColor: '#e2e8f0',
          bodyColor: '#cbd5e1',
          borderColor: 'rgba(34, 211, 238, 0.3)',
          borderWidth: 1,
          padding: 12,
          displayColors: true,
          callbacks: {
            title: function(context) {
              return context[0].label || '';
            },
            label: function(context) {
              const label = context.dataset.label || '';
              const value = context.parsed.y !== undefined ? context.parsed.y : context.parsed;
              const total = context.dataset.data.reduce((a, b) => a + (b || 0), 0);
              const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
              return `${label}: ${value.toLocaleString('pt-BR')} (${percentage}%)`;
            }
          }
        };
      }
      
      // FunÃ§Ã£o movida para scripts/utils.js
      // Alias para compatibilidade
      function createDataLabelsConfig(showPercentage = false, chartType = 'bar', showAll = true) {
        if (window.utils?.createDataLabelsConfig) {
          return window.utils.createDataLabelsConfig(showPercentage, chartType, showAll);
        }
        // Fallback
        // ConfiguraÃ§Ãµes base por tipo de grÃ¡fico
        const baseConfig = {
          color: '#e2e8f0',
          font: {
            size: 11,
            weight: 'bold'
          },
          formatter: function(value, context) {
            // Verificar se value Ã© vÃ¡lido
            if (value === null || value === undefined || isNaN(value)) {
              return '';
            }
            const numValue = Number(value);
            if (isNaN(numValue) || numValue === 0) {
              return '';
            }
            if (showPercentage && context.dataset && context.dataset.data) {
              const total = context.dataset.data.reduce((a, b) => a + (Number(b) || 0), 0);
              const percentage = total > 0 ? ((numValue / total) * 100).toFixed(1) : 0;
              return numValue.toLocaleString('pt-BR') + '\n(' + percentage + '%)';
            }
            return numValue.toLocaleString('pt-BR');
          },
          padding: 4,
          backgroundColor: 'rgba(15, 23, 42, 0.7)',
          borderRadius: 4
        };
        
        // Ajustar anchor e align baseado no tipo de grÃ¡fico
        if (chartType === 'doughnut' || chartType === 'pie') {
          baseConfig.anchor = 'center';
          baseConfig.align = 'center';
        } else if (chartType === 'bar' && showAll) {
          baseConfig.anchor = 'end';
          baseConfig.align = 'top';
        } else {
          baseConfig.anchor = 'end';
          baseConfig.align = 'top';
        }
        
        return baseConfig;
      }
      
      // FunÃ§Ã£o movida para scripts/charts.js
      // Alias para compatibilidade
      function addChartClickHandler(chart, onClickCallback, chartId = null) {
        if (window.charts?.addChartClickHandler) {
          return window.charts.addChartClickHandler(chart, onClickCallback, chartId);
        }
        // Fallback
        chart.canvas.style.cursor = 'pointer';
        chart.canvas.onclick = function(evt) {
          const points = chart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
          if (points.length) {
            const firstPoint = points[0];
            const label = chart.data.labels[firstPoint.index];
            const value = chart.data.datasets[firstPoint.datasetIndex].data[firstPoint.index];
            
            // Aplicar filtro global se chartId for fornecido (com toggle)
            const chartFieldMap = window.chartFieldMap || window.filters?.chartFieldMap;
            if (chartId && chartFieldMap?.[chartId]) {
              const fieldConfig = chartFieldMap[chartId];
              if (fieldConfig.field) {
                // Criar elemento virtual para realce visual
                const virtualElement = { 
                  classList: { add: () => {}, remove: () => {} },
                  setAttribute: () => {},
                  removeAttribute: () => {}
                };
                applyGlobalFilter(fieldConfig.field, label, chartId, virtualElement);
              }
            }
            
            if (onClickCallback) {
            onClickCallback(label, value, firstPoint.index);
            }
          }
        };
      }
      
      // FunÃ§Ã£o movida para scripts/utils.js
      // Alias para compatibilidade
      function showClickFeedback(element, label, value) {
        if (window.utils?.showClickFeedback) {
          return window.utils.showClickFeedback(element, label, value);
        }
        // Fallback
        const feedback = document.createElement('div');
        feedback.className = 'fixed top-4 right-4 glass rounded-lg p-4 z-50';
        feedback.innerHTML = `
          <div class="text-cyan-300 font-bold text-lg">${label}</div>
          <div class="text-slate-300 text-sm">Valor: ${value.toLocaleString('pt-BR')}</div>
        `;
        document.body.appendChild(feedback);
        setTimeout(() => {
          // AnimaÃ§Ã£o removida para melhor performance
          setTimeout(() => feedback.remove(), 100);
        }, 2000);
      }
      
      // FunÃ§Ã£o movida para scripts/utils.js
      // Alias para compatibilidade
      function gradient(ctx, from, to) {
        if (window.utils?.gradient) {
          return window.utils.gradient(ctx, from, to);
        }
        // Fallback
        const g = ctx.createLinearGradient(0, 0, 0, 300);
        g.addColorStop(0, from);
        g.addColorStop(1, to);
        return g;
      }

      // FunÃ§Ãµes de API movidas para scripts/api.js
      // Aliases otimizados - delegam diretamente para window.api
      async function fetchJSON(url, opts) {
        return window.api?.fetchJSON(url, opts) || (async () => {
          const res = await fetch(url, opts);
          if (!res.ok) throw new Error('Request failed');
          return res.json();
        })();
      }
      
      async function fetchJSONWithFilters(url, opts = {}) {
        return window.api?.fetchJSONWithFilters(url, opts) || window.api?.fetchJSONWithFilter(url, opts) || fetchJSON(url, opts);
      }
      
      async function fetchJSONWithFilter(url, opts = {}) {
        return window.api?.fetchJSONWithFilter(url, opts) || fetchJSONWithFilters(url, opts);
      }

      // ========== SISTEMA DE FILTROS GLOBAL ==========
      // Sistema de filtros movido para scripts/filters.js
      // Usar window.filters.applyGlobalFilter, window.filters.chartFieldMap, etc.
      // OU window.chartFieldMap (exportado diretamente para compatibilidade)
      
      // NOTA: chartFieldMap jÃ¡ estÃ¡ disponÃ­vel via window.chartFieldMap ou window.filters.chartFieldMap
      // NÃƒO redeclarar aqui para evitar erro "already declared"

      // FunÃ§Ã£o movida para scripts/filters.js
      // Alias otimizado
      function applyGlobalFilter(field, value, chartId = null, element = null) {
        if (window.filters?.applyGlobalFilter) {
          return window.filters.applyGlobalFilter(field, value, chartId, element);
        }
        console.warn('MÃ³dulo de filtros nÃ£o carregado');
      }
      
      // FunÃ§Ãµes auxiliares de filtros movidas para scripts/filters.js
      // Usar window.filters.addFilterHighlight, window.filters.removeFilterHighlight, etc.
      
      // FunÃ§Ã£o movida para scripts/filters.js
      // Alias para compatibilidade
      function updateAllFilterHighlights() {
        if (window.filters?.updateAllFilterHighlights) {
          return window.filters.updateAllFilterHighlights();
        }
        // Fallback
        // Atualizar cartÃµes de status
        if (window.globalFilters.filters.length > 0) {
          window.globalFilters.filters.forEach(filter => {
            // Procurar por elementos com o valor do filtro
            const elements = document.querySelectorAll(`[data-filter-value="${filter.value}"], [id*="${filter.value.toLowerCase().replace(/\s+/g, '-')}"]`);
            elements.forEach(el => {
              if (el.classList) {
                const isActive = window.globalFilters.filters.some(f => f.field === filter.field && f.value === filter.value);
                if (isActive) {
                  el.classList.add('filter-active');
                } else {
                  el.classList.remove('filter-active');
                }
              }
            });
          });
        } else {
          // Remover todos os realces
          document.querySelectorAll('.filter-active').forEach(el => {
            el.classList.remove('filter-active');
          });
        }
      }
      
      // FunÃ§Ã£o movida para scripts/filters.js
      // Alias para compatibilidade
      function updatePageTitle() {
        if (window.filters?.updatePageTitle) {
          return window.filters.updatePageTitle();
        }
        // Fallback
        const pageTitleEl = document.getElementById('pageTitle');
        if (!pageTitleEl) return;
        
        if (window.globalFilters.filters.length > 0) {
          const filterText = window.globalFilters.filters.map(f => {
            const fieldName = f.field === 'Orgaos' ? 'Ã“rgÃ£o' : 
                             f.field === 'Status' ? 'Status' :
                             f.field === 'Tema' ? 'Tema' :
                             f.field === 'Secretaria' ? 'Secretaria' :
                             f.field === 'Bairro' ? 'Bairro' :
                             f.field === 'Assunto' ? 'Assunto' :
                             f.field;
            return `${fieldName}: ${f.value}`;
          }).join(' â€¢ ');
          
          pageTitleEl.innerHTML = `
            <div class="flex items-center gap-2">
              <span>ğŸ“Š</span>
              <span>Filtrado por: <span class="text-cyan-300 font-semibold">${filterText}</span></span>
            </div>
          `;
          pageTitleEl.classList.add('filter-active-title');
        } else {
          pageTitleEl.innerHTML = '';
          pageTitleEl.classList.remove('filter-active-title');
        }
      }

      // FunÃ§Ã£o para limpar todos os filtros (global)
      window.clearGlobalFilters = function() {
        window.globalFilters.filters = [];
        window.globalFilters.activeField = null;
        window.globalFilters.activeValue = null;
        
        // Limpar localStorage
        try {
          localStorage.removeItem('dashboardFilters');
        } catch (e) {
          console.warn('Erro ao limpar filtros do localStorage:', e);
        }
        
        updateFilterIndicator();
        updatePageTitle();
        updateAllFilterHighlights();
        reloadAllData();
        
        // Feedback visual
        const feedback = document.createElement('div');
        feedback.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 z-50';
        feedback.innerHTML = `
          <div class="glass rounded-xl p-4 border border-emerald-500/50 shadow-lg">
            <div class="flex items-center gap-3">
              <div class="text-2xl">âœ¨</div>
              <div class="text-emerald-300 font-bold text-sm">Filtros Limpos</div>
            </div>
          </div>
        `;
        document.body.appendChild(feedback);
        setTimeout(() => {
          feedback.style.opacity = '0';
          feedback.style.transition = 'opacity 0.3s';
          setTimeout(() => feedback.remove(), 300);
        }, 2000);
      }

      // FunÃ§Ã£o movida para scripts/filters.js
      // Alias para compatibilidade
      function updateFilterIndicator() {
        if (window.filters?.updateFilterIndicator) {
          return window.filters.updateFilterIndicator();
        }
        // Fallback
        const indicator = document.getElementById('filterIndicator');
        if (!indicator) return;
        
        if (window.globalFilters.filters.length > 0) {
          const filterText = window.globalFilters.filters.map(f => {
            const fieldName = f.field === 'Orgaos' ? 'Ã“rgÃ£o' : 
                             f.field === 'Status' ? 'Status' :
                             f.field === 'Tema' ? 'Tema' :
                             f.field === 'Secretaria' ? 'Secretaria' :
                             f.field === 'Bairro' ? 'Bairro' :
                             f.field === 'Assunto' ? 'Assunto' :
                             f.field;
            return `<span class="font-semibold">${fieldName}</span>: <span class="text-cyan-200">${f.value}</span>`;
          }).join(', ');
          
          indicator.innerHTML = `
            <div class="flex items-center gap-3 px-4 py-2 rounded-xl glass border border-cyan-500/40 shadow-lg backdrop-blur-sm">
              <div class="flex items-center gap-2">
                <span class="text-2xl animate-pulse">ğŸ”</span>
                <div class="flex flex-col">
                  <span class="text-cyan-300 text-xs font-semibold uppercase tracking-wider">Filtro Inteligente Ativo</span>
              <span class="text-slate-200 text-sm">${filterText}</span>
                </div>
              </div>
              <button onclick="clearGlobalFilters()" 
                      class="ml-2 px-3 py-1.5 rounded-lg bg-rose-500/20 hover:bg-rose-500/30 border border-rose-500/30 hover:border-rose-500/50 text-rose-300 hover:text-rose-100 text-sm font-bold transition-all cursor-pointer">
                âœ• Limpar
              </button>
            </div>
          `;
          indicator.classList.remove('hidden');
        } else {
          indicator.classList.add('hidden');
        }
      }

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function reloadAllData() {
        if (window.data?.reloadAllData) {
          return await window.data.reloadAllData();
        }
        // Fallback se mÃ³dulo nÃ£o carregou
        console.warn('MÃ³dulo data nÃ£o carregado');
      }

      // FunÃ§Ãµes removidas - jÃ¡ implementadas em scripts/api.js
      // Usar window.api.fetchJSONWithFilters ou window.api.fetchJSONWithFilter

      // ========== Carregamento da VisÃ£o Geral ==========
      // FunÃ§Ãµes movidas para scripts/data.js
      // Aliases para compatibilidade
      async function loadAIInsights() {
        if (window.data?.loadAIInsights) {
          return await window.data.loadAIInsights();
        }
        // Fallback
        try {
          const data = await fetchJSONWithFilter('/api/ai/insights').catch(() => ({ insights: [], geradoPorIA: false }));
          
          const insightsAIBox = document.getElementById('insightsAIBox');
          if (!insightsAIBox) return;
          
          if (!data.insights || data.insights.length === 0) {
            insightsAIBox.innerHTML = '<div class="text-center text-slate-400 py-4">Nenhum insight disponÃ­vel no momento.</div>';
            return;
          }
          
          const severidadeColors = {
            alta: 'border-red-500/50 bg-red-500/10',
            media: 'border-amber-500/50 bg-amber-500/10',
            baixa: 'border-blue-500/50 bg-blue-500/10'
          };
          
          const tipoIcons = {
            anomalia: 'âš ï¸',
            tendencia: 'ğŸ“ˆ',
            volume: 'ğŸ“Š',
            tempo: 'â±ï¸'
          };
          
          insightsAIBox.innerHTML = data.insights.map(insight => `
            <div class="glass rounded-xl p-4 border ${severidadeColors[insight.severidade] || 'border-white/10'} hover:border-white/20 transition-all">
              <div class="flex items-start gap-3">
                <div class="text-2xl">${tipoIcons[insight.tipo] || 'ğŸ’¡'}</div>
                <div class="flex-1">
                  <div class="font-semibold text-emerald-300 mb-2">${insight.insight}</div>
                  <div class="text-sm text-slate-400 mt-2">
                    <div class="font-medium text-cyan-300 mb-1">ğŸ’¡ RecomendaÃ§Ã£o:</div>
                    <div>${insight.recomendacao}</div>
                  </div>
                  ${data.geradoPorIA ? '<div class="text-xs text-slate-500 mt-2">âœ¨ Gerado por IA</div>' : ''}
                </div>
              </div>
            </div>
          `).join('');
        } catch (error) {
          console.error('âŒ Erro ao carregar insights com IA:', error);
          const insightsAIBox = document.getElementById('insightsAIBox');
          if (insightsAIBox) {
            insightsAIBox.innerHTML = '<div class="text-center text-red-400 py-4">Erro ao carregar insights. Tente novamente.</div>';
          }
        }
      }

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadStatusOverview() {
        if (window.data?.loadStatusOverview) {
          return await window.data.loadStatusOverview();
        }
        // Fallback
        try {
          const statusData = await fetchJSONWithFilter('/api/stats/status-overview').catch(() => null);
          const statusCards = document.getElementById('statusOverviewCards');
          if (!statusCards) return;
          
          if (!statusData || !statusData.total) {
            statusCards.innerHTML = '<div class="text-center text-slate-400 py-4">Nenhum dado disponÃ­vel</div>';
            return;
          }
          
          const cards = [
            {
              label: 'Total',
              value: statusData.total?.quantidade || 0,
              color: 'cyan',
              icon: 'ğŸ“Š'
            },
            {
              label: 'ConcluÃ­das',
              value: statusData.concluida?.quantidade || 0,
              percent: statusData.concluida?.percentual || 0,
              color: 'emerald',
              icon: 'âœ…'
            },
            {
              label: 'Em Atendimento',
              value: statusData.emAtendimento?.quantidade || 0,
              percent: statusData.emAtendimento?.percentual || 0,
              color: 'amber',
              icon: 'â³'
            },
            {
              label: 'Pendentes',
              value: statusData.pendente?.quantidade || 0,
              percent: statusData.pendente?.percentual || 0,
              color: 'rose',
              icon: 'ğŸ“‹'
            }
          ];
          
          const colorClasses = {
            cyan: { border: 'border-cyan-500/20', borderHover: 'hover:border-cyan-500/40', text: 'text-cyan-300' },
            emerald: { border: 'border-emerald-500/20', borderHover: 'hover:border-emerald-500/40', text: 'text-emerald-300' },
            amber: { border: 'border-amber-500/20', borderHover: 'hover:border-amber-500/40', text: 'text-amber-300' },
            rose: { border: 'border-rose-500/20', borderHover: 'hover:border-rose-500/40', text: 'text-rose-300' }
          };
          
          statusCards.innerHTML = cards.map(card => {
            const colors = colorClasses[card.color] || colorClasses.cyan;
            // Mapear labels para campos de filtro
            const filterFieldMap = {
              'Total': null, // NÃ£o filtra por total
              'ConcluÃ­das': 'Status',
              'Em Atendimento': 'Status',
              'Pendentes': 'Status'
            };
            const filterField = filterFieldMap[card.label];
            const canFilter = filterField !== null;
            
            const isActive = window.globalFilters.filters.some(f => f.field === filterField && f.value === card.label);
            const cardId = `status-card-${card.label.replace(/\s+/g, '-').toLowerCase()}`;
            
            return `
            <div id="${cardId}" class="glass rounded-xl p-4 border ${colors.border} ${colors.borderHover} transition-all ${canFilter ? 'cursor-pointer hover:scale-105 active:scale-95' : ''} ${isActive ? 'filter-active border-cyan-500/60 bg-cyan-500/10' : ''}" 
                 ${canFilter ? `onclick="const el = document.getElementById('${cardId}'); applyGlobalFilter('${filterField}', '${card.label}', null, el);"` : ''}
                 title="${canFilter ? (isActive ? 'Clique novamente para remover o filtro' : 'Clique para filtrar por ' + card.label) : ''}">
              <div class="flex items-center justify-between mb-2">
                <div class="text-xs text-slate-400 font-medium">${card.label}</div>
                <div class="flex items-center gap-2">
                  ${isActive ? '<span class="text-cyan-400 text-sm">âœ“</span>' : ''}
                <div class="text-xl">${card.icon}</div>
                </div>
              </div>
              <div class="text-2xl font-bold ${colors.text}">${(card.value || 0).toLocaleString('pt-BR')}</div>
              ${card.percent !== undefined ? `<div class="text-xs text-slate-400 mt-1">${card.percent.toFixed(1)}%</div>` : ''}
              ${canFilter ? `<div class="text-xs ${isActive ? 'text-cyan-400' : 'text-cyan-400 opacity-0 group-hover:opacity-100'} mt-2 transition-opacity">${isActive ? 'âœ“ Filtro ativo - Clique para remover' : 'ğŸ” Clique para filtrar'}</div>` : ''}
            </div>
          `;
          }).join('');
        } catch (error) {
          console.error('âŒ Erro ao carregar Status Overview:', error);
          const statusCards = document.getElementById('statusOverviewCards');
          if (statusCards) {
            statusCards.innerHTML = '<div class="text-center text-red-400 py-4">Erro ao carregar dados</div>';
          }
        }
      }

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadOverview() {
        if (window.data?.loadOverview) {
          return await window.data.loadOverview();
        }
        // Fallback se mÃ³dulo nÃ£o carregou
        console.warn('MÃ³dulo data nÃ£o carregado - loadOverview nÃ£o disponÃ­vel');
      }

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadAdvancedCharts(temas = null, orgaos = null) {
        if (window.data?.loadAdvancedCharts) {
          return await window.data.loadAdvancedCharts(temas, orgaos);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadAdvancedCharts nÃ£o disponÃ­vel');
      }

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadSankeyChart(temas, orgaos, status) {
        if (window.data?.loadSankeyChart) {
          return await window.data.loadSankeyChart(temas, orgaos, status);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadSankeyChart nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadSankeyChart_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadTreeMapChart(temas) {
        if (window.data?.loadTreeMapChart) {
          return await window.data.loadTreeMapChart(temas);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadTreeMapChart nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadTreeMapChart_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadGeographicMap(bairros) {
        if (window.data?.loadGeographicMap) {
          return await window.data.loadGeographicMap(bairros);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadGeographicMap nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadGeographicMap_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      function buildHeatmap(containerId, labels, rows) {
        if (window.data?.buildHeatmap) {
          return window.data.buildHeatmap(containerId, labels, rows);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - buildHeatmap nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _buildHeatmap_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ãµes movidas para scripts/data.js
      // Aliases para compatibilidade
      async function loadKpisWithData(sum, dailyData, byMonth = null) {
        if (window.data?.loadKpisWithData) {
          return await window.data.loadKpisWithData(sum, dailyData, byMonth);
        }
        // Fallback
        if (!byMonth) {
          byMonth = await fetchJSONWithFilter('/api/aggregate/by-month');
        }
        await renderKpis(sum, dailyData, byMonth);
      }

      async function loadKpis(defaultCountField, defaultDateField) {
        if (window.data?.loadKpis) {
          return await window.data.loadKpis(defaultCountField, defaultDateField);
        }
        // Fallback
        const [sum, dailyData, byMonth] = await Promise.all([
          fetchJSONWithFilters('/api/summary'),
          fetchJSONWithFilters('/api/aggregate/by-day').catch(() => []),
          fetchJSONWithFilter('/api/aggregate/by-month')
        ]);
        await renderKpis(sum, dailyData, byMonth);
      }

      // ImplementaÃ§Ã£o real de renderKpis (extraÃ­da para evitar loop)
      async function renderKpisImplementation(sum, dailyData, byMonth) {
        // Atualizar KPIs e adicionar handlers de clique
        const kpiTotalEl = document.getElementById('kpiTotal');
        const kpi7El = document.getElementById('kpi7');
        const kpi30El = document.getElementById('kpi30');
        
        if (kpiTotalEl) {
          kpiTotalEl.textContent = (sum.total ?? 0).toLocaleString('pt-BR');
          // KPI Total nÃ£o filtra, mas pode ser clicÃ¡vel para limpar filtros
          const kpiTotalCard = kpiTotalEl.closest('.glass');
          if (kpiTotalCard && window.globalFilters.filters.length > 0) {
            kpiTotalCard.classList.add('cursor-pointer', 'hover:scale-105', 'transition-transform');
            kpiTotalCard.onclick = () => {
              if (window.globalFilters.filters.length > 0) {
                clearGlobalFilters();
              }
            };
            kpiTotalCard.title = 'Clique para limpar filtros';
          }
        }
        
        if (kpi7El) {
          kpi7El.textContent = (sum.last7 ?? 0).toLocaleString('pt-BR');
        }
        
        if (kpi30El) {
          kpi30El.textContent = (sum.last30 ?? 0).toLocaleString('pt-BR');
        }
        
        // Calcular deltas e sparklines para Ãºltimos 7 e 30 dias
        if (dailyData && dailyData.length > 0) {
          // Ãšltimos 7 dias: comparar Ãºltimos 7 dias com os 7 dias anteriores
          const last7Days = dailyData.slice(-7);
          const prev7Days = dailyData.slice(-14, -7);
          const last7Sum = last7Days.reduce((s, d) => s + (d.count || 0), 0);
          const prev7Sum = prev7Days.reduce((s, d) => s + (d.count || 0), 0);
          const delta7 = prev7Sum > 0 ? (((last7Sum - prev7Sum) / prev7Sum) * 100).toFixed(1) : 0;
          const delta7El = document.getElementById('kpi7Delta');
          if (delta7El) delta7El.textContent = `${delta7 >= 0 ? '+' : ''}${delta7}% vs perÃ­odo anterior`;
          
          // Ãšltimos 30 dias: comparar Ãºltimos 30 dias com os 30 dias anteriores
          const last30Days = dailyData.slice(-30);
          const prev30Days = dailyData.length >= 60 ? dailyData.slice(-60, -30) : [];
          const last30Sum = last30Days.reduce((s, d) => s + (d.count || 0), 0);
          const prev30Sum = prev30Days.length > 0 ? prev30Days.reduce((s, d) => s + (d.count || 0), 0) : 0;
          const delta30 = prev30Sum > 0 ? (((last30Sum - prev30Sum) / prev30Sum) * 100).toFixed(1) : 0;
          const delta30El = document.getElementById('kpi30Delta');
          if (delta30El) delta30El.textContent = `${delta30 >= 0 ? '+' : ''}${delta30}% vs perÃ­odo anterior`;
          
          // Desenhar sparklines
          const drawSpark = (canvasId, data, color) => {
            const c = document.getElementById(canvasId);
            if (!c) return;
            const ctx = c.getContext('2d');
            ctx.clearRect(0, 0, c.width, c.height);
            const w = c.width || c.offsetWidth; 
            const h = c.height || 32;
            const max = Math.max(...data.map(d => d.count || 0), 1);
            const step = w / (data.length - 1 || 1);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            data.forEach((d, i) => {
              const x = i * step;
              const y = h - ((d.count || 0) / max) * h;
              if (i === 0) ctx.moveTo(x, y);
              else ctx.lineTo(x, y);
            });
            ctx.stroke();
          };
          
          drawSpark('spark7', last7Days, '#a78bfa');
          drawSpark('spark30', last30Days, '#34d399');
        }
        if (sum.statusCounts && sum.statusCounts.length) {
          // Cores para o grÃ¡fico (expandido para mais status)
          const colors = [
            '#22d3ee', '#a78bfa', '#34d399', '#f59e0b', '#fb7185', '#f472b6',
            '#8b5cf6', '#06b6d4', '#10b981', '#f97316', '#ec4899', '#6366f1',
            '#14b8a6', '#eab308', '#ef4444', '#84cc16', '#3b82f6', '#a855f7'
          ];
          
          // Inicializar visibilidade dos status (todos visÃ­veis por padrÃ£o)
          if (!window.statusVisibility) {
          window.statusVisibility = {};
            sum.statusCounts.forEach(status => {
              window.statusVisibility[status.status] = true;
          });
          }
          
          // FunÃ§Ã£o para atualizar o grÃ¡fico baseado na visibilidade
          const updateStatusChart = () => {
            const visibleStatuses = sum.statusCounts.filter(s => window.statusVisibility[s.status]);
            const visibleLabels = visibleStatuses.map(s => s.status);
            const visibleData = visibleStatuses.map(s => s.count);
            const visibleColors = visibleStatuses.map((s, idx) => {
              const originalIdx = sum.statusCounts.findIndex(orig => orig.status === s.status);
              return colors[originalIdx % colors.length];
            });
            
            if (window.chartStatus instanceof Chart) {
              window.chartStatus.data.labels = visibleLabels;
              window.chartStatus.data.datasets[0].data = visibleData;
              window.chartStatus.data.datasets[0].backgroundColor = visibleColors;
              window.chartStatus.update('active');
            }
          };
          
          // Monta grÃ¡fico de status inicialmente com todos os status
          const chartStatusEl = document.getElementById('chartStatus');
          if (!chartStatusEl) return;
          const ctx = chartStatusEl.getContext('2d');
          if (window.chartStatus instanceof Chart) window.chartStatus.destroy();
          window.chartStatus = new Chart(ctx, { 
            type: 'doughnut', 
            data: {
              labels: sum.statusCounts.map(s=>s.status),
              datasets: [{ 
                data: sum.statusCounts.map(s=>s.count), 
                backgroundColor: sum.statusCounts.map((s, idx) => colors[idx % colors.length])
              }]
            }, 
            options: { 
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                legend: {
                  display: false // Desabilitar legenda padrÃ£o do Chart.js
                },
                tooltip: createEnhancedTooltip(),
                datalabels: createDataLabelsConfig(true, 'doughnut')
              },
              onClick: (evt, elements) => {
                if (elements.length > 0) {
                  const idx = elements[0].index;
                  const label = window.chartStatus.data.labels[idx];
                  const value = window.chartStatus.data.datasets[0].data[idx];
                  // Aplicar filtro inteligente ao clicar (com toggle)
                  const virtualElement = { 
                    classList: { add: () => {}, remove: () => {} },
                    setAttribute: () => {},
                    removeAttribute: () => {}
                  };
                  applyGlobalFilter('Status', label, 'chartStatus', virtualElement);
                }
              }
            } 
          });
          addChartClickHandler(window.chartStatus, (label, value) => showClickFeedback(null, label, value), 'chartStatus');
          
          // Criar legenda customizada organizada com checkboxes
          const legendContainer = document.getElementById('statusLegend');
          if (legendContainer) {
            const total = sum.statusCounts.reduce((acc, s) => acc + s.count, 0);
            
            const renderLegend = () => {
              legendContainer.innerHTML = sum.statusCounts.map((status, idx) => {
                const percent = ((status.count / total) * 100).toFixed(1);
                const color = colors[idx % colors.length];
                const isVisible = window.statusVisibility[status.status];
                
                // Determinar se Ã© encerrada ou ativa (baseado em palavras-chave comuns)
                const statusLower = status.status.toLowerCase();
                const isEncerrada = statusLower.includes('concluÃ­da') || statusLower.includes('encerrada') || 
                                   statusLower.includes('finalizada') || statusLower.includes('resolvida');
                const isAtiva = statusLower.includes('em atendimento') || statusLower.includes('ativa') || 
                               statusLower.includes('pendente') || statusLower.includes('em andamento');
                
                return `
                  <div 
                    class="status-legend-item flex items-center gap-2 p-2 rounded hover:bg-white/5 transition-all cursor-pointer border ${isVisible ? 'border-transparent opacity-100' : 'border-white/20 opacity-40'}"
                    data-status="${status.status.replace(/"/g, '&quot;')}"
                  >
                    <div 
                      class="w-4 h-4 rounded flex-shrink-0 border-2 transition-all relative ${isVisible ? 'border-white/30' : 'border-white/50'}" 
                      style="background-color: ${isVisible ? color : 'transparent'}; ${!isVisible ? `border-color: ${color}; border-style: dashed;` : ''}"
                    >
                      ${isVisible ? '' : '<div class="w-full h-0.5 bg-white/50 absolute top-1/2 left-0 transform rotate-45"></div>'}
                    </div>
                    <div class="flex-1 min-w-0 ${!isVisible ? 'line-through' : ''}">
                      <div class="text-slate-300 truncate" title="${status.status}">${status.status}</div>
                      <div class="text-slate-500 text-[10px]">${status.count.toLocaleString('pt-BR')} (${percent}%)</div>
                    </div>
                  </div>
                `;
              }).join('');
              
              // Adicionar event listeners apÃ³s renderizar
              legendContainer.querySelectorAll('.status-legend-item').forEach((item) => {
                item.addEventListener('click', () => {
                  const statusName = item.getAttribute('data-status');
                  window.statusVisibility[statusName] = !window.statusVisibility[statusName];
                  updateStatusChart();
                  renderLegend();
                });
              });
            };
            
            renderLegend();
            
            // Event listeners para os botÃµes
            const btnMarcarTodos = document.getElementById('btnMarcarTodosStatus');
            const btnDesmarcarTodos = document.getElementById('btnDesmarcarTodosStatus');
            
            if (btnMarcarTodos) {
              btnMarcarTodos.addEventListener('click', () => {
                sum.statusCounts.forEach(status => {
                  window.statusVisibility[status.status] = true;
                });
                updateStatusChart();
                renderLegend();
              });
            }
            
            if (btnDesmarcarTodos) {
              btnDesmarcarTodos.addEventListener('click', () => {
                sum.statusCounts.forEach(status => {
                  window.statusVisibility[status.status] = false;
                });
                updateStatusChart();
                renderLegend();
              });
            }
          }
          
          // Remover skeleton apÃ³s carregar
          document.getElementById('chartStatus').classList.remove('skeleton');
        }
        // SÃ©rie temporal mensal 12M (usar byMonth jÃ¡ obtido)
        const monthCanvas = document.getElementById('chartMonth');
        if (monthCanvas) {
        const ctxM = monthCanvas.getContext('2d');
        if (window.chartMonth instanceof Chart) window.chartMonth.destroy();
        
        // Formatar labels do mÃªs corretamente
        const monthLabels = byMonth.map(x => {
          const ym = x.ym || x.month || '';
          if (!ym || typeof ym !== 'string') return '';
          const parts = ym.split('-');
          if (parts.length < 2) return ym;
          const [year, month] = parts;
          const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
          return month ? (monthNames[parseInt(month) - 1] + '/' + year.slice(2)) : ym;
        });
        
        window.chartMonth = new Chart(ctxM, { 
          type:'bar', 
          data:{ 
            labels: monthLabels.filter(l => l), 
            datasets:[{ 
              data: byMonth.filter(x => x.ym).map(x=>x.count), 
              backgroundColor: 'rgba(167,139,250,0.6)',
              borderColor: 'rgba(167,139,250,1)',
              borderWidth: 1
            }] 
          }, 
          options:{ 
            responsive:true,
            plugins: {
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig(false, 'bar', false)
            },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 45 }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          } 
        });
        addChartClickHandler(window.chartMonth, (label, value) => showClickFeedback(null, label, value), 'chartMonth');
        // Remover skeleton apÃ³s carregar
        monthCanvas.classList.remove('skeleton');
      }
      
      // SLA chart
      const sla = await fetchJSON('/api/sla/summary');
      const chartSlaEl = document.getElementById('chartSla');
      if (chartSlaEl) {
        const ctxS = chartSlaEl.getContext('2d');
        if (window.chartSla instanceof Chart) window.chartSla.destroy();
        window.chartSla = new Chart(ctxS, {
          type: 'bar',
          data: {
            labels: ['ConcluÃ­dos', 'Verde Claro (0-30d)', 'Amarelo (31-60d)', 'Vermelho (61+d)'],
            datasets: [{
              data: [sla.concluidos||0, sla.verdeClaro||0, sla.amarelo||0, sla.vermelho||0],
              backgroundColor: ['#059669','#86efac','#fbbf24','#fb7185'],
              borderColor: ['#059669','#86efac','#fbbf24','#fb7185'],
              borderWidth: 1
            }]
          },
          options: { 
            responsive: true, 
            plugins: { 
              legend: { display: false },
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig(false, 'bar', false)
            },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 45 }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        addChartClickHandler(window.chartSla, (label, value) => showClickFeedback(null, label, value));
        // Remover skeleton apÃ³s carregar
        chartSlaEl.classList.remove('skeleton');
      }
      } // Fim da funÃ§Ã£o renderKpisImplementation
      
      // FunÃ§Ã£o wrapper renderKpis (evita loop infinito)
      async function renderKpis(sum, dailyData, byMonth) {
        // Se jÃ¡ estamos em uma chamada do mÃ³dulo, executar implementaÃ§Ã£o direta
        if (window._renderKpisCalling) {
          return await renderKpisImplementation(sum, dailyData, byMonth);
        }
        
        // Se mÃ³dulo data.js estÃ¡ disponÃ­vel, chamar ele (que vai chamar a implementaÃ§Ã£o)
        if (window.data?.renderKpis) {
          return await window.data.renderKpis(sum, dailyData, byMonth);
        }
        
        // Fallback: executar implementaÃ§Ã£o direta
        return await renderKpisImplementation(sum, dailyData, byMonth);
      }
      
      // Exportar implementaÃ§Ã£o para uso direto
      window.renderKpisImplementation = renderKpisImplementation;

      // VariÃ¡veis movidas para scripts/data.js - usar as globais do mÃ³dulo

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadTable(limit = 50) {
        if (window.data?.loadTable) {
          return await window.data.loadTable(limit);
        }
        // Fallback
        try {
          const pageSize = limit === 'all' ? 10000 : parseInt(limit) || 50;
          const data = await fetchJSON(`/api/records?page=1&pageSize=${pageSize}`);
        const rows = data.rows || [];
          // Usar variÃ¡vel global do mÃ³dulo data.js
          if (window.data) {
            window.data.currentTableData = rows;
          }
          
        const tbody = document.getElementById('tbody');
        const thead = document.getElementById('thead');
        const tableInfo = document.getElementById('tableInfo');
        
        if (!tbody || !thead) {
          console.warn('Elementos da tabela nÃ£o encontrados (pode nÃ£o estar na pÃ¡gina atual)');
          return;
        }
        
        tbody.innerHTML = '';
        thead.innerHTML = '';
          
        if (rows.length === 0) {
          if (tableInfo) tableInfo.textContent = 'Nenhum registro encontrado';
            return;
          }
          
        const first = rows[0].data || {};
        const keys = Object.keys(first);
          currentTableHeaders = keys;
          
          // Ordenar colunas por importÃ¢ncia
          const priorityOrder = ['protocolo', 'data_da_criacao', 'status_demanda', 'tipo_de_manifestacao', 
            'tema', 'assunto', 'orgaos', 'unidade_cadastro', 'responsavel', 'canal', 'prioridade', 'status'];
          const sortedKeys = [...priorityOrder.filter(k => keys.includes(k)), ...keys.filter(k => !priorityOrder.includes(k))];
          
          for (const k of sortedKeys) {
            const th = document.createElement('th'); 
            th.textContent = k; 
            th.className = 'px-3 py-2 text-left font-semibold text-slate-300 sticky top-0 bg-slate-900/95'; 
            thead.appendChild(th);
          }
          
        for (const r of rows) {
            const tr = document.createElement('tr'); 
            tr.className = 'hover:bg-white/5 transition-colors duration-100';
            for (const k of sortedKeys) {
              const td = document.createElement('td'); 
              const value = r.data?.[k] ?? '';
              td.textContent = value; 
              td.className = 'px-3 py-2 text-slate-300'; 
              tr.appendChild(td);
          }
          tbody.appendChild(tr);
          }
          
          tableInfo.textContent = `Mostrando ${rows.length} de ${data.total || rows.length} registros`;
        } catch (error) {
          console.error('Erro ao carregar tabela:', error);
          document.getElementById('tableInfo').textContent = 'Erro ao carregar dados';
        }
      }

      // FunÃ§Ã£o melhorada de exportaÃ§Ã£o CSV
      async function exportCSV() {
        const limit = document.getElementById('exportLimit')?.value || '50';
        const pageSize = limit === 'all' ? 10000 : parseInt(limit) || 50;
        
        try {
          const data = await fetchJSON(`/api/records?page=1&pageSize=${pageSize}`);
          const rows = data.rows || [];
          
          if (rows.length === 0) {
            alert('Nenhum dado para exportar');
            return;
          }
          
          const first = rows[0].data || {};
          const keys = Object.keys(first);
          const priorityOrder = ['protocolo', 'data_da_criacao', 'status_demanda', 'tipo_de_manifestacao', 
            'tema', 'assunto', 'orgaos', 'unidade_cadastro', 'responsavel', 'canal', 'prioridade', 'status'];
          const sortedKeys = [...priorityOrder.filter(k => keys.includes(k)), ...keys.filter(k => !priorityOrder.includes(k))];
          
          const headers = sortedKeys;
          const csvRows = rows.map(r => sortedKeys.map(k => r.data?.[k] ?? ''));
          const all = [headers, ...csvRows];
          
          const csv = all.map(r => r.map(v => {
            const str = String(v || '').replaceAll('"', '""');
            return `"${str}"`;
          }).join(',')).join('\n');
          
          // Adicionar BOM para Excel reconhecer UTF-8
          const BOM = '\uFEFF';
          const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); 
          a.href = url; 
          a.download = `ouvidoria_export_${new Date().toISOString().split('T')[0]}.csv`; 
          a.click(); 
          URL.revokeObjectURL(url);
        } catch (error) {
          console.error('Erro ao exportar CSV:', error);
          alert('Erro ao exportar CSV: ' + error.message);
        }
      }

      // FunÃ§Ã£o de exportaÃ§Ã£o Excel (XLSX)
      async function exportExcel() {
        const limit = document.getElementById('exportLimit')?.value || '50';
        const pageSize = limit === 'all' ? 10000 : parseInt(limit) || 50;
        
        try {
          // Carregar biblioteca XLSX via CDN se nÃ£o estiver disponÃ­vel
          if (typeof XLSX === 'undefined') {
            const script = document.createElement('script');
            script.src = 'https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';
            script.onload = () => exportExcel();
            document.head.appendChild(script);
            return;
          }
          
          const data = await fetchJSON(`/api/records?page=1&pageSize=${pageSize}`);
          const rows = data.rows || [];
          
          if (rows.length === 0) {
            alert('Nenhum dado para exportar');
            return;
          }
          
          const first = rows[0].data || {};
          const keys = Object.keys(first);
          const priorityOrder = ['protocolo', 'data_da_criacao', 'status_demanda', 'tipo_de_manifestacao', 
            'tema', 'assunto', 'orgaos', 'unidade_cadastro', 'responsavel', 'canal', 'prioridade', 'status'];
          const sortedKeys = [...priorityOrder.filter(k => keys.includes(k)), ...keys.filter(k => !priorityOrder.includes(k))];
          
          // Preparar dados para Excel
          const excelData = rows.map(r => {
            const row = {};
            sortedKeys.forEach(k => {
              row[k] = r.data?.[k] ?? '';
            });
            return row;
          });
          
          // Criar workbook
          const wb = XLSX.utils.book_new();
          const ws = XLSX.utils.json_to_sheet(excelData);
          
          // Ajustar largura das colunas
          const colWidths = sortedKeys.map(k => ({
            wch: Math.max(k.length, 15)
          }));
          ws['!cols'] = colWidths;
          
          // Adicionar worksheet ao workbook
          XLSX.utils.book_append_sheet(wb, ws, 'Registros');
          
          // Gerar arquivo
          XLSX.writeFile(wb, `ouvidoria_export_${new Date().toISOString().split('T')[0]}.xlsx`);
        } catch (error) {
          console.error('Erro ao exportar Excel:', error);
          alert('Erro ao exportar Excel: ' + error.message);
        }
      }

      // FunÃ§Ã£o para exportar dados dos grÃ¡ficos
      async function exportChartData() {
        try {
          if (typeof XLSX === 'undefined') {
            const script = document.createElement('script');
            script.src = 'https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';
            script.onload = () => exportChartData();
            document.head.appendChild(script);
            return;
          }
          
          const wb = XLSX.utils.book_new();
          const date = new Date().toISOString().split('T')[0];
          
          // Dados do grÃ¡fico de contagem
          const countField = document.getElementById('countBy')?.value || 'Categoria';
          const countData = await fetchJSON(`/api/aggregate/count-by?field=${encodeURIComponent(countField)}`);
          const countSheet = XLSX.utils.aoa_to_sheet([
            [`Contagem por ${countField}`],
            ['Item', 'Quantidade'],
            ...countData.map(d => [d.key, d.count])
          ]);
          XLSX.utils.book_append_sheet(wb, countSheet, `Contagem_${countField}`);
          
          // Dados da sÃ©rie temporal
          const timeField = document.getElementById('dateField')?.value || 'Data';
          const timeData = await fetchJSON(`/api/aggregate/time-series?field=${encodeURIComponent(timeField)}`);
          const timeSheet = XLSX.utils.aoa_to_sheet([
            [`SÃ©rie Temporal - ${timeField}`],
            ['Data', 'Quantidade'],
            ...timeData.map(d => [d.date, d.count])
          ]);
          XLSX.utils.book_append_sheet(wb, timeSheet, `Serie_Temporal`);
          
          // Dados mensais
          const monthData = await fetchJSON('/api/aggregate/by-month');
          const monthSheet = XLSX.utils.aoa_to_sheet([
            ['Registros por MÃªs'],
            ['MÃªs', 'Quantidade'],
            ...monthData.map(d => [d.ym, d.count])
          ]);
          XLSX.utils.book_append_sheet(wb, monthSheet, 'Mensal');
          
          // Heatmap
          const heatmapDim = document.getElementById('heatmapDim')?.value || 'Categoria';
          const heatmapData = await fetchJSON(`/api/aggregate/heatmap?dim=${encodeURIComponent(heatmapDim)}`);
          const heatmapRows = [
            [heatmapDim, ...heatmapData.labels],
            ...heatmapData.rows.map(r => [r.key, ...r.values])
          ];
          const heatmapSheet = XLSX.utils.aoa_to_sheet(heatmapRows);
          XLSX.utils.book_append_sheet(wb, heatmapSheet, `Heatmap_${heatmapDim}`);
          
          XLSX.writeFile(wb, `ouvidoria_graficos_${date}.xlsx`);
        } catch (error) {
          console.error('Erro ao exportar dados dos grÃ¡ficos:', error);
          alert('Erro ao exportar dados dos grÃ¡ficos: ' + error.message);
        }
      }

      // FunÃ§Ã£o para exportar resumo executivo
      async function exportSummary() {
        try {
          if (typeof XLSX === 'undefined') {
            const script = document.createElement('script');
            script.src = 'https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';
            script.onload = () => exportSummary();
            document.head.appendChild(script);
            return;
          }
          
          const summary = await fetchJSONWithFilter('/api/summary');
          const sla = await fetchJSONWithFilter('/api/sla/summary');
          const statusOverview = await fetchJSONWithFilter('/api/stats/status-overview');
          
          const wb = XLSX.utils.book_new();
          const date = new Date().toISOString().split('T')[0];
          
          // Resumo Executivo
          const summarySheet = XLSX.utils.aoa_to_sheet([
            ['RESUMO EXECUTIVO - OUVIDORIA DUQUE DE CAXIAS'],
            ['Data de ExportaÃ§Ã£o', date],
            [''],
            ['INDICADORES GERAIS'],
            ['Total de Registros', summary.total],
            ['Ãšltimos 7 dias', summary.last7],
            ['Ãšltimos 30 dias', summary.last30],
            [''],
            ['STATUS PRINCIPAL'],
            ...summary.statusCounts.slice(0, 10).map(s => [s.status, s.count]),
            [''],
            ['SLA - Status dos Pedidos'],
            ['ConcluÃ­dos (Verde Escuro)', sla.concluidos || 0],
            ['Verde Claro (0-30 dias)', sla.verdeClaro || 0],
            ['Amarelo (31-60 dias)', sla.amarelo || 0],
            ['Vermelho (61+ dias - Atraso)', sla.vermelho || 0],
            [''],
            ['STATUS GERAL'],
            ['Total', statusOverview.total],
            ['ConcluÃ­das', statusOverview.concluida?.quantidade || 0, `${statusOverview.concluida?.percentual || 0}%`],
            ['Em Atendimento', statusOverview.emAtendimento?.quantidade || 0, `${statusOverview.emAtendimento?.percentual || 0}%`]
          ]);
          XLSX.utils.book_append_sheet(wb, summarySheet, 'Resumo_Executivo');
          
          // Top Ã“rgÃ£os
          const topOrgaosSheet = XLSX.utils.aoa_to_sheet([
            ['Top Ã“rgÃ£os'],
            ['Ã“rgÃ£o', 'Quantidade'],
            ...summary.topOrgaos.map(o => [o.key, o.count])
          ]);
          XLSX.utils.book_append_sheet(wb, topOrgaosSheet, 'Top_Orgaos');
          
          // Top Tipos
          const topTiposSheet = XLSX.utils.aoa_to_sheet([
            ['Top Tipos de ManifestaÃ§Ã£o'],
            ['Tipo', 'Quantidade'],
            ...summary.topTipoManifestacao.map(t => [t.key, t.count])
          ]);
          XLSX.utils.book_append_sheet(wb, topTiposSheet, 'Top_Tipos');
          
          // Top Temas
          const topTemasSheet = XLSX.utils.aoa_to_sheet([
            ['Top Temas'],
            ['Tema', 'Quantidade'],
            ...summary.topTema.map(t => [t.key, t.count])
          ]);
          XLSX.utils.book_append_sheet(wb, topTemasSheet, 'Top_Temas');
          
          XLSX.writeFile(wb, `ouvidoria_resumo_executivo_${date}.xlsx`);
        } catch (error) {
          console.error('Erro ao exportar resumo:', error);
          alert('Erro ao exportar resumo executivo: ' + error.message);
        }
      }

      let chartCount, chartTime;

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadCountChart(field) {
        if (window.data?.loadCountChart) {
          return await window.data.loadCountChart(field);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadCountChart nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadCountChart_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadTimeChart(field) {
        if (window.data?.loadTimeChart) {
          return await window.data.loadTimeChart(field);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadTimeChart nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadTimeChart_OLD removida - cÃ³digo migrado para scripts/data.js


      // Heatmap main interactions
      const heatmapDimSelect = document.getElementById('heatmapDim');
      if (heatmapDimSelect) {
        heatmapDimSelect.addEventListener('change', async (e) => {
          try {
            const dim = e.target.value;
            const hm = await fetchJSON(`/api/aggregate/heatmap?dim=${encodeURIComponent(dim)}`);
            if (hm && hm.labels && hm.rows) {
              buildHeatmap('heatmap', hm.labels, hm.rows);
            } else {
              buildHeatmap('heatmap', [], []);
            }
          } catch (error) {
            console.error('Erro ao carregar heatmap:', error);
            buildHeatmap('heatmap', [], []);
          }
        });
      }
      
      // Menu de exportaÃ§Ã£o (com verificaÃ§Ã£o de existÃªncia dos elementos)
      const btnExport = document.getElementById('btnExport');
      const exportMenu = document.getElementById('exportMenu');
      
      if (btnExport && exportMenu) {
        btnExport.addEventListener('click', (e) => {
          e.stopPropagation();
          exportMenu.classList.toggle('hidden');
        });
        
        document.addEventListener('click', (e) => {
          if (!btnExport.contains(e.target) && !exportMenu.contains(e.target)) {
            exportMenu.classList.add('hidden');
          }
        });
      }
      
      // Eventos dos botÃµes de exportaÃ§Ã£o
      // Event listeners movidos para scripts/main.js
      // InicializaÃ§Ã£o agora Ã© feita pelo main.js via initEventListeners()
      // Manter cÃ³digo aqui apenas como fallback se main.js nÃ£o carregar
      if (!window.main) {
      const btnExportCSV = document.getElementById('btnExportCSV');
      if (btnExportCSV) {
        btnExportCSV.addEventListener('click', async () => {
            const exportMenu = document.getElementById('exportMenu');
          if (exportMenu) exportMenu.classList.add('hidden');
          await exportCSV();
        });
      }
      
      const btnExportExcel = document.getElementById('btnExportExcel');
      if (btnExportExcel) {
        btnExportExcel.addEventListener('click', async () => {
            const exportMenu = document.getElementById('exportMenu');
          if (exportMenu) exportMenu.classList.add('hidden');
          await exportExcel();
        });
      }
      
      const btnExportChartData = document.getElementById('btnExportChartData');
      if (btnExportChartData) {
        btnExportChartData.addEventListener('click', async () => {
            const exportMenu = document.getElementById('exportMenu');
          if (exportMenu) exportMenu.classList.add('hidden');
          await exportChartData();
        });
      }
      
      const btnExportSummary = document.getElementById('btnExportSummary');
      if (btnExportSummary) {
        btnExportSummary.addEventListener('click', async () => {
            const exportMenu = document.getElementById('exportMenu');
          if (exportMenu) exportMenu.classList.add('hidden');
          await exportSummary();
        });
      }
      
      const exportLimit = document.getElementById('exportLimit');
      if (exportLimit) {
        exportLimit.addEventListener('change', (e) => {
            if (window.data?.loadTable) {
              window.data.loadTable(e.target.value);
            } else if (window.loadTable) {
          loadTable(e.target.value);
            }
        });
        }
      }

      // initial load - otimizado: carregar em paralelo e de forma progressiva
        // Primeiro: KPIs (mais importante, aparece primeiro)
        loadKpis('Categoria', 'Data').then(() => {
          // Depois: carregar grÃ¡ficos e tabela em paralelo (nÃ£o bloqueiam a UI)
          Promise.all([
          loadCountChart('Categoria').catch(e => console.error('Erro ao carregar grÃ¡fico de contagem:', e)),
          loadTimeChart('Data').catch(e => console.error('Erro ao carregar grÃ¡fico temporal:', e)),
          loadTable(50).catch(e => console.error('Erro ao carregar tabela:', e)),
            fetchJSON('/api/aggregate/heatmap?dim=Categoria')
              .then(hm => {
                if (hm && hm.labels && hm.rows) {
                  buildHeatmap('heatmap', hm.labels, hm.rows);
                } else {
                  buildHeatmap('heatmap', [], []);
                }
              })
              .catch(error => {
                console.error('Erro ao carregar heatmap inicial:', error);
                buildHeatmap('heatmap', [], []);
              })
          ]).then(() => {
            console.log('âœ… Todos os dados iniciais carregados');
        });
      }).catch(e => console.error('Erro ao carregar KPIs:', e));

      // Adicionar eventos aos dropdowns - usar onchange diretamente no HTML ou aguardar DOM
      (function setupDropdowns() {
        function attachCountByEvent() {
          const countBySelect = document.getElementById('countBy');
          if (countBySelect && !countBySelect.dataset.listenerAttached) {
            countBySelect.dataset.listenerAttached = 'true';
            countBySelect.addEventListener('change', async (e) => {
              const f = e.target.value.trim() || 'Categoria';
              console.log('ğŸ”„ Dropdown contagem mudou para:', f);
              if (f) {
                try {
                  await loadCountChart(f);
                  console.log('âœ… GrÃ¡fico de contagem atualizado');
                } catch (error) {
                  console.error('âŒ Erro ao atualizar grÃ¡fico de contagem:', error);
                }
              }
            });
            console.log('âœ… Event listener adicionado ao dropdown de contagem');
          }
        }
        
        function attachDateFieldEvent() {
          const dateFieldSelect = document.getElementById('dateField');
          if (dateFieldSelect && !dateFieldSelect.dataset.listenerAttached) {
            dateFieldSelect.dataset.listenerAttached = 'true';
            dateFieldSelect.addEventListener('change', async (e) => {
              const f = e.target.value.trim() || 'Data';
              console.log('ğŸ”„ Dropdown sÃ©rie temporal mudou para:', f);
              if (f) {
                try {
                  await loadTimeChart(f);
                  console.log('âœ… GrÃ¡fico de sÃ©rie temporal atualizado');
                } catch (error) {
                  console.error('âŒ Erro ao atualizar grÃ¡fico de sÃ©rie temporal:', error);
                }
              }
            });
            console.log('âœ… Event listener adicionado ao dropdown de sÃ©rie temporal');
          }
        }
        
        // Tentar adicionar eventos imediatamente
        attachCountByEvent();
        attachDateFieldEvent();
        
        // Se nÃ£o encontrou, tentar novamente apÃ³s um pequeno delay
        if (!document.getElementById('countBy') || !document.getElementById('dateField')) {
          setTimeout(() => {
            attachCountByEvent();
            attachDateFieldEvent();
          }, 200);
        }
      })();
      
      // ========== CORA CHAT - Sistema de Chat ==========
      let chatMessages = [];
      
      // FunÃ§Ã£o para formatar data/hora
      function formatChatTime(date) {
        const now = new Date();
        const msgDate = new Date(date);
        const diffMs = now - msgDate;
        const diffMins = Math.floor(diffMs / 60000);
        
        if (diffMins < 1) return 'Agora';
        if (diffMins < 60) return `${diffMins}min atrÃ¡s`;
        if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h atrÃ¡s`;
        return msgDate.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });
      }
      
      // FunÃ§Ã£o para renderizar mensagens
      function renderMessages(containerId, messages) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = messages.map(msg => {
          const isUser = msg.sender === 'user';
          return `
            <div class="flex items-start gap-3 ${isUser ? 'flex-row-reverse' : ''}">
              ${!isUser ? `
                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0">
                  <span class="text-white text-sm font-bold">C</span>
                </div>
              ` : `
                <div class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center flex-shrink-0">
                  <span class="text-white text-xs">VocÃª</span>
                </div>
              `}
              <div class="flex-1 ${isUser ? 'text-right' : ''}">
                <div class="bg-slate-800/60 rounded-lg p-3 text-sm text-slate-200 inline-block ${isUser ? 'bg-cyan-500/20' : ''}">
                  ${!isUser ? `<div class="font-semibold text-purple-300 mb-1">Cora</div>` : ''}
                  <div>${msg.text}</div>
                </div>
                <div class="text-xs text-slate-500 mt-1 ${isUser ? 'text-right' : 'ml-1'}">${formatChatTime(msg.createdAt)}</div>
              </div>
            </div>
          `;
        }).join('');
        
        // Scroll para o final
        container.scrollTop = container.scrollHeight;
      }
      
      // FunÃ§Ã£o para enviar mensagem
      async function sendMessage(text, isWidget = false) {
        console.log('ğŸš€ sendMessage chamada', { text, isWidget });
        if (!text.trim()) {
          console.warn('âš ï¸ Texto vazio, ignorando');
          return;
        }
        
        const message = {
          text: text.trim(),
          sender: 'user',
          createdAt: new Date().toISOString()
        };
        
        console.log('ğŸ’¬ Adicionando mensagem do usuÃ¡rio', message);
        
        // Adicionar mensagem do usuÃ¡rio
        chatMessages.push(message);
        renderMessages(isWidget ? 'chatWidgetMessages' : 'chatMessages', chatMessages);
        
        // Limpar input
        const inputId = isWidget ? 'chatWidgetInput' : 'chatInput';
        const inputEl = document.getElementById(inputId);
        if (inputEl) {
          inputEl.value = '';
        }
        
        try {
          console.log('ğŸ“¡ Enviando para backend...');
          // Salvar no backend
          const response = await fetch('/api/chat/messages', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: text.trim() })
          });
          
          if (!response.ok) {
            console.error('âŒ Erro na resposta do backend', response.status);
            throw new Error('Erro ao enviar mensagem');
          }
          
          const data = await response.json();
          console.log('âœ… Resposta recebida do backend', data);
          
          // Adicionar resposta da Cora
          const coraMessage = {
            text: data.response || 'Obrigada pela sua mensagem! Como posso ajudar?',
            sender: 'cora',
            createdAt: new Date().toISOString()
          };
          
          console.log('ğŸ¤– Adicionando resposta da Cora', coraMessage);
          chatMessages.push(coraMessage);
          renderMessages(isWidget ? 'chatWidgetMessages' : 'chatMessages', chatMessages);
          
          // Salvar resposta tambÃ©m
          await fetch('/api/chat/messages', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: coraMessage.text, sender: 'cora' })
          });
        } catch (error) {
          console.error('âŒ Erro ao enviar mensagem:', error);
          const errorMsg = {
            text: 'Desculpe, ocorreu um erro. Tente novamente.',
            sender: 'cora',
            createdAt: new Date().toISOString()
          };
          chatMessages.push(errorMsg);
          renderMessages(isWidget ? 'chatWidgetMessages' : 'chatMessages', chatMessages);
        }
      }
      
      // FunÃ§Ã£o para carregar mensagens do banco
      async function loadChatMessages() {
        try {
          const response = await fetch('/api/chat/messages');
          if (response.ok) {
            const data = await response.json();
            chatMessages = data.messages || [];
            if (chatMessages.length === 0) {
              // Mensagem inicial
              chatMessages.push({
                text: 'OlÃ¡! Sou a Cora, sua assistente virtual. Como posso ajudar vocÃª hoje?',
                sender: 'cora',
                createdAt: new Date().toISOString()
              });
            }
          } else {
            chatMessages = [{
              text: 'OlÃ¡! Sou a Cora, sua assistente virtual. Como posso ajudar vocÃª hoje?',
              sender: 'cora',
              createdAt: new Date().toISOString()
            }];
          }
        } catch (error) {
          console.error('Erro ao carregar mensagens:', error);
          chatMessages = [{
            text: 'OlÃ¡! Sou a Cora, sua assistente virtual. Como posso ajudar vocÃª hoje?',
            sender: 'cora',
            createdAt: new Date().toISOString()
          }];
        }
      }
      
      // FunÃ§Ã£o para carregar pÃ¡gina do chat
      async function loadCoraChat() {
        await loadChatMessages();
        renderMessages('chatMessages', chatMessages);
      }
      
      // Inicializar widget flutuante
      function initChatWidget() {
        const toggle = document.getElementById('chatWidgetToggle');
        const window = document.getElementById('chatWidgetWindow');
        const close = document.getElementById('chatWidgetClose');
        const form = document.getElementById('chatWidgetForm');
        const input = document.getElementById('chatWidgetInput');
        const submitBtn = document.getElementById('chatWidgetSubmitBtn');
        
        if (!form || !input) {
          console.warn('Elementos do widget de chat nÃ£o encontrados');
          return;
        }
        
        console.log('âœ… Widget de chat inicializado', { form: !!form, input: !!input, submitBtn: !!submitBtn });
        
        if (toggle) {
          toggle.addEventListener('click', async () => {
            if (window.classList.contains('hidden')) {
              await loadChatMessages();
              renderMessages('chatWidgetMessages', chatMessages);
            }
            window.classList.toggle('hidden');
          });
        }
        
        if (close) {
          close.addEventListener('click', () => {
            window.classList.add('hidden');
          });
        }
        
        const sendWidgetMessage = (e) => {
          console.log('ğŸ“¤ Tentando enviar mensagem do widget', input.value);
          if (e) {
            e.preventDefault();
            e.stopPropagation();
          }
          const text = input.value.trim();
          if (text) {
            sendMessage(text, true);
            input.value = '';
          }
          return false;
        };
        
        // Adicionar listeners
        form.onsubmit = sendWidgetMessage;
        
        if (submitBtn) {
          submitBtn.onclick = sendWidgetMessage;
        }
        
        input.onkeydown = (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            console.log('âŒ¨ï¸ Enter pressionado no widget');
            e.preventDefault();
            e.stopPropagation();
            sendWidgetMessage(e);
          }
        };
        
        // Carregar mensagens iniciais
        loadChatMessages();
      }
      
      // Inicializar formulÃ¡rio da pÃ¡gina do chat
      function initChatPage() {
        const form = document.getElementById('chatForm');
        const input = document.getElementById('chatInput');
        const submitBtn = document.getElementById('chatSubmitBtn');
        
        if (!form || !input) {
          console.warn('Elementos da pÃ¡gina de chat nÃ£o encontrados');
          return;
        }
        
        console.log('âœ… PÃ¡gina de chat inicializada', { form: !!form, input: !!input, submitBtn: !!submitBtn });
        
        const sendPageMessage = (e) => {
          console.log('ğŸ“¤ Tentando enviar mensagem da pÃ¡gina', input.value);
          if (e) {
            e.preventDefault();
            e.stopPropagation();
          }
          const text = input.value.trim();
          console.log('ğŸ“ Texto capturado:', text);
          if (text) {
            console.log('âœ… Chamando sendMessage...');
            sendMessage(text, false);
          } else {
            console.warn('âš ï¸ Texto vazio, nÃ£o enviando');
          }
          return false;
        };
        
        // Adicionar listeners
        console.log('ğŸ”— Anexando listeners ao formulÃ¡rio da pÃ¡gina');
        form.onsubmit = sendPageMessage;
        
        if (submitBtn) {
          submitBtn.onclick = (e) => {
            console.log('ğŸ–±ï¸ BotÃ£o Enviar clicado');
            sendPageMessage(e);
          };
        }
        
        input.onkeydown = (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            console.log('âŒ¨ï¸ Enter pressionado na pÃ¡gina');
            e.preventDefault();
            e.stopPropagation();
            sendPageMessage(e);
          }
        };
      }
      
      // Inicializar quando o DOM estiver pronto e re-inicializar quando a pÃ¡gina do chat for carregada
      function initChat() {
        initChatWidget();
        // SÃ³ inicializar pÃ¡gina se estiver visÃ­vel
        if (document.getElementById('page-cora-chat') && document.getElementById('page-cora-chat').style.display !== 'none') {
          initChatPage();
        }
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initChat);
      } else {
        initChat();
      }
      
      // Re-inicializar quando a pÃ¡gina do chat for carregada
      const originalLoadCoraChat = loadCoraChat;
      loadCoraChat = async function() {
        await originalLoadCoraChat();
        // Aguardar um pouco para garantir que o DOM foi atualizado
        setTimeout(() => {
          console.log('ğŸ”„ Re-inicializando pÃ¡gina do chat apÃ³s loadCoraChat');
          initChatPage();
        }, 200);
      };
      
    </script>
    <script>
      // Toggle para listas suspensas de unidades
      function initUnitCategoryToggles() {
        const categoryHeaders = document.querySelectorAll('.unit-category-header');
        categoryHeaders.forEach(header => {
          // Verificar se jÃ¡ tem listener
          if (header.dataset.hasListener === 'true') return;
          header.dataset.hasListener = 'true';
          
          header.addEventListener('click', function(e) {
            e.stopPropagation();
            const category = this.getAttribute('data-category');
            const content = document.querySelector(`[data-category-content="${category}"]`);
            const arrow = this.querySelector('.unit-category-arrow');
            
            const isExpanded = this.classList.contains('expanded');
            
            if (isExpanded) {
              // Fechar
              content.style.display = 'none';
              this.classList.remove('expanded');
              arrow.style.transform = 'rotate(0deg)';
            } else {
              // Abrir
              content.style.display = 'block';
              this.classList.add('expanded');
              arrow.style.transform = 'rotate(90deg)';
            }
          });
        });
      }
      
      // Inicializar quando o DOM estiver pronto
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initUnitCategoryToggles);
      } else {
        initUnitCategoryToggles();
      }
      
      // Event listener para botÃ£o de atualizar insights
      document.addEventListener('DOMContentLoaded', () => {
        const btnRefreshInsights = document.getElementById('btnRefreshInsights');
        if (btnRefreshInsights) {
          btnRefreshInsights.addEventListener('click', async () => {
            btnRefreshInsights.disabled = true;
            btnRefreshInsights.textContent = 'â³ Atualizando...';
            try {
              // ForÃ§ar atualizaÃ§Ã£o limpando cache e recarregando
              await loadAIInsights();
            } catch (error) {
              console.error('âŒ Erro ao atualizar insights:', error);
            } finally {
              btnRefreshInsights.disabled = false;
              btnRefreshInsights.textContent = 'ğŸ”„ Atualizar';
            }
          });
        }
      });
      
      // Inicializar tambÃ©m se o DOM jÃ¡ estiver carregado
      if (document.readyState !== 'loading') {
        const btnRefreshInsights = document.getElementById('btnRefreshInsights');
        if (btnRefreshInsights) {
          btnRefreshInsights.addEventListener('click', async () => {
            btnRefreshInsights.disabled = true;
            btnRefreshInsights.textContent = 'â³ Atualizando...';
            try {
              await loadAIInsights();
            } catch (error) {
              console.error('âŒ Erro ao atualizar insights:', error);
            } finally {
              btnRefreshInsights.disabled = false;
              btnRefreshInsights.textContent = 'ğŸ”„ Atualizar';
            }
          });
        }
      }

      // NavegaÃ§Ã£o SPA movida para scripts/main.js
      // InicializaÃ§Ã£o agora Ã© feita pelo main.js via initNavigation()
      // Manter cÃ³digo aqui apenas como fallback se main.js nÃ£o carregar
      if (!window.main) {
      const sideMenu = document.getElementById('sideMenu');
        const pages = document.getElementById('pages');
        if (sideMenu && pages) {
      sideMenu.querySelectorAll('div[data-page]').forEach(btn => {
        btn.onclick = () => {
          sideMenu.querySelectorAll('div[data-page]').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
              Array.from(pages.children).forEach(page => page.style.display = 'none');
          const pageId = 'page-'+btn.getAttribute('data-page');
          const targetPage = document.getElementById(pageId);
          if (targetPage) {
            targetPage.style.display='block';
          }
          const pageName = btn.getAttribute('data-page');
          loadSection(pageName);
              if (window.filters?.updateFilterIndicator) {
                window.filters.updateFilterIndicator();
          }
          if (pageName === 'cora-chat') {
            setTimeout(() => {
              console.log('ğŸ”„ Re-inicializando pÃ¡gina do chat apÃ³s navegaÃ§Ã£o');
              if (typeof initChatPage === 'function') {
                initChatPage();
              }
            }, 300);
          }
        };
      });
        }
      }
      // FunÃ§Ã£o para carregar a pÃ¡gina Home (nÃ£o precisa carregar dados)
      // FunÃ§Ãµes movidas para scripts/main.js
      // Aliases para compatibilidade
      function loadHome() {
        if (window.main?.loadHome) {
          return window.main.loadHome();
        }
        // Fallback
        console.log('ğŸ  PÃ¡gina Home carregada');
      }
      
      // FunÃ§Ã£o movida para scripts/main.js
      // Alias otimizado
      function loadSection(page) {
        if (window.main?.loadSection) {
          return window.main.loadSection(page);
        }
        console.warn('MÃ³dulo main nÃ£o carregado - loadSection nÃ£o disponÃ­vel');
      }
      // FunÃ§Ãµes para carregar cada seÃ§Ã£o temÃ¡tica
        enableCharts(); // chamada para garantir que grÃ¡ficos nÃ£o quebrem
      
      // FunÃ§Ã£o movida para scripts/main.js
      // Alias para compatibilidade
      function initPage() {
        if (window.main?.initPage) {
          return window.main.initPage();
        }
        // Fallback - cÃ³digo original mantido temporariamente
        if (window.globalFilters?.filters?.length > 0) {
          if (window.filters?.updateFilterIndicator) {
            window.filters.updateFilterIndicator();
          }
          if (window.filters?.updatePageTitle) {
            window.filters.updatePageTitle();
          }
          console.log('ğŸ” Filtros restaurados:', window.globalFilters.filters);
        }
        
        const allPages = document.getElementById('pages');
        if (allPages) {
          Array.from(allPages.children).forEach(page => {
          if (page.id !== 'page-home') {
            page.style.display = 'none';
          }
        });
        }
        
        const homePage = document.getElementById('page-home');
        if (homePage) {
          homePage.style.display = 'block';
        }
        
        const sideMenu = document.getElementById('sideMenu');
        if (sideMenu) {
        const homeBtn = sideMenu.querySelector('[data-page="home"]');
        if (homeBtn) {
          sideMenu.querySelectorAll('div[data-page]').forEach(b => b.classList.remove('active'));
          homeBtn.classList.add('active');
          }
        }
      }
      
      // InicializaÃ§Ã£o agora Ã© feita pelo main.js
      // Manter aqui apenas para compatibilidade se main.js nÃ£o carregar
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          if (!window.main) {
            initPage();
          }
        });
      } else {
        if (!window.main) {
        initPage();
        }
      }
      
      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadOrgaoMes() {
        if (window.data?.loadOrgaoMes) {
          return await window.data.loadOrgaoMes();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadOrgaoMes nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadOrgaoMes_OLD removida - cÃ³digo migrado para scripts/data.js
      
      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadSecretariasDistritos() {
        if (window.data?.loadSecretariasDistritos) {
          return await window.data.loadSecretariasDistritos();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadSecretariasDistritos nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadSecretariasDistritos_OLD removida - cÃ³digo migrado para scripts/data.js
      
      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadSecretariasPorDistrito(distritoNome, distritoCode) {
        if (window.data?.loadSecretariasPorDistrito) {
          return await window.data.loadSecretariasPorDistrito(distritoNome, distritoCode);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadSecretariasPorDistrito nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadSecretariasPorDistrito_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadSecretaria() {
        if (window.data?.loadSecretaria) {
          return await window.data.loadSecretaria();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadSecretaria nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadSecretaria_OLD removida - cÃ³digo migrado para scripts/data.js
      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadTipo() {
        if (window.data?.loadTipo) {
          return await window.data.loadTipo();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadTipo nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadTipo_OLD removida - cÃ³digo migrado para scripts/data.js
      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadSetor() {
        if (window.data?.loadSetor) {
          return await window.data.loadSetor();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadSetor nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadSetor_OLD removida - cÃ³digo migrado para scripts/data.js
      function enableCharts() {
        // dummy para garantir que nÃ£o quebre ao carregar direto
      }

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadCategoria() {
        if (window.data?.loadCategoria) {
          return await window.data.loadCategoria();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadCategoria nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadCategoria_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadStatusPage() {
        if (window.data?.loadStatusPage) {
          return await window.data.loadStatusPage();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadStatusPage nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadStatusPage_OLD removida - cÃ³digo migrado para scripts/data.js
      
      // Gerenciar abas na pÃ¡gina de Status
      if (!window.statusTabsInitialized) {
        window.statusTabsInitialized = true;
        setTimeout(() => {
          const tabButtons = document.querySelectorAll('.tab-status');
          tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
              const tab = btn.dataset.tab;
              
              // Atualizar botÃµes
              tabButtons.forEach(b => {
                b.classList.remove('border-cyan-400', 'text-cyan-400');
                b.classList.add('border-transparent', 'text-slate-400');
              });
              btn.classList.remove('border-transparent', 'text-slate-400');
              btn.classList.add('border-cyan-400', 'text-cyan-400');
              
              // Mostrar/ocultar conteÃºdo
              document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
              });
              
              if (tab === 'status') {
                document.getElementById('status-tab-content')?.classList.remove('hidden');
              } else if (tab === 'tema') {
                document.getElementById('tema-tab-content')?.classList.remove('hidden');
              } else if (tab === 'orgao') {
                document.getElementById('orgao-tab-content')?.classList.remove('hidden');
              }
            });
          });
        }, 100);
      }

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadBairro() {
        if (window.data?.loadBairro) {
          return await window.data.loadBairro();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadBairro nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadBairro_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadUAC() {
        if (window.data?.loadUAC) {
          return await window.data.loadUAC();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadUAC nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadUAC_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadResponsavel() {
        if (window.data?.loadResponsavel) {
          return await window.data.loadResponsavel();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadResponsavel nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadResponsavel_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadCanal() {
        if (window.data?.loadCanal) {
          return await window.data.loadCanal();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadCanal nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadCanal_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadPrioridade() {
        if (window.data?.loadPrioridade) {
          return await window.data.loadPrioridade();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadPrioridade nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadPrioridade_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadTempoMedio() {
        if (window.data?.loadTempoMedio) {
          return await window.data.loadTempoMedio();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadTempoMedio nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadTempoMedio_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadTema() {
        if (window.data?.loadTema) {
          return await window.data.loadTema();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadTema nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadTema_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadAssunto() {
        if (window.data?.loadAssunto) {
          return await window.data.loadAssunto();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadAssunto nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadAssunto_OLD removida - cÃ³digo migrado para scripts/data.js

      // Sistema de filtro global unificado
      if (!window.globalFilters) {
        window.globalFilters = {
          filters: [],
          activeField: null,
          activeValue: null,
          cadastranteFilter: null // { type: 'servidor'|'unidadeCadastro', value: string }
        };
      }
      
      // FunÃ§Ã£o helper para adicionar filtros Ã s URLs
      function addFilterToUrl(url) {
        if (!window.globalFilters || !window.globalFilters.cadastranteFilter) return url;
        const filter = window.globalFilters.cadastranteFilter;
        const separator = url.includes('?') ? '&' : '?';
        return `${url}${separator}${filter.type}=${encodeURIComponent(filter.value)}`;
      }
      
      // FunÃ§Ã£o helper para fazer fetch com filtros aplicados (removida - agora Ã© alias de fetchJSONWithFilters)
      
      // FunÃ§Ã£o para aplicar filtro global de cadastrante
      window.applyGlobalCadastranteFilter = async function(filter) {
        window.globalFilters.cadastranteFilter = filter;
        
        // Atualizar indicador global
        updateGlobalFilterIndicator();
        
        // Recarregar todos os dados de todas as pÃ¡ginas
        await reloadAllDataWithCadastranteFilter();
      };
      
      // FunÃ§Ã£o para limpar filtro global
      window.clearGlobalCadastranteFilter = function() {
        window.globalFilters.cadastranteFilter = null;
        updateGlobalFilterIndicator();
        reloadAllDataWithCadastranteFilter();
      };
      
      // FunÃ§Ã£o para atualizar indicador global de filtro
      function updateGlobalFilterIndicator() {
        const indicator = document.getElementById('filterIndicator');
        if (!indicator) return;
        
        const filter = window.globalFilters.cadastranteFilter;
        if (filter) {
          const filterText = filter.type === 'servidor' ? `Servidor: ${filter.value}` : `Unidade: ${filter.value}`;
          indicator.innerHTML = `
            <div class="flex items-center gap-2 px-4 py-2 rounded-lg bg-cyan-500/20 border border-cyan-500/30 shadow-lg">
              <span class="text-cyan-300 text-sm font-semibold">ğŸ” Filtro Global Ativo:</span>
              <span class="text-slate-200 text-sm">${filterText}</span>
              <button onclick="clearGlobalCadastranteFilter()" class="ml-2 text-cyan-300 hover:text-cyan-100 text-xs px-3 py-1 rounded bg-cyan-500/30 font-bold">Limpar Filtro</button>
            </div>
          `;
          indicator.classList.remove('hidden');
        } else {
          indicator.classList.add('hidden');
        }
        
        // Atualizar tambÃ©m os filtros na pÃ¡gina de cadastrante
        updateCadastranteFiltersDisplay();
      }
      
      // FunÃ§Ã£o para atualizar exibiÃ§Ã£o de filtros na pÃ¡gina de cadastrante
      function updateCadastranteFiltersDisplay() {
        const filtrosCadastranteInfo = document.getElementById('filtrosCadastranteInfo');
        if (!filtrosCadastranteInfo) return;
        
        const filtros = [];
        
        // Filtro de cadastrante/unidade
        if (window.globalFilters?.cadastranteFilter) {
          const filter = window.globalFilters.cadastranteFilter;
          const filterText = filter.type === 'servidor' ? `Servidor: ${filter.value}` : `Unidade: ${filter.value}`;
          filtros.push(filterText);
        }
        
        // Filtros de mÃªs/data
        if (window.globalFilters?.filters && window.globalFilters.filters.length > 0) {
          window.globalFilters.filters.forEach(f => {
            if (f.field === 'Data' || f.field === 'MÃªs') {
              const meses = Array.isArray(f.value) ? f.value : [f.value];
              meses.forEach(mes => {
                if (mes && typeof mes === 'string') {
                  const parts = mes.split('-');
                  if (parts.length >= 2) {
                    const [year, month] = parts;
                    const monthNames = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
                    filtros.push(`MÃªs: ${monthNames[parseInt(month) - 1]}/${year}`);
                  } else {
                    filtros.push(`MÃªs: ${mes}`);
                  }
                }
              });
            }
          });
        }
        
        if (filtros.length > 0) {
          filtrosCadastranteInfo.innerHTML = `ğŸ” Filtros aplicados: ${filtros.join(' â€¢ ')}`;
          filtrosCadastranteInfo.classList.remove('hidden');
        } else {
          filtrosCadastranteInfo.innerHTML = '';
          filtrosCadastranteInfo.classList.add('hidden');
        }
      }
      
      // FunÃ§Ã£o para recarregar todos os dados quando filtro muda
      async function reloadAllDataWithCadastranteFilter() {
        const currentPage = document.querySelector('[data-page].active')?.getAttribute('data-page') || 'main';
        
        // Recarregar pÃ¡gina atual
        if (currentPage === 'main') await loadOverview();
        else if (currentPage === 'orgao-mes') await loadOrgaoMes();
        else if (currentPage === 'tempo-medio') await loadTempoMedio();
        else if (currentPage === 'tema') await loadTema();
        else if (currentPage === 'assunto') await loadAssunto();
        else if (currentPage === 'cadastrante') await loadCadastrante();
        else if (currentPage === 'reclamacoes') await loadReclamacoes();
        else if (currentPage === 'projecao-2026') await loadProjecao2026();
        else if (currentPage === 'secretaria') await loadSecretaria();
        else if (currentPage === 'secretarias-distritos') await loadSecretariasDistritos();
        else if (currentPage === 'tipo') await loadTipo();
        else if (currentPage === 'setor') await loadSetor();
        else if (currentPage === 'categoria') await loadCategoria();
        else if (currentPage === 'status') await loadStatusPage();
        else if (currentPage === 'bairro') await loadBairro();
        else if (currentPage === 'uac') await loadUAC();
        else if (currentPage === 'responsavel') await loadResponsavel();
        else if (currentPage === 'canal') await loadCanal();
        else if (currentPage === 'prioridade') await loadPrioridade();
      }
      
      // FunÃ§Ã£o para atualizar todos os grÃ¡ficos com dados filtrados (mantida para compatibilidade)
      window.updateCadastranteCharts = async function(filter) {
        await window.applyGlobalCadastranteFilter(filter);
        
        if (!filter) {
          // Sem filtro, recarregar pÃ¡gina completa
          await loadCadastrante();
          return;
        }
        
        // Buscar dados filtrados
        const url = `/api/aggregate/filtered?${filter.type}=${encodeURIComponent(filter.value)}`;
        const filteredData = await fetchJSON(url);
        
        // Atualizar grÃ¡fico mensal
        const labelsMes = filteredData.byMonth.map(x => {
          const ym = x.ym || x.month || '';
          if (!ym || typeof ym !== 'string') return ym || 'Data invÃ¡lida';
          const parts = ym.split('-');
          if (parts.length < 2) return ym;
          const [year, month] = parts;
          const monthNames = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
          return `${monthNames[parseInt(month) - 1]}. de ${year}`;
        });
        const valuesMes = filteredData.byMonth.map(x => x.count);
        
        if (window.chartCadastranteMes instanceof Chart) {
          window.chartCadastranteMes.data.labels = labelsMes;
          window.chartCadastranteMes.data.datasets[0].data = valuesMes;
          window.chartCadastranteMes.update();
        }
        
        // Atualizar total
        document.getElementById('totalCadastrante').textContent = (filteredData.total || 0).toLocaleString('pt-BR');
        
        // Atualizar destaque visual nas listas
        document.querySelectorAll('.servidor-item').forEach(item => {
          const servidor = item.getAttribute('data-servidor');
          const isActive = filter.type === 'servidor' && filter.value === servidor;
          if (isActive) {
            item.classList.add('bg-cyan-500/20', 'border-cyan-500/30', 'border-l-4');
            item.classList.remove('border-b');
          } else {
            item.classList.remove('bg-cyan-500/20', 'border-cyan-500/30', 'border-l-4');
            item.classList.add('border-b');
          }
        });
        
        document.querySelectorAll('.unidade-item').forEach(item => {
          const unidade = item.getAttribute('data-unidade');
          const isActive = filter.type === 'unidadeCadastro' && filter.value === unidade;
          if (isActive) {
            item.classList.add('bg-violet-500/20', 'border-violet-500/30', 'border-l-4');
            item.classList.remove('border-b');
          } else {
            item.classList.remove('bg-violet-500/20', 'border-violet-500/30', 'border-l-4');
            item.classList.add('border-b');
          }
        });
        
        // Mostrar/ocultar seÃ§Ã£o de grÃ¡ficos filtrados
        const graficosFiltrados = document.getElementById('graficosFiltrados');
        if (filter && filteredData) {
          graficosFiltrados.style.display = 'grid';
          
          // GrÃ¡fico por Tema
          if (filteredData.byTheme && filteredData.byTheme.length > 0) {
            const ctxTema = document.getElementById('chartCadastranteTema').getContext('2d');
            if (window.chartCadastranteTema instanceof Chart) window.chartCadastranteTema.destroy();
            window.chartCadastranteTema = new Chart(ctxTema, {
              type: 'bar',
              data: {
                labels: filteredData.byTheme.map(t => t.tema || 'NÃ£o informado'),
                datasets: [{
                  label: 'Quantidade',
                  data: filteredData.byTheme.map(t => t.quantidade),
                  backgroundColor: 'rgba(251, 191, 36, 0.7)',
                  borderColor: 'rgba(251, 191, 36, 1)',
                  borderWidth: 1
                }]
              },
              options: {
                indexAxis: 'y',
                responsive: true,
                plugins: {
                  legend: { display: false },
                  tooltip: createEnhancedTooltip(),
                  datalabels: createDataLabelsConfig(false, 'bar', true)
                },
                scales: {
                  x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                  y: { ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 0 }, grid: { color: 'rgba(255,255,255,0.05)' } }
                }
              }
            });
          }
          
          // GrÃ¡fico por Assunto
          if (filteredData.bySubject && filteredData.bySubject.length > 0) {
            const ctxAssunto = document.getElementById('chartCadastranteAssunto').getContext('2d');
            if (window.chartCadastranteAssunto instanceof Chart) window.chartCadastranteAssunto.destroy();
            window.chartCadastranteAssunto = new Chart(ctxAssunto, {
              type: 'bar',
              data: {
                labels: filteredData.bySubject.map(a => a.assunto || 'NÃ£o informado'),
                datasets: [{
                  label: 'Quantidade',
                  data: filteredData.bySubject.map(a => a.quantidade),
                  backgroundColor: 'rgba(236, 72, 153, 0.7)',
                  borderColor: 'rgba(236, 72, 153, 1)',
                  borderWidth: 1
                }]
              },
              options: {
                indexAxis: 'y',
                responsive: true,
                plugins: {
                  legend: { display: false },
                  tooltip: createEnhancedTooltip(),
                  datalabels: createDataLabelsConfig(false, 'bar', true)
                },
                scales: {
                  x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                  y: { ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 0 }, grid: { color: 'rgba(255,255,255,0.05)' } }
                }
              }
            });
          }
          
          // GrÃ¡fico por Status (doughnut)
          if (filteredData.byStatus && filteredData.byStatus.length > 0) {
            const ctxStatus = document.getElementById('chartCadastranteStatus').getContext('2d');
            if (window.chartCadastranteStatus instanceof Chart) window.chartCadastranteStatus.destroy();
            const colors = ['#22d3ee', '#a78bfa', '#34d399', '#f59e0b', '#fb7185', '#f472b6', '#8b5cf6', '#06b6d4'];
            window.chartCadastranteStatus = new Chart(ctxStatus, {
              type: 'doughnut',
              data: {
                labels: filteredData.byStatus.map(s => s.status || 'NÃ£o informado'),
                datasets: [{
                  data: filteredData.byStatus.map(s => s.quantidade),
                  backgroundColor: filteredData.byStatus.map((s, idx) => colors[idx % colors.length])
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { display: true, position: 'right', labels: { color: '#94a3b8', font: { size: 11 } } },
                  tooltip: createEnhancedTooltip(),
                  datalabels: createDataLabelsConfig(true, 'doughnut')
                }
              }
            });
          }
          
          // Se filtro for por servidor, mostrar unidades cadastradas
          if (filter.type === 'servidor' && filteredData.unidadesCadastradas && filteredData.unidadesCadastradas.length > 0) {
            // Criar ou atualizar seÃ§Ã£o de unidades cadastradas
            let unidadesSection = document.getElementById('unidadesCadastradasSection');
            if (!unidadesSection) {
              unidadesSection = document.createElement('div');
              unidadesSection.id = 'unidadesCadastradasSection';
              unidadesSection.className = 'col-span-12 glass rounded-2xl p-5';
              unidadesSection.innerHTML = '<h3 class="font-semibold mb-4 text-emerald-400">Unidades Cadastradas por este Servidor</h3><div id="listaUnidadesCadastradas" class="space-y-2 max-h-[400px] overflow-y-auto"></div>';
              const grid = document.querySelector('#page-cadastrante .grid');
              grid.appendChild(unidadesSection);
            }
            
            const maxCount = Math.max(...filteredData.unidadesCadastradas.map(d => d.quantidade), 1);
            document.getElementById('listaUnidadesCadastradas').innerHTML = filteredData.unidadesCadastradas.map((item, idx) => {
              const width = (item.quantidade / maxCount) * 100;
              return `
                <div class="flex items-center gap-3 py-2 border-b border-white/5">
                  <div class="text-sm text-slate-400 w-8">${idx + 1}Âº</div>
                  <div class="flex-1 min-w-0">
                    <div class="text-sm text-slate-300 truncate">${item.unidade}</div>
                    <div class="mt-1 h-2 bg-slate-800 rounded-full overflow-hidden">
                      <div class="h-full bg-gradient-to-r from-emerald-500 to-cyan-500" style="width: ${width}%"></div>
                    </div>
                  </div>
                  <div class="text-lg font-bold text-emerald-300 min-w-[80px] text-right">${item.quantidade.toLocaleString('pt-BR')}</div>
                </div>
              `;
            }).join('');
          } else {
            const unidadesSection = document.getElementById('unidadesCadastradasSection');
            if (unidadesSection) unidadesSection.remove();
          }
        } else {
          graficosFiltrados.style.display = 'none';
          const unidadesSection = document.getElementById('unidadesCadastradasSection');
          if (unidadesSection) unidadesSection.remove();
        }
        
        // Atualizar exibiÃ§Ã£o de filtros
        updateCadastranteFiltersDisplay();
      }
      
      // FunÃ§Ã£o para limpar filtro (compatibilidade)
      window.clearCadastranteFilter = function() {
        window.clearGlobalCadastranteFilter();
      };
      
      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadCadastrante() {
        if (window.data?.loadCadastrante) {
          return await window.data.loadCadastrante();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadCadastrante nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadCadastrante_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadReclamacoes() {
        if (window.data?.loadReclamacoes) {
          return await window.data.loadReclamacoes();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadReclamacoes nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadReclamacoes_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadProjecao2026() {
        if (window.data?.loadProjecao2026) {
          return await window.data.loadProjecao2026();
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadProjecao2026 nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadProjecao2026_OLD removida - cÃ³digo migrado para scripts/data.js

      // FunÃ§Ã£o movida para scripts/data.js
      // Alias para compatibilidade
      async function loadUnit(unitName) {
        if (window.data?.loadUnit) {
          return await window.data.loadUnit(unitName);
        }
        console.warn('MÃ³dulo data nÃ£o carregado - loadUnit nÃ£o disponÃ­vel');
      }
      
      // FunÃ§Ã£o _loadUnit_OLD removida - cÃ³digo migrado para scripts/data.js
    </script>
  </body>
  </html>



