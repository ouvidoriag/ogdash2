<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ouvidoria - Duque de Caxias - Dashboard</title>
    <link rel="icon" type="image/png" href="/dc-logo.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
      :root {
        --bg: #0b1020;
        --panel: #0f172a;
        --muted: #94a3b8;
        --primary: #22d3ee; /* cyan */
        --accent: #a78bfa;  /* violet */
        --success: #34d399; /* green */
        --danger: #fb7185;  /* rose */
      }
      body { background: radial-gradient(1200px 600px at top left, rgba(34,211,238,0.08), transparent 60%), radial-gradient(1200px 600px at bottom right, rgba(167,139,250,0.08), transparent 60%), var(--bg); }
      .glass { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.08); }
      .neon { text-shadow: 0 0 12px rgba(34,211,238,0.65), 0 0 24px rgba(167,139,250,0.45); }
      .glow-ring { box-shadow: 0 0 0 2px rgba(34,211,238,0.15), 0 0 32px rgba(34,211,238,0.25); }
      .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%); background-size: 400% 100%; animation: shimmer 1.4s ease infinite; }
      @keyframes shimmer { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
      canvas { max-height: 340px; }
    </style>
  </head>
  <body class="text-slate-100">
    <div class="min-h-screen grid grid-cols-12 gap-6 p-6">
      <aside class="col-span-12 lg:col-span-3 xl:col-span-2 glass rounded-2xl p-5 animate__animated animate__fadeIn">
        <div class="flex items-center gap-3 mb-6">
          <img src="/dc-logo.png" alt="Duque de Caxias" class="h-12 w-auto object-contain" />
          <div>
            <div class="text-lg font-semibold">Ouvidoria Caxias</div>
            <div class="text-xs text-slate-400">Dashboard Futurista</div>
          </div>
        </div>
        <nav id="sideMenu" class="space-y-2 text-sm">
          <div data-page="main" class="active px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Visão Geral</div>
          <div data-page="orgao-mes" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Por Órgão e Mês</div>
          <div data-page="tempo-medio" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Tempo Médio</div>
          <div data-page="tema" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Por Tema</div>
          <div data-page="assunto" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Por Assunto</div>
          <div data-page="cadastrante" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Por Cadastrante</div>
          <div data-page="reclamacoes" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Reclamações e Denúncias</div>
          <div class="mt-4 pt-4 border-t border-white/10">
            <div class="text-xs text-slate-500 mb-2 px-3">Unidades</div>
            <div data-page="unit-adao" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">ADÃO</div>
            <div data-page="unit-cer-iv" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">CER IV</div>
            <div data-page="unit-hospital-olho" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Hospital do Olho</div>
            <div data-page="unit-hospital-duque" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Hospital Duque</div>
            <div data-page="unit-hospital-infantil" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Hospital Infantil</div>
            <div data-page="unit-hospital-moacyr" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Hospital Moacyr</div>
            <div data-page="unit-maternidade-santa-cruz" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Maternidade Santa Cruz</div>
            <div data-page="unit-upa-beira-mar" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPA Beira Mar</div>
            <div data-page="unit-uph-pilar" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPH Pilar</div>
            <div data-page="unit-uph-saracuruna" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPH Saracuruna</div>
            <div data-page="unit-uph-xerem" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPH Xerém</div>
            <div data-page="unit-hospital-veterinario" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Hospital Veterinário</div>
            <div data-page="unit-upa-walter-garcia" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPA Walter Garcia</div>
            <div data-page="unit-uph-campos-eliseos" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPH Campos Elíseos</div>
            <div data-page="unit-uph-parque-equitativa" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPH Parque Equitativa</div>
            <div data-page="unit-ubs-antonio-granja" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UBS Antonio Granja</div>
            <div data-page="unit-upa-sarapui" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPA Sarapuí</div>
            <div data-page="unit-uph-imbarie" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">UPH Imbariê</div>
          </div>
          <div data-page="secretaria" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Secretarias</div>
          <div data-page="tipo" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Tipos de Manifestação</div>
          <div data-page="setor" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Setores</div>
          <div data-page="categoria" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Categorias</div>
          <div data-page="status" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Status</div>
          <div data-page="bairro" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Bairros</div>
          <div data-page="uac" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Unidades (UAC)</div>
          <div data-page="responsavel" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Responsáveis</div>
          <div data-page="canal" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Canais</div>
          <div data-page="prioridade" class="px-3 py-2 rounded-lg hover:bg-white/5 cursor-pointer">Prioridades</div>
        </nav>
        <div class="mt-8 pt-6 border-t border-white/10">
          <div class="text-xs font-semibold text-slate-300 mb-4 uppercase tracking-wider">Equipe Responsável</div>
          <div class="space-y-3 text-xs">
            <div class="pb-2 border-b border-white/5">
              <div class="text-slate-400 mb-1">Ouvidoria Geral</div>
              <div class="text-slate-200 font-medium">Edrisio Avelino</div>
              <div class="text-slate-500 text-[10px] mt-0.5">Ouvidor Geral</div>
            </div>
            <div class="space-y-2">
              <div>
                <div class="text-slate-200 font-medium">Nilton Quaresma</div>
                <div class="text-slate-500 text-[10px]">Diretor de Ouvidoria</div>
              </div>
              <div>
                <div class="text-slate-200 font-medium">David Freitas</div>
                <div class="text-slate-500 text-[10px]">Diretor de Análise de Dados</div>
              </div>
            </div>
            <div class="pt-2 mt-2 border-t border-white/5">
              <div class="text-slate-400 mb-2 text-[10px] uppercase tracking-wide">Analistas de Ouvidoria</div>
              <div class="space-y-1 text-slate-300">
                <div class="text-[11px]">• Nikolas Brian</div>
                <div class="text-[11px]">• Rildo Luiz</div>
                <div class="text-[11px]">• Wellington Ribeiro</div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <main id="pages" class="col-span-12 lg:col-span-9 xl:col-span-10 space-y-6">
        <!-- Painel principal: Visão Geral -->
        <section id="page-main">
          <header class="glass rounded-2xl p-6 relative overflow-hidden">
            <div class="absolute inset-0 opacity-30" style="background: radial-gradient(600px 200px at 10% 0%, rgba(34,211,238,0.25), transparent 60%), radial-gradient(600px 200px at 90% 100%, rgba(167,139,250,0.25), transparent 60%)"></div>
            <div class="relative flex flex-wrap items-center justify-between gap-4">
              <div class="flex items-center gap-4">
                <img src="/dc-logo.png" alt="Duque de Caxias" class="h-16 w-auto object-contain" />
              <div>
                <h1 class="text-2xl font-bold neon">Análise avançada de ouvidorias</h1>
                <p class="text-slate-400">• Edrisio Avelino • Ouvidor Geral •</p>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <div class="flex items-center gap-2">
                  <label class="text-sm text-slate-400 whitespace-nowrap">Contagem por:</label>
                  <select id="countBy" onchange="if(this.value) loadCountChart(this.value)" class="bg-slate-900/60 border border-white/10 rounded-lg px-3 py-2 text-sm text-slate-300 focus:outline-none glow-ring cursor-pointer hover:bg-slate-800/60 transition-colors">
                    <option value="Secretaria">Secretaria</option>
                    <option value="Setor">Setor</option>
                    <option value="Tipo">Tipo</option>
                    <option value="Categoria" selected>Categoria</option>
                    <option value="Bairro">Bairro</option>
                    <option value="Status">Status</option>
                    <option value="UAC">UAC</option>
                    <option value="Responsavel">Responsável</option>
                    <option value="Canal">Canal</option>
                    <option value="Prioridade">Prioridade</option>
                    <option value="Tema">Tema</option>
                    <option value="Assunto">Assunto</option>
                    <option value="Servidor">Servidor</option>
                  </select>
                </div>
                <div class="flex items-center gap-2">
                  <label class="text-sm text-slate-400 whitespace-nowrap">Série temporal:</label>
                  <select id="dateField" onchange="if(this.value) loadTimeChart(this.value)" class="bg-slate-900/60 border border-white/10 rounded-lg px-3 py-2 text-sm text-slate-300 focus:outline-none glow-ring cursor-pointer hover:bg-slate-800/60 transition-colors">
                    <option value="Data" selected>Data</option>
                    <option value="Data Abertura">Data Abertura</option>
                    <option value="Data Conclusão">Data Conclusão</option>
                    <option value="Abertura">Abertura</option>
                  </select>
                </div>
              </div>
            </div>
          </header>

        <section class="grid grid-cols-12 gap-6">
          <div class="col-span-12 md:col-span-3 glass rounded-2xl p-5 animate__animated animate__fadeInUp">
            <div class="text-slate-400 text-sm">Total</div>
            <div id="kpiTotal" class="text-3xl font-extrabold mt-2">—</div>
            <div class="text-xs text-slate-500">Registros na base</div>
          </div>
          <div class="col-span-12 md:col-span-3 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-1s">
            <div class="text-slate-400 text-sm">Últimos 7 dias</div>
            <div id="kpi7" class="text-3xl font-extrabold mt-2">—</div>
            <div class="text-xs text-slate-500">Tendência semanal</div>
          </div>
          <div class="col-span-12 md:col-span-3 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-2s">
            <div class="text-slate-400 text-sm">Últimos 30 dias</div>
            <div id="kpi30" class="text-3xl font-extrabold mt-2">—</div>
            <div class="text-xs text-slate-500">Tendência mensal</div>
          </div>
          <div class="col-span-12 md:col-span-3 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-3s">
            <div class="text-slate-400 text-sm">Status principal</div>
            <div id="kpiTopStatus" class="text-3xl font-extrabold mt-2">—</div>
            <div class="text-xs text-slate-500">Situação mais frequente</div>
          </div>
        </section>

          <section class="grid grid-cols-12 gap-6">
            <div class="col-span-12 xl:col-span-6 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-semibold text-slate-200">Contagem por campo</h3>
              </div>
            <div class="rounded-xl overflow-hidden bg-slate-900/30">
              <canvas id="chartCount" class="skeleton"></canvas>
            </div>
            </div>
            <div class="col-span-12 xl:col-span-6 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-semibold text-slate-200">Série temporal</h3>
              </div>
              <div class="rounded-xl overflow-hidden bg-slate-900/30">
                <canvas id="chartTime" class="skeleton"></canvas>
              </div>
            </div>
          </section>
          <!-- Heatmap Geral: Mês x Categoria -->
          <section class="grid grid-cols-12 gap-6">
            <div class="col-span-12 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-semibold text-slate-200">Heatmap por Mês x Categoria (Top 10)</h3>
                <div>
                  <select id="heatmapDim" class="bg-slate-900/60 border border-white/10 rounded-lg px-3 py-2 text-sm glow-ring">
                    <option>Categoria</option>
                    <option>Secretaria</option>
                    <option>Setor</option>
                    <option>Tipo</option>
                    <option>Status</option>
                    <option>Bairro</option>
                    <option>UAC</option>
                    <option>Responsavel</option>
                    <option>Canal</option>
                    <option>Prioridade</option>
                  </select>
                </div>
              </div>
              <div id="heatmap" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </section>
        <section class="grid grid-cols-12 gap-6">
          <div class="col-span-12 xl:col-span-6 glass rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold text-slate-200">Distribuição por Status</h3>
            </div>
            <div class="rounded-xl overflow-hidden bg-slate-900/30">
              <canvas id="chartStatus" class="skeleton"></canvas>
            </div>
          </div>
          <div class="col-span-12 xl:col-span-6 glass rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold text-slate-200">Registros por Mês (12M)</h3>
            </div>
            <div class="rounded-xl overflow-hidden bg-slate-900/30">
              <canvas id="chartMonth" class="skeleton"></canvas>
            </div>
          </div>
        </section>
        <section class="grid grid-cols-12 gap-6">
          <div class="col-span-12 glass rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold text-slate-200">SLA (e-SIC e Outros)</h3>
            </div>
            <div class="rounded-xl overflow-hidden bg-slate-900/30">
              <canvas id="chartSla" class="skeleton"></canvas>
            </div>
          </div>
        </section>

          <section class="glass rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold text-slate-200">Tabela (primeiros registros)</h3>
              <button id="btnExport" class="px-3 py-2 text-sm rounded-lg bg-emerald-500/20 text-emerald-300 hover:bg-emerald-500/30 glow-ring">Exportar CSV</button>
            </div>
            <div class="overflow-auto rounded-xl border border-white/10">
              <table class="min-w-full text-sm">
                <thead class="bg-slate-900/40">
                  <tr id="thead"></tr>
                </thead>
                <tbody id="tbody" class="divide-y divide-white/5"></tbody>
              </table>
            </div>
          </section>
        </section>
        <!-- Página por Categoria -->
        <section id="page-categoria" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Categorias</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-fuchsia-400">Top Categorias</h3>
              <canvas id="chartCategoria"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-fuchsia-400">Heatmap Mês x Categoria</h3>
              <div id="heatmapCategoria" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- Página por Status -->
        <section id="page-status" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Status</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-sky-400">Distribuição por Status</h3>
              <canvas id="chartStatusPage"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-sky-400">Heatmap Mês x Status</h3>
              <div id="heatmapStatus" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- Página por Bairro -->
        <section id="page-bairro" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Bairros</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-amber-400">Top Bairros</h3>
              <canvas id="chartBairro"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-amber-400">Heatmap Mês x Bairro</h3>
              <div id="heatmapBairro" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- Página Por Órgão e Mês (alinhado com Looker Studio) -->
        <section id="page-orgao-mes" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Por Órgão e Mês</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <!-- Painel Esquerdo: Manifestações por Órgão -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-xl text-cyan-400">Manifestações por Órgão</h3>
                <div class="text-xs text-slate-400">Total de órgãos: <span id="totalOrgaos">—</span></div>
              </div>
              <div class="space-y-2 max-h-[600px] overflow-y-auto">
                <div id="listaOrgaos" class="space-y-1">
                  <!-- Será preenchido dinamicamente -->
                </div>
              </div>
              <div class="mt-6 pt-4 border-t border-white/10">
                <div class="text-xs text-slate-400 mb-2">INDICADORES</div>
                <div class="flex items-center gap-3">
                  <img src="/dc-logo.png" alt="Duque de Caxias" class="h-8 w-auto object-contain" />
                  <div class="text-xs text-slate-300">FALA CIDADÃO!</div>
                </div>
              </div>
            </div>
            
            <!-- Painel Direito: Manifestações por Mês -->
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-xl text-violet-400">Manifestações por Mês</h3>
              </div>
              <div class="mb-6">
                <canvas id="chartOrgaoMes"></canvas>
              </div>
              <!-- KPI Total -->
              <div class="mt-6 glass rounded-xl p-6 text-center" style="background: linear-gradient(135deg, rgba(34,211,238,0.15), rgba(167,139,250,0.15));">
                <div class="text-sm text-slate-400 mb-2">Manifestações</div>
                <div id="totalOrgaoMes" class="text-5xl font-extrabold text-cyan-300 mb-2">—</div>
                <div class="text-xs text-slate-400">TOTAL CADASTRADAS ATÉ O MOMENTO</div>
              </div>
            </div>
          </div>
        </section>
        <!-- Página por Secretaria -->
        <section id="page-secretaria" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Análise por Secretaria (Órgão)</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__faster">
              <h3 class="font-semibold mb-2 text-cyan-400">Registros por Secretaria</h3>
              <canvas id="chartSecretaria"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-1s">
              <h3 class="font-semibold mb-2 text-cyan-400">Top 10 Secretarias (Rank)</h3>
              <ul id="rankSecretaria" class="space-y-2"></ul>
            </div>
          </div>
        </section>
        <!-- Página por Tipo de Manifestação -->
        <section id="page-tipo" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Tipos de Manifestação</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__faster">
              <h3 class="font-semibold mb-2 text-violet-400">Distribuição por Tipo (Reclamação/Elogio/...)</h3>
              <canvas id="chartTipo"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-1s">
              <h3 class="font-semibold mb-2 text-violet-400">Top Tipos (Rank)</h3>
              <ul id="rankTipo" class="space-y-2"></ul>
            </div>
          </div>
        </section>
        <!-- Página por Setor -->
        <section id="page-setor" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Análise por Setor/Departamento</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__faster">
              <h3 class="font-semibold mb-2 text-emerald-400">Registros por Setor</h3>
              <canvas id="chartSetor"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-1s">
              <h3 class="font-semibold mb-2 text-emerald-400">Top 10 Setores (Rank)</h3>
              <ul id="rankSetor" class="space-y-2"></ul>
            </div>
          </div>
        </section>
        <!-- Página por UAC (Unidade de Atendimento ao Cidadão) -->
        <section id="page-uac" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Unidades de Atendimento ao Cidadão (UAC)</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__faster">
              <h3 class="font-semibold mb-2 text-cyan-400">Total por UAC</h3>
              <canvas id="chartUAC"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-1s">
              <h3 class="font-semibold mb-2 text-cyan-400">Top 10 UACs (Rank)</h3>
              <ul id="rankUAC" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-cyan-400">Heatmap Mês x UAC</h3>
              <div id="heatmapUAC" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- Página por Responsáveis -->
        <section id="page-responsavel" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Responsáveis pelo Tratamento da Demanda</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__faster">
              <h3 class="font-semibold mb-2 text-violet-400">Distribuição por Responsável</h3>
              <canvas id="chartResponsavel"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-1s">
              <h3 class="font-semibold mb-2 text-violet-400">Top Responsáveis (Rank)</h3>
              <ul id="rankResponsavel" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-violet-400">Heatmap Mês x Responsável</h3>
              <div id="heatmapResponsavel" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- Página por Canal -->
        <section id="page-canal" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Canais de Atendimento</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__faster">
              <h3 class="font-semibold mb-2 text-emerald-400">Distribuição por Canal</h3>
              <canvas id="chartCanal"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-1s">
              <h3 class="font-semibold mb-2 text-emerald-400">Top Canais (Rank)</h3>
              <ul id="rankCanal" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-emerald-400">Heatmap Mês x Canal</h3>
              <div id="heatmapCanal" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- Página por Prioridade -->
        <section id="page-prioridade" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Prioridades das Demandas</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__faster">
              <h3 class="font-semibold mb-2 text-rose-400">Distribuição por Prioridade</h3>
              <canvas id="chartPrioridade"></canvas>
            </div>
            <div class="col-span-12 md:col-span-6 glass rounded-2xl p-5 animate__animated animate__fadeInUp animate__delay-1s">
              <h3 class="font-semibold mb-2 text-rose-400">Ranking de Prioridades</h3>
              <ul id="rankPrioridade" class="space-y-2"></ul>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-2 text-rose-400">Heatmap Mês x Prioridade</h3>
              <div id="heatmapPrioridade" class="overflow-auto rounded-xl border border-white/10"></div>
            </div>
          </div>
        </section>
        <!-- Página Tempo Médio de Atendimento -->
        <section id="page-tempo-medio" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Tempo Médio de Atendimento / Dias</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Tempo Médio por Órgão/Unidade</h3>
              <canvas id="chartTempoMedio"></canvas>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Ranking</h3>
              <div id="listaTempoMedio" class="space-y-2 max-h-[500px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Filtro / Mês</h3>
              <canvas id="chartTempoMedioMes"></canvas>
            </div>
          </div>
        </section>
        <!-- Página Por Tema -->
        <section id="page-tema" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Manifestações por Tema</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Distribuição por Tema</h3>
              <canvas id="chartTema"></canvas>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-violet-400">Status Geral</h3>
              </div>
              <canvas id="chartStatusTema"></canvas>
              <div id="statusTemaInfo" class="mt-4 space-y-2 text-sm"></div>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Filtro / Mês</h3>
              <canvas id="chartTemaMes"></canvas>
            </div>
          </div>
        </section>
        <!-- Página Por Assunto -->
        <section id="page-assunto" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total por Assunto</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-emerald-400">Top Assuntos</h3>
              <canvas id="chartAssunto"></canvas>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-emerald-400">Status</h3>
              </div>
              <canvas id="chartStatusAssunto"></canvas>
              <div id="statusAssuntoInfo" class="mt-4 space-y-2 text-sm"></div>
            </div>
            <div class="col-span-12 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-emerald-400">Lista Completa de Assuntos</h3>
              <div id="listaAssuntos" class="space-y-2 max-h-[500px] overflow-y-auto"></div>
            </div>
          </div>
        </section>
        <!-- Página Por Cadastrante -->
        <section id="page-cadastrante" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Por Cadastrante / Unidade</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Por Servidor</h3>
              <div id="listaServidores" class="space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Unidades de Cadastro</h3>
              <div id="listaUnidadesCadastro" class="space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-violet-400">Filtro / Mês</h3>
              <canvas id="chartCadastranteMes"></canvas>
            </div>
            <div class="col-span-12 lg:col-span-6 glass rounded-2xl p-5 text-center" style="background: linear-gradient(135deg, rgba(34,211,238,0.15), rgba(167,139,250,0.15));">
              <div class="text-sm text-slate-400 mb-2">Manifestações</div>
              <div id="totalCadastrante" class="text-6xl font-extrabold text-cyan-300 mb-2">—</div>
              <div class="text-xs text-slate-400">TOTAL CADASTRADAS ATÉ O MOMENTO</div>
            </div>
          </div>
        </section>
        <!-- Página Reclamações e Denúncias -->
        <section id="page-reclamacoes" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos (Reclamações e Denúncias)</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-rose-400">Assuntos</h3>
              <div id="listaReclamacoes" class="space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-rose-400">Record Count por Tipo de Ação</h3>
              <canvas id="chartReclamacoesTipo"></canvas>
            </div>
          </div>
        </section>
        <!-- Páginas de Unidades -->
        <section id="page-unit-adao" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos ADÃO</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-cer-iv" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos CER IV</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-olho" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital do Olho</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-duque" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital Duque</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-infantil" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital Infantil</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-moacyr" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital Moacyr</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-maternidade-santa-cruz" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Maternidade Santa Cruz</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-upa-beira-mar" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPA Beira Mar</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-pilar" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Pilar</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-saracuruna" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Saracuruna</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-xerem" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Xerém</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-hospital-veterinario" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos Hospital Veterinário</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-upa-walter-garcia" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPA Walter Garcia</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-campos-eliseos" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Campos Elíseos</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-parque-equitativa" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Parque Equitativa</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-ubs-antonio-granja" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UBS Antonio Granja</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-upa-sarapui" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPA Sarapuí</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
        <section id="page-unit-uph-imbarie" class="unit-page" style="display:none">
          <header class="glass rounded-2xl p-6 mb-6"><h2 class="neon text-xl font-bold">Total de Assuntos UPH Imbariê</h2></header>
          <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Assuntos</h3>
              <div class="unit-assuntos space-y-2 max-h-[600px] overflow-y-auto"></div>
            </div>
            <div class="col-span-12 lg:col-span-4 glass rounded-2xl p-5">
              <h3 class="font-semibold mb-4 text-cyan-400">Record Count por Tipo de Ação</h3>
              <canvas class="unit-tipos"></canvas>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2/dist/chartjs-plugin-datalabels.min.js"></script>
    <script>
      // Registrar plugin de datalabels
      if (typeof ChartDataLabels !== 'undefined') {
        Chart.register(ChartDataLabels);
      }
      
      // Função helper para criar tooltips melhorados
      function createEnhancedTooltip() {
        return {
          enabled: true,
          backgroundColor: 'rgba(15, 23, 42, 0.95)',
          titleColor: '#e2e8f0',
          bodyColor: '#cbd5e1',
          borderColor: 'rgba(34, 211, 238, 0.3)',
          borderWidth: 1,
          padding: 12,
          displayColors: true,
          callbacks: {
            title: function(context) {
              return context[0].label || '';
            },
            label: function(context) {
              const label = context.dataset.label || '';
              const value = context.parsed.y !== undefined ? context.parsed.y : context.parsed;
              const total = context.dataset.data.reduce((a, b) => a + (b || 0), 0);
              const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
              return `${label}: ${value.toLocaleString('pt-BR')} (${percentage}%)`;
            }
          }
        };
      }
      
      // Função helper para configurar datalabels
      function createDataLabelsConfig(showPercentage = false) {
        return {
          anchor: 'end',
          align: 'top',
          color: '#e2e8f0',
          font: {
            size: 11,
            weight: 'bold'
          },
          formatter: function(value, context) {
            if (showPercentage && context.dataset.data) {
              const total = context.dataset.data.reduce((a, b) => a + (b || 0), 0);
              const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
              return value.toLocaleString('pt-BR') + '\n(' + percentage + '%)';
            }
            return value.toLocaleString('pt-BR');
          },
          padding: 4,
          backgroundColor: 'rgba(15, 23, 42, 0.7)',
          borderRadius: 4
        };
      }
      
      // Função helper para adicionar eventos de clique
      function addChartClickHandler(chart, onClickCallback) {
        chart.canvas.style.cursor = 'pointer';
        chart.canvas.onclick = function(evt) {
          const points = chart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
          if (points.length) {
            const firstPoint = points[0];
            const label = chart.data.labels[firstPoint.index];
            const value = chart.data.datasets[firstPoint.datasetIndex].data[firstPoint.index];
            onClickCallback(label, value, firstPoint.index);
          }
        };
      }
      
      // Função para mostrar feedback visual ao clicar
      function showClickFeedback(element, label, value) {
        const feedback = document.createElement('div');
        feedback.className = 'fixed top-4 right-4 glass rounded-lg p-4 z-50 animate__animated animate__fadeInRight';
        feedback.innerHTML = `
          <div class="text-cyan-300 font-bold text-lg">${label}</div>
          <div class="text-slate-300 text-sm">Valor: ${value.toLocaleString('pt-BR')}</div>
        `;
        document.body.appendChild(feedback);
        setTimeout(() => {
          feedback.classList.add('animate__fadeOutRight');
          setTimeout(() => feedback.remove(), 300);
        }, 2000);
      }
      
      function gradient(ctx, from, to) {
        const g = ctx.createLinearGradient(0, 0, 0, 300);
        g.addColorStop(0, from);
        g.addColorStop(1, to);
        return g;
      }

      async function fetchJSON(url, opts) {
        const res = await fetch(url, opts);
        if (!res.ok) throw new Error('Request failed');
        return res.json();
      }

      function buildHeatmap(containerId, labels, rows) {
        const container = document.getElementById(containerId);
        if (!container) return;
        const max = Math.max(1, ...rows.flatMap(r => r.values));
        const toBg = (v) => {
          const alpha = v === 0 ? 0.05 : Math.min(0.9, 0.15 + 0.75 * (v / max));
          return `rgba(34,211,238,${alpha})`;
        };
        let html = '<div class="min-w-max"><table class="text-xs w-full">';
        html += '<thead><tr><th class="px-2 py-1 text-left text-slate-400">Chave</th>' + labels.map(l=>`<th class="px-2 py-1 text-slate-400">${l}</th>`).join('') + '</tr></thead>';
        html += '<tbody>' + rows.map(r=>{
          const cells = r.values.map(v=>`<td class="px-2 py-1" style="background:${toBg(v)}">${v}</td>`).join('');
          return `<tr><td class="px-2 py-1 text-slate-300">${r.key}</td>${cells}</tr>`;
        }).join('') + '</tbody></table></div>';
        container.innerHTML = html;
      }

      async function loadKpis(defaultCountField, defaultDateField) {
        const sum = await fetchJSON('/api/summary');
        document.getElementById('kpiTotal').textContent = (sum.total ?? 0).toLocaleString('pt-BR');
        document.getElementById('kpi7').textContent = (sum.last7 ?? 0).toLocaleString('pt-BR');
        document.getElementById('kpi30').textContent = (sum.last30 ?? 0).toLocaleString('pt-BR');
        if (sum.statusCounts && sum.statusCounts.length) {
          document.getElementById('kpiTopStatus').textContent = `${sum.statusCounts[0].status} (${sum.statusCounts[0].count})`;
          // Monta gráfico de status
          const ctx = document.getElementById('chartStatus').getContext('2d');
          if (window.chartStatus instanceof Chart) window.chartStatus.destroy();
          window.chartStatus = new Chart(ctx, { 
            type: 'doughnut', 
            data: {
              labels: sum.statusCounts.map(s=>s.status),
              datasets: [{ 
                data: sum.statusCounts.map(s=>s.count), 
                backgroundColor: ['#22d3ee','#a78bfa','#34d399','#f59e0b','#fb7185','#f472b6'] 
              }]
            }, 
            options: { 
              responsive: true,
              plugins: {
                tooltip: createEnhancedTooltip(),
                datalabels: {
                  ...createDataLabelsConfig(true),
                  anchor: 'center',
                  align: 'center'
                }
              },
              onClick: (evt, elements) => {
                if (elements.length > 0) {
                  const idx = elements[0].index;
                  const label = sum.statusCounts[idx].status;
                  const value = sum.statusCounts[idx].count;
                  showClickFeedback(null, label, value);
                }
              }
            } 
          });
          addChartClickHandler(window.chartStatus, (label, value) => showClickFeedback(null, label, value));
        }
        // Série temporal mensal 12M
        const byMonth = await fetchJSON('/api/aggregate/by-month');
        const ctxM = document.getElementById('chartMonth').getContext('2d');
        if (window.chartMonth instanceof Chart) window.chartMonth.destroy();
        window.chartMonth = new Chart(ctxM, { 
          type:'bar', 
          data:{ 
            labels: byMonth.map(x=>x.ym), 
            datasets:[{ 
              data: byMonth.map(x=>x.count), 
              backgroundColor: 'rgba(167,139,250,0.6)',
              borderColor: 'rgba(167,139,250,1)',
              borderWidth: 1
            }] 
          }, 
          options:{ 
            responsive:true,
            plugins: {
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig()
            },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          } 
        });
        addChartClickHandler(window.chartMonth, (label, value) => showClickFeedback(null, label, value));

        // SLA chart
        const sla = await fetchJSON('/api/sla/summary');
        const ctxS = document.getElementById('chartSla').getContext('2d');
        if (window.chartSla instanceof Chart) window.chartSla.destroy();
        window.chartSla = new Chart(ctxS, {
          type: 'bar',
          data: {
            labels: ['e-SIC Dentro', 'e-SIC Atraso', 'Outros Verde', 'Outros Amarelo', 'Outros Atraso'],
            datasets: [{
              data: [sla.esic?.dentro||0, sla.esic?.atraso||0, sla.outros?.verde||0, sla.outros?.amarelo||0, sla.outros?.atraso||0],
              backgroundColor: ['#34d399','#fb7185','#34d399','#fbbf24','#fb7185'],
              borderColor: ['#34d399','#fb7185','#34d399','#fbbf24','#fb7185'],
              borderWidth: 1
            }]
          },
          options: { 
            responsive: true, 
            plugins: { 
              legend: { display: false },
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig()
            },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        addChartClickHandler(window.chartSla, (label, value) => showClickFeedback(null, label, value));
      }

      async function loadTable() {
        const data = await fetchJSON('/api/records?page=1&pageSize=50');
        const rows = data.rows || [];
        const tbody = document.getElementById('tbody');
        const thead = document.getElementById('thead');
        tbody.innerHTML = '';
        thead.innerHTML = '';
        if (rows.length === 0) return;
        const first = rows[0].data || {};
        const keys = Object.keys(first);
        for (const k of keys) {
          const th = document.createElement('th'); th.textContent = k; th.className = 'px-3 py-2 text-left font-semibold text-slate-300'; thead.appendChild(th);
        }
        for (const r of rows) {
          const tr = document.createElement('tr'); tr.className = 'hover:bg-white/5 transition-colors';
          for (const k of keys) {
            const td = document.createElement('td'); td.textContent = r.data?.[k] ?? ''; td.className = 'px-3 py-2 text-slate-300'; tr.appendChild(td);
          }
          tbody.appendChild(tr);
        }
      }

      function exportCSV() {
        const rows = Array.from(document.querySelectorAll('#tbody tr')).map(tr => Array.from(tr.children).map(td => td.textContent));
        const headers = Array.from(document.querySelectorAll('#thead th')).map(th => th.textContent);
        const all = [headers, ...rows];
        const csv = all.map(r => r.map(v => '"' + String(v).replaceAll('"','""') + '"').join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'export.csv'; a.click(); URL.revokeObjectURL(url);
      }

      let chartCount, chartTime;

      async function loadCountChart(field) {
        try {
          console.log('Carregando gráfico de contagem para campo:', field);
          const data = await fetchJSON(`/api/aggregate/count-by?field=${encodeURIComponent(field)}`);
          console.log('Dados recebidos:', data.length, 'itens');
          const labels = data.slice(0, 20).map(x => x.key);
          const values = data.slice(0, 20).map(x => x.count);
          const ctx = document.getElementById('chartCount');
          if (!ctx) {
            console.error('Canvas chartCount não encontrado!');
            return;
          }
          const ctx2d = ctx.getContext('2d');
          if (chartCount) chartCount.destroy();
        chartCount = new Chart(ctx2d, {
          type: 'bar',
          data: { labels, datasets: [{
            label: `Contagem por ${field}`,
            data: values,
            borderRadius: 8,
            backgroundColor: gradient(ctx2d, 'rgba(34,211,238,0.8)', 'rgba(167,139,250,0.2)'),
            borderColor: 'rgba(34,211,238,1)',
            borderWidth: 1
          }]},
          options: {
            responsive: true,
            animation: { duration: 800, easing: 'easeOutQuart' },
            plugins: { 
              legend: { display: false },
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig()
            },
            scales: {
              x: { 
                grid: { color: 'rgba(255,255,255,0.06)' },
                ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 45 }
              },
              y: { 
                grid: { color: 'rgba(255,255,255,0.06)' },
                ticks: { color: '#94a3b8' },
                beginAtZero: true
              }
            }
          }
        });
        addChartClickHandler(chartCount, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('chartCount').classList.remove('skeleton');
        console.log('Gráfico de contagem criado com sucesso');
        } catch (error) {
          console.error('Erro em loadCountChart:', error);
          throw error;
        }
      }

      async function loadTimeChart(field) {
        try {
          console.log('Carregando gráfico de série temporal para campo:', field);
          const data = await fetchJSON(`/api/aggregate/time-series?field=${encodeURIComponent(field)}`);
          console.log('Dados recebidos:', data.length, 'itens');
          const labels = data.map(x => x.date);
          const values = data.map(x => x.count);
          const ctx = document.getElementById('chartTime');
          if (!ctx) {
            console.error('Canvas chartTime não encontrado!');
            return;
          }
          const ctx2d = ctx.getContext('2d');
          if (chartTime) chartTime.destroy();
        chartTime = new Chart(ctx2d, {
          type: 'line',
          data: { labels, datasets: [{
            label: `Registros por dia (${field})`,
            data: values,
            fill: true,
            borderWidth: 2,
            tension: 0.35,
            borderColor: 'rgba(52,211,153,1)',
            backgroundColor: gradient(ctx2d, 'rgba(52,211,153,0.35)', 'rgba(52,211,153,0.05)'),
            pointRadius: 4,
            pointHoverRadius: 6,
            pointBackgroundColor: 'rgba(52,211,153,1)',
            pointBorderColor: '#fff',
            pointBorderWidth: 2
          }]},
          options: {
            responsive: true,
            animation: { duration: 900, easing: 'easeOutCubic' },
            plugins: { 
              legend: { labels: { color: '#cbd5e1' } },
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(),
                display: function(context) {
                  // Mostrar apenas em alguns pontos para não poluir
                  return context.dataIndex % Math.ceil(context.dataset.data.length / 10) === 0;
                }
              }
            },
            scales: {
              x: { grid: { color: 'rgba(255,255,255,0.06)' }, ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 45 } },
              y: { grid: { color: 'rgba(255,255,255,0.06)' }, ticks: { color: '#94a3b8' }, beginAtZero: true }
            }
          }
        });
        addChartClickHandler(chartTime, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('chartTime').classList.remove('skeleton');
        console.log('Gráfico de série temporal criado com sucesso');
        } catch (error) {
          console.error('Erro em loadTimeChart:', error);
          throw error;
        }
      }


      // Heatmap main interactions
      document.getElementById('heatmapDim').addEventListener('change', async (e) => {
        const dim = e.target.value;
        const hm = await fetchJSON(`/api/aggregate/heatmap?dim=${encodeURIComponent(dim)}`);
        buildHeatmap('heatmap', hm.labels, hm.rows);
      });
      document.getElementById('btnExport').addEventListener('click', exportCSV);

      // initial load
      loadKpis('Categoria', 'Data');
      // carregar gráficos principais com defaults dos dropdowns
      loadCountChart('Categoria');
      loadTimeChart('Data');
      loadTable();
      fetchJSON('/api/aggregate/heatmap?dim=Categoria').then(hm => buildHeatmap('heatmap', hm.labels, hm.rows)).catch(()=>{});
      
      // Adicionar eventos aos dropdowns - usar onchange diretamente no HTML ou aguardar DOM
      (function setupDropdowns() {
        function attachCountByEvent() {
          const countBySelect = document.getElementById('countBy');
          if (countBySelect && !countBySelect.dataset.listenerAttached) {
            countBySelect.dataset.listenerAttached = 'true';
            countBySelect.addEventListener('change', async (e) => {
              const f = e.target.value.trim() || 'Categoria';
              console.log('🔄 Dropdown contagem mudou para:', f);
              if (f) {
                try {
                  await loadCountChart(f);
                  console.log('✅ Gráfico de contagem atualizado');
                } catch (error) {
                  console.error('❌ Erro ao atualizar gráfico de contagem:', error);
                }
              }
            });
            console.log('✅ Event listener adicionado ao dropdown de contagem');
          }
        }
        
        function attachDateFieldEvent() {
          const dateFieldSelect = document.getElementById('dateField');
          if (dateFieldSelect && !dateFieldSelect.dataset.listenerAttached) {
            dateFieldSelect.dataset.listenerAttached = 'true';
            dateFieldSelect.addEventListener('change', async (e) => {
              const f = e.target.value.trim() || 'Data';
              console.log('🔄 Dropdown série temporal mudou para:', f);
              if (f) {
                try {
                  await loadTimeChart(f);
                  console.log('✅ Gráfico de série temporal atualizado');
                } catch (error) {
                  console.error('❌ Erro ao atualizar gráfico de série temporal:', error);
                }
              }
            });
            console.log('✅ Event listener adicionado ao dropdown de série temporal');
          }
        }
        
        // Tentar adicionar eventos imediatamente
        attachCountByEvent();
        attachDateFieldEvent();
        
        // Se não encontrou, tentar novamente após um pequeno delay
        if (!document.getElementById('countBy') || !document.getElementById('dateField')) {
          setTimeout(() => {
            attachCountByEvent();
            attachDateFieldEvent();
          }, 200);
        }
      })();
    </script>
    <script>
      // SPA Page switch
      const sideMenu = document.getElementById('sideMenu');
      const pages = document.getElementById('pages').children;
      sideMenu.querySelectorAll('div[data-page]').forEach(btn => {
        btn.onclick = () => {
          sideMenu.querySelectorAll('div[data-page]').forEach(b=>b.classList.remove('active','bg-white/10'));
          btn.classList.add('active','bg-white/10');
          Array.from(pages).forEach(page => page.style.display = 'none');
          document.getElementById('page-'+btn.getAttribute('data-page')).style.display='block';
          // Carrega conteúdo específico
          loadSection(btn.getAttribute('data-page'));
        };
      });
      function loadSection(page) {
        if(page==='orgao-mes') loadOrgaoMes();
        if(page==='tempo-medio') loadTempoMedio();
        if(page==='tema') loadTema();
        if(page==='assunto') loadAssunto();
        if(page==='cadastrante') loadCadastrante();
        if(page==='reclamacoes') loadReclamacoes();
        if(page==='secretaria') loadSecretaria();
        if(page && page.startsWith('unit-')) {
          const unitName = page.replace('unit-', '').replace(/-/g, ' ');
          loadUnit(unitName);
        }
        if(page==='tipo') loadTipo();
        if(page==='setor') loadSetor();
        if(page==='categoria') loadCategoria();
        if(page==='status') loadStatusPage();
        if(page==='bairro') loadBairro();
        if(page==='uac') loadUAC();
        if(page==='responsavel') loadResponsavel();
        if(page==='canal') loadCanal();
        if(page==='prioridade') loadPrioridade();
      }
      // Funções para carregar cada seção temática
      enableCharts(); // chamada para garantir que gráficos não quebrem
      
      async function loadOrgaoMes() {
        // Carregar dados de secretarias/órgãos
        const dataOrgaos = await fetchJSON('/api/aggregate/count-by?field=Secretaria');
        const totalOrgaos = dataOrgaos.length;
        document.getElementById('totalOrgaos').textContent = totalOrgaos;
        
        // Criar lista visual de órgãos (estilo Looker Studio)
        const listaOrgaos = document.getElementById('listaOrgaos');
        const maxValue = Math.max(...dataOrgaos.map(d => d.count), 1);
        listaOrgaos.innerHTML = dataOrgaos.map(item => {
          const width = (item.count / maxValue) * 100;
          return `
            <div class="flex items-center gap-3 py-2 border-b border-white/5">
              <div class="flex-1 min-w-0">
                <div class="text-sm text-slate-300 truncate">${item.key}</div>
                <div class="mt-1 h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-cyan-500 to-violet-500" style="width: ${width}%"></div>
                </div>
              </div>
              <div class="text-lg font-bold text-cyan-300 min-w-[60px] text-right">${item.count.toLocaleString('pt-BR')}</div>
            </div>
          `;
        }).join('');
        
        // Carregar dados mensais
        const dataMensal = await fetchJSON('/api/aggregate/by-month');
        const labels = dataMensal.map(x => {
          const [year, month] = x.ym.split('-');
          const monthNames = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
          return `${monthNames[parseInt(month) - 1]}. de ${year}`;
        });
        const values = dataMensal.map(x => x.count);
        
        // Criar gráfico de barras mensal
        if (window.chartOrgaoMes instanceof Chart) window.chartOrgaoMes.destroy();
        const ctx = document.getElementById('chartOrgaoMes').getContext('2d');
        window.chartOrgaoMes = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Manifestações',
              data: values,
              backgroundColor: 'rgba(167,139,250,0.7)',
              borderColor: 'rgba(167,139,250,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            indexAxis: 'y',
            plugins: {
              legend: { display: false },
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(),
                anchor: 'start',
                align: 'end'
              }
            },
            scales: {
              x: {
                beginAtZero: true,
                ticks: { color: '#94a3b8' },
                grid: { color: 'rgba(255,255,255,0.05)' }
              },
              y: {
                ticks: { color: '#94a3b8' },
                grid: { color: 'rgba(255,255,255,0.05)' }
              }
            }
          }
        });
        addChartClickHandler(window.chartOrgaoMes, (label, value) => showClickFeedback(null, label, value));
        
        // Atualizar KPI total
        const total = dataOrgaos.reduce((sum, item) => sum + item.count, 0);
        document.getElementById('totalOrgaoMes').textContent = total.toLocaleString('pt-BR');
      }
      
      async function loadSecretaria() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Secretaria');
        const labels = data.slice(0, 10).map(x=>x.key);
        const values = data.slice(0, 10).map(x=>x.count);
        if (window.chartSecretaria instanceof Chart) window.chartSecretaria.destroy();
        const ctx = document.getElementById('chartSecretaria').getContext('2d');
        window.chartSecretaria = new Chart(ctx, {
          type:'bar', 
          data:{labels,datasets:[{label:'Secretaria',data:values,backgroundColor:'#22d3ee',borderColor:'#22d3ee',borderWidth:1}]},
          options: {
            responsive:true, 
            animation:{duration:1000}, 
            plugins:{
              legend:{display:false},
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig()
            },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        addChartClickHandler(window.chartSecretaria, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('rankSecretaria').innerHTML=data.slice(0,10).map(e=>`<li><span class='text-cyan-300 font-mono'>${e.key}</span> <span class='float-right font-bold'>${e.count}</span></li>`).join('');
      }
      async function loadTipo() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Tipo');
        const labels = data.slice(0, 10).map(x=>x.key);
        const values = data.slice(0, 10).map(x=>x.count);
        if(window.chartTipo instanceof Chart) window.chartTipo.destroy();
        const ctx = document.getElementById('chartTipo').getContext('2d');
        window.chartTipo = new Chart(ctx, {
          type:'pie', 
          data:{labels,datasets:[{label:'Tipo Manifestação',data:values,backgroundColor:['#c084fc','#22d3ee','#facc15','#fb7185']}]}, 
          options:{
            responsive:true,
            animation:{duration:1000},
            plugins: {
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(true),
                anchor: 'center',
                align: 'center'
              }
            }
          } 
        });
        addChartClickHandler(window.chartTipo, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('rankTipo').innerHTML=data.slice(0,10).map(e=>`<li><span class='text-violet-300 font-mono'>${e.key}</span> <span class='float-right font-bold'>${e.count}</span></li>`).join('');
      }
      async function loadSetor() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Setor');
        const labels = data.slice(0, 10).map(x=>x.key);
        const values = data.slice(0, 10).map(x=>x.count);
        if(window.chartSetor instanceof Chart) window.chartSetor.destroy();
        const ctx = document.getElementById('chartSetor').getContext('2d');
        window.chartSetor = new Chart(ctx, {
          type:'bar', 
          data:{labels,datasets:[{label:'Setor',data:values,backgroundColor:'#34d399',borderColor:'#34d399',borderWidth:1}]}, 
          options:{
            responsive:true,
            animation:{duration:1000}, 
            indexAxis:'y', 
            plugins:{
              legend:{display:false},
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(),
                anchor: 'start',
                align: 'end'
              }
            },
            scales: {
              x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        addChartClickHandler(window.chartSetor, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('rankSetor').innerHTML=data.slice(0,10).map(e=>`<li><span class='text-emerald-300 font-mono'>${e.key}</span> <span class='float-right font-bold'>${e.count}</span></li>`).join('');
      }
      function enableCharts() {
        // dummy para garantir que não quebre ao carregar direto
      }

      async function loadCategoria() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Categoria');
        const labels = data.slice(0, 15).map(x=>x.key);
        const values = data.slice(0, 15).map(x=>x.count);
        if (window.chartCategoria instanceof Chart) window.chartCategoria.destroy();
        const ctx = document.getElementById('chartCategoria').getContext('2d');
        window.chartCategoria = new Chart(ctx, { 
          type:'bar', 
          data:{ labels, datasets:[{ label:'Categoria', data: values, backgroundColor:'#f472b6', borderColor:'#f472b6', borderWidth:1 }] }, 
          options:{ 
            responsive:true, 
            plugins:{ 
              legend:{ display:false },
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig()
            },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          } 
        });
        addChartClickHandler(window.chartCategoria, (label, value) => showClickFeedback(null, label, value));
        const hm = await fetchJSON('/api/aggregate/heatmap?dim=Categoria');
        buildHeatmap('heatmapCategoria', hm.labels, hm.rows);
      }

      async function loadStatusPage() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Status');
        const labels = data.slice(0, 10).map(x=>x.key);
        const values = data.slice(0, 10).map(x=>x.count);
        if (window.chartStatusPage instanceof Chart) window.chartStatusPage.destroy();
        const ctx = document.getElementById('chartStatusPage').getContext('2d');
        window.chartStatusPage = new Chart(ctx, { 
          type:'doughnut', 
          data:{ labels, datasets:[{ data: values, backgroundColor:['#38bdf8','#22d3ee','#fbbf24','#34d399','#fb7185','#e879f9'] }] }, 
          options:{ 
            responsive:true,
            plugins: {
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(true),
                anchor: 'center',
                align: 'center'
              }
            }
          } 
        });
        addChartClickHandler(window.chartStatusPage, (label, value) => showClickFeedback(null, label, value));
        const hm = await fetchJSON('/api/aggregate/heatmap?dim=Status');
        buildHeatmap('heatmapStatus', hm.labels, hm.rows);
      }

      async function loadBairro() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Bairro');
        const labels = data.slice(0, 15).map(x=>x.key);
        const values = data.slice(0, 15).map(x=>x.count);
        if (window.chartBairro instanceof Chart) window.chartBairro.destroy();
        const ctx = document.getElementById('chartBairro').getContext('2d');
        window.chartBairro = new Chart(ctx, { 
          type:'bar', 
          data:{ labels, datasets:[{ label:'Bairro', data: values, backgroundColor:'#f59e0b', borderColor:'#f59e0b', borderWidth:1 }] }, 
          options:{ 
            responsive:true, 
            plugins:{ 
              legend:{ display:false },
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(),
                anchor: 'start',
                align: 'end'
              }
            }, 
            indexAxis:'y',
            scales: {
              x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          } 
        });
        addChartClickHandler(window.chartBairro, (label, value) => showClickFeedback(null, label, value));
        const hm = await fetchJSON('/api/aggregate/heatmap?dim=Bairro');
        buildHeatmap('heatmapBairro', hm.labels, hm.rows);
      }

      async function loadUAC() {
        const data = await fetchJSON('/api/aggregate/count-by?field=UAC');
        const labels = data.slice(0, 15).map(x=>x.key);
        const values = data.slice(0, 15).map(x=>x.count);
        if (window.chartUAC instanceof Chart) window.chartUAC.destroy();
        const ctx = document.getElementById('chartUAC').getContext('2d');
        window.chartUAC = new Chart(ctx, { 
          type:'bar', 
          data:{ labels, datasets:[{ label:'UAC', data: values, backgroundColor:'#22d3ee', borderColor:'#22d3ee', borderWidth:1 }] }, 
          options:{ 
            responsive:true, 
            animation:{duration:1000}, 
            indexAxis:'y', 
            plugins:{
              legend:{display:false},
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(),
                anchor: 'start',
                align: 'end'
              }
            },
            scales: {
              x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          } 
        });
        addChartClickHandler(window.chartUAC, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('rankUAC').innerHTML=data.slice(0,10).map(e=>`<li><span class='text-cyan-300 font-mono'>${e.key}</span> <span class='float-right font-bold'>${e.count.toLocaleString('pt-BR')}</span></li>`).join('');
        const hm = await fetchJSON('/api/aggregate/heatmap?dim=UAC');
        buildHeatmap('heatmapUAC', hm.labels, hm.rows);
      }

      async function loadResponsavel() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Responsavel');
        const labels = data.slice(0, 15).map(x=>x.key);
        const values = data.slice(0, 15).map(x=>x.count);
        if (window.chartResponsavel instanceof Chart) window.chartResponsavel.destroy();
        const ctx = document.getElementById('chartResponsavel').getContext('2d');
        window.chartResponsavel = new Chart(ctx, { 
          type:'bar', 
          data:{ labels, datasets:[{ label:'Responsável', data: values, backgroundColor:'#a78bfa', borderColor:'#a78bfa', borderWidth:1 }] }, 
          options:{ 
            responsive:true, 
            animation:{duration:1000}, 
            indexAxis:'y', 
            plugins:{
              legend:{display:false},
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(),
                anchor: 'start',
                align: 'end'
              }
            },
            scales: {
              x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          } 
        });
        addChartClickHandler(window.chartResponsavel, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('rankResponsavel').innerHTML=data.slice(0,10).map(e=>`<li><span class='text-violet-300 font-mono'>${e.key}</span> <span class='float-right font-bold'>${e.count.toLocaleString('pt-BR')}</span></li>`).join('');
        const hm = await fetchJSON('/api/aggregate/heatmap?dim=Responsavel');
        buildHeatmap('heatmapResponsavel', hm.labels, hm.rows);
      }

      async function loadCanal() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Canal');
        const labels = data.map(x=>x.key);
        const values = data.map(x=>x.count);
        if (window.chartCanal instanceof Chart) window.chartCanal.destroy();
        const ctx = document.getElementById('chartCanal').getContext('2d');
        window.chartCanal = new Chart(ctx, { 
          type:'doughnut', 
          data:{ labels, datasets:[{ data: values, backgroundColor:['#34d399','#22d3ee','#fbbf24','#a78bfa','#fb7185','#e879f9'] }] }, 
          options:{ 
            responsive:true, 
            plugins:{
              legend:{display:true, position:'right'},
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(true),
                anchor: 'center',
                align: 'center'
              }
            }
          } 
        });
        addChartClickHandler(window.chartCanal, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('rankCanal').innerHTML=data.slice(0,10).map(e=>`<li><span class='text-emerald-300 font-mono'>${e.key}</span> <span class='float-right font-bold'>${e.count.toLocaleString('pt-BR')}</span></li>`).join('');
        const hm = await fetchJSON('/api/aggregate/heatmap?dim=Canal');
        buildHeatmap('heatmapCanal', hm.labels, hm.rows);
      }

      async function loadPrioridade() {
        const data = await fetchJSON('/api/aggregate/count-by?field=Prioridade');
        const labels = data.map(x=>x.key);
        const values = data.map(x=>x.count);
        if (window.chartPrioridade instanceof Chart) window.chartPrioridade.destroy();
        const ctx = document.getElementById('chartPrioridade').getContext('2d');
        // Cores específicas por prioridade: Alta=vermelho, Média=amarelo, Baixa=verde
        const colors = labels.map(l => {
          const low = l.toLowerCase();
          if(low.includes('alta')) return '#fb7185';
          if(low.includes('média') || low.includes('media')) return '#fbbf24';
          if(low.includes('baixa')) return '#34d399';
          return '#94a3b8';
        });
        window.chartPrioridade = new Chart(ctx, { 
          type:'bar', 
          data:{ labels, datasets:[{ label:'Prioridade', data: values, backgroundColor: colors, borderColor: colors, borderWidth: 1 }] }, 
          options:{ 
            responsive:true, 
            plugins:{
              legend:{display:false},
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig()
            },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          } 
        });
        addChartClickHandler(window.chartPrioridade, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('rankPrioridade').innerHTML=data.map(e=>`<li><span class='text-rose-300 font-mono'>${e.key}</span> <span class='float-right font-bold'>${e.count.toLocaleString('pt-BR')}</span></li>`).join('');
        const hm = await fetchJSON('/api/aggregate/heatmap?dim=Prioridade');
        buildHeatmap('heatmapPrioridade', hm.labels, hm.rows);
      }

      async function loadTempoMedio() {
        const data = await fetchJSON('/api/stats/average-time');
        const labels = data.map(x => x.org);
        const values = data.map(x => x.dias);
        
        // Gráfico de barras horizontais
        if (window.chartTempoMedio instanceof Chart) window.chartTempoMedio.destroy();
        const ctx = document.getElementById('chartTempoMedio').getContext('2d');
        window.chartTempoMedio = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Dias',
              data: values,
              backgroundColor: 'rgba(34,211,238,0.7)',
              borderColor: 'rgba(34,211,238,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            indexAxis: 'y',
            plugins: { 
              legend: { display: false },
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(),
                anchor: 'start',
                align: 'end'
              }
            },
            scales: {
              x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        addChartClickHandler(window.chartTempoMedio, (label, value) => showClickFeedback(null, label, value));
        
        // Lista de ranking
        document.getElementById('listaTempoMedio').innerHTML = data.map((item, idx) => `
          <div class="flex items-center gap-3 py-2 border-b border-white/5">
            <div class="text-sm text-slate-400 w-8">${idx + 1}º</div>
            <div class="flex-1 text-sm text-slate-300 truncate">${item.org}</div>
            <div class="text-lg font-bold text-cyan-300 min-w-[60px] text-right">${item.dias.toFixed(2)}</div>
          </div>
        `).join('');
        
        // Gráfico mensal
        const dataMensal = await fetchJSON('/api/aggregate/by-month');
        const labelsMes = dataMensal.map(x => {
          const [year, month] = x.ym.split('-');
          const monthNames = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
          return `${monthNames[parseInt(month) - 1]}. de ${year}`;
        });
        const valuesMes = dataMensal.map(x => x.count);
        
        if (window.chartTempoMedioMes instanceof Chart) window.chartTempoMedioMes.destroy();
        const ctxMes = document.getElementById('chartTempoMedioMes').getContext('2d');
        window.chartTempoMedioMes = new Chart(ctxMes, {
          type: 'bar',
          data: {
            labels: labelsMes,
            datasets: [{
              label: 'Quantidade',
              data: valuesMes,
              backgroundColor: 'rgba(167,139,250,0.7)',
              borderColor: 'rgba(167,139,250,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: { 
              legend: { display: false },
              tooltip: createEnhancedTooltip(),
              datalabels: createDataLabelsConfig()
            },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        addChartClickHandler(window.chartTempoMedioMes, (label, value) => showClickFeedback(null, label, value));
      }

      async function loadTema() {
        const data = await fetchJSON('/api/aggregate/by-theme');
        const labels = data.slice(0, 20).map(x => x.tema);
        const values = data.slice(0, 20).map(x => x.quantidade);
        
        // Gráfico de temas
        if (window.chartTema instanceof Chart) window.chartTema.destroy();
        const ctx = document.getElementById('chartTema').getContext('2d');
        window.chartTema = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Quantidade',
              data: values,
              backgroundColor: 'rgba(167,139,250,0.7)',
              borderColor: 'rgba(167,139,250,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            indexAxis: 'y',
            plugins: { 
              legend: { display: false },
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(),
                anchor: 'start',
                align: 'end'
              }
            },
            scales: {
              x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        addChartClickHandler(window.chartTema, (label, value) => showClickFeedback(null, label, value));
        
        // Status geral
        const status = await fetchJSON('/api/stats/status-overview');
        if (window.chartStatusTema instanceof Chart) window.chartStatusTema.destroy();
        const ctxStatus = document.getElementById('chartStatusTema').getContext('2d');
        window.chartStatusTema = new Chart(ctxStatus, {
          type: 'doughnut',
          data: {
            labels: ['Concluída', 'Em atendimento'],
            datasets: [{
              data: [status.concluida.percentual, status.emAtendimento.percentual],
              backgroundColor: ['#38bdf8', '#fbbf24']
            }]
          },
          options: { 
            responsive: true,
            plugins: {
              tooltip: createEnhancedTooltip(),
              datalabels: {
                ...createDataLabelsConfig(true),
                anchor: 'center',
                align: 'center'
              }
            }
          }
        });
        addChartClickHandler(window.chartStatusTema, (label, value) => showClickFeedback(null, label, value));
        document.getElementById('statusTemaInfo').innerHTML = `
          <div class="text-cyan-300">Concluída: ${status.concluida.percentual}%</div>
          <div class="text-amber-300">Em atendimento: ${status.emAtendimento.percentual}%</div>
        `;
        
        // Gráfico mensal
        const dataMensal = await fetchJSON('/api/aggregate/by-month');
        const labelsMes = dataMensal.map(x => {
          const [year, month] = x.ym.split('-');
          const monthNames = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
          return `${monthNames[parseInt(month) - 1]}. de ${year}`;
        });
        const valuesMes = dataMensal.map(x => x.count);
        
        if (window.chartTemaMes instanceof Chart) window.chartTemaMes.destroy();
        const ctxMes = document.getElementById('chartTemaMes').getContext('2d');
        window.chartTemaMes = new Chart(ctxMes, {
          type: 'bar',
          data: {
            labels: labelsMes,
            datasets: [{
              label: 'Quantidade',
              data: valuesMes,
              backgroundColor: 'rgba(167,139,250,0.7)',
              borderColor: 'rgba(167,139,250,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
      }

      async function loadAssunto() {
        const data = await fetchJSON('/api/aggregate/by-subject');
        const labels = data.slice(0, 20).map(x => x.assunto);
        const values = data.slice(0, 20).map(x => x.quantidade);
        
        // Gráfico de assuntos
        if (window.chartAssunto instanceof Chart) window.chartAssunto.destroy();
        const ctx = document.getElementById('chartAssunto').getContext('2d');
        window.chartAssunto = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Quantidade',
              data: values,
              backgroundColor: 'rgba(34,211,238,0.7)',
              borderColor: 'rgba(34,211,238,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: {
              x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        
        // Status geral
        const status = await fetchJSON('/api/stats/status-overview');
        if (window.chartStatusAssunto instanceof Chart) window.chartStatusAssunto.destroy();
        const ctxStatus = document.getElementById('chartStatusAssunto').getContext('2d');
        window.chartStatusAssunto = new Chart(ctxStatus, {
          type: 'doughnut',
          data: {
            labels: ['Concluída', 'Em atendimento'],
            datasets: [{
              data: [status.concluida.percentual, status.emAtendimento.percentual],
              backgroundColor: ['#38bdf8', '#fbbf24']
            }]
          },
          options: { responsive: true }
        });
        document.getElementById('statusAssuntoInfo').innerHTML = `
          <div class="text-cyan-300">Concluída: ${status.concluida.percentual}%</div>
          <div class="text-amber-300">Em atendimento: ${status.emAtendimento.percentual}%</div>
        `;
        
        // Lista completa de assuntos
        document.getElementById('listaAssuntos').innerHTML = data.map((item, idx) => {
          const width = (item.quantidade / Math.max(...data.map(d => d.quantidade), 1)) * 100;
          return `
            <div class="flex items-center gap-3 py-2 border-b border-white/5">
              <div class="text-sm text-slate-400 w-8">${idx + 1}º</div>
              <div class="flex-1 min-w-0">
                <div class="text-sm text-slate-300 truncate">${item.assunto}</div>
                <div class="mt-1 h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-cyan-500 to-violet-500" style="width: ${width}%"></div>
                </div>
              </div>
              <div class="text-lg font-bold text-cyan-300 min-w-[80px] text-right">${item.quantidade.toLocaleString('pt-BR')}</div>
            </div>
          `;
        }).join('');
      }

      async function loadCadastrante() {
        // Servidores
        const servidores = await fetchJSON('/api/aggregate/by-server');
        document.getElementById('listaServidores').innerHTML = servidores.map((item, idx) => {
          const width = (item.quantidade / Math.max(...servidores.map(d => d.quantidade), 1)) * 100;
          return `
            <div class="flex items-center gap-3 py-2 border-b border-white/5">
              <div class="text-sm text-slate-400 w-8">${idx + 1}º</div>
              <div class="flex-1 min-w-0">
                <div class="text-sm text-slate-300 truncate">${item.servidor}</div>
                <div class="mt-1 h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-cyan-500 to-violet-500" style="width: ${width}%"></div>
                </div>
              </div>
              <div class="text-lg font-bold text-cyan-300 min-w-[80px] text-right">${item.quantidade.toLocaleString('pt-BR')}</div>
            </div>
          `;
        }).join('');
        
        // Unidades de Cadastro (UAC)
        const uacs = await fetchJSON('/api/aggregate/count-by?field=UAC');
        document.getElementById('listaUnidadesCadastro').innerHTML = uacs.map((item, idx) => {
          const width = (item.count / Math.max(...uacs.map(d => d.count), 1)) * 100;
          return `
            <div class="flex items-center gap-3 py-2 border-b border-white/5">
              <div class="text-sm text-slate-400 w-8">${idx + 1}º</div>
              <div class="flex-1 min-w-0">
                <div class="text-sm text-slate-300 truncate">${item.key}</div>
                <div class="mt-1 h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-violet-500 to-cyan-500" style="width: ${width}%"></div>
                </div>
              </div>
              <div class="text-lg font-bold text-violet-300 min-w-[80px] text-right">${item.count.toLocaleString('pt-BR')}</div>
            </div>
          `;
        }).join('');
        
        // Gráfico mensal
        const dataMensal = await fetchJSON('/api/aggregate/by-month');
        const labelsMes = dataMensal.map(x => {
          const [year, month] = x.ym.split('-');
          const monthNames = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
          return `${monthNames[parseInt(month) - 1]}. de ${year}`;
        });
        const valuesMes = dataMensal.map(x => x.count);
        
        if (window.chartCadastranteMes instanceof Chart) window.chartCadastranteMes.destroy();
        const ctxMes = document.getElementById('chartCadastranteMes').getContext('2d');
        window.chartCadastranteMes = new Chart(ctxMes, {
          type: 'bar',
          data: {
            labels: labelsMes,
            datasets: [{
              label: 'Quantidade',
              data: valuesMes,
              backgroundColor: 'rgba(167,139,250,0.7)',
              borderColor: 'rgba(167,139,250,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
        
        // Total
        const summary = await fetchJSON('/api/summary');
        document.getElementById('totalCadastrante').textContent = (summary.total || 0).toLocaleString('pt-BR');
      }

      async function loadReclamacoes() {
        const data = await fetchJSON('/api/complaints-denunciations');
        const assuntos = data.assuntos || [];
        const tipos = data.tipos || [];
        
        // Lista de assuntos
        document.getElementById('listaReclamacoes').innerHTML = assuntos.map((item, idx) => {
          const width = assuntos.length > 0 ? (item.quantidade / Math.max(...assuntos.map(d => d.quantidade), 1)) * 100 : 0;
          return `
            <div class="flex items-center gap-3 py-2 border-b border-white/5">
              <div class="text-sm text-slate-400 w-8">${idx + 1}º</div>
              <div class="flex-1 min-w-0">
                <div class="text-sm text-slate-300 truncate">${item.assunto}</div>
                <div class="mt-1 h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-rose-500 to-pink-500" style="width: ${width}%"></div>
                </div>
              </div>
              <div class="text-lg font-bold text-rose-300 min-w-[80px] text-right">${item.quantidade.toLocaleString('pt-BR')}</div>
            </div>
          `;
        }).join('');
        
        // Gráfico de tipos de ação
        const labels = tipos.map(t => t.tipo);
        const values = tipos.map(t => t.quantidade);
        
        if (window.chartReclamacoesTipo instanceof Chart) window.chartReclamacoesTipo.destroy();
        const ctx = document.getElementById('chartReclamacoesTipo').getContext('2d');
        window.chartReclamacoesTipo = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Quantidade',
              data: values,
              backgroundColor: 'rgba(239,68,68,0.7)',
              borderColor: 'rgba(239,68,68,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 45 }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
      }

      async function loadUnit(unitName) {
        // Mapear nomes das unidades para os nomes no banco
        const unitMap = {
          'adao': 'ADÃO',
          'cer iv': 'CER IV',
          'hospital olho': 'Hospital do Olho',
          'hospital duque': 'Hospital Duque',
          'hospital infantil': 'Hospital Infantil',
          'hospital moacyr': 'Hospital Moacyr',
          'maternidade santa cruz': 'Maternidade Santa Cruz',
          'upa beira mar': 'UPA Beira Mar',
          'uph pilar': 'UPH Pilar',
          'uph saracuruna': 'UPH Saracuruna',
          'uph xerem': 'UPH Xerém',
          'hospital veterinario': 'Hospital Veterinário',
          'upa walter garcia': 'UPA Walter Garcia',
          'uph campos eliseos': 'UPH Campos Elíseos',
          'uph parque equitativa': 'UPH Parque Equitativa',
          'ubs antonio granja': 'UBS Antonio Granja',
          'upa sarapui': 'UPA Sarapuí',
          'uph imbarie': 'UPH Imbariê'
        };
        
        const searchName = unitMap[unitName.toLowerCase()] || unitName;
        const data = await fetchJSON(`/api/unit/${encodeURIComponent(searchName)}`);
        
        // Encontrar a seção da unidade
        const pageId = `page-unit-${unitName.replace(/\s+/g, '-').toLowerCase()}`;
        const section = document.getElementById(pageId);
        if (!section) return;
        
        const assuntosContainer = section.querySelector('.unit-assuntos');
        const tiposCanvas = section.querySelector('.unit-tipos');
        
        // Lista de assuntos
        const assuntos = data.assuntos || [];
        assuntosContainer.innerHTML = assuntos.map((item, idx) => {
          const width = assuntos.length > 0 ? (item.quantidade / Math.max(...assuntos.map(d => d.quantidade), 1)) * 100 : 0;
          return `
            <div class="flex items-center gap-3 py-2 border-b border-white/5">
              <div class="text-sm text-slate-400 w-8">${idx + 1}º</div>
              <div class="flex-1 min-w-0">
                <div class="text-sm text-slate-300 truncate">${item.assunto}</div>
                <div class="mt-1 h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-cyan-500 to-violet-500" style="width: ${width}%"></div>
                </div>
              </div>
              <div class="text-lg font-bold text-cyan-300 min-w-[80px] text-right">${item.quantidade.toLocaleString('pt-BR')}</div>
            </div>
          `;
        }).join('');
        
        // Gráfico de tipos de ação
        const tipos = data.tipos || [];
        const labels = tipos.map(t => t.tipo);
        const values = tipos.map(t => t.quantidade);
        
        // Destruir gráfico anterior se existir
        const chartId = `chartUnit${unitName.replace(/\s+/g, '')}`;
        if (window[chartId] instanceof Chart) window[chartId].destroy();
        
        const ctx = tiposCanvas.getContext('2d');
        window[chartId] = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Quantidade',
              data: values,
              backgroundColor: 'rgba(34,211,238,0.7)',
              borderColor: 'rgba(34,211,238,1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
              x: { ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 45 }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
          }
        });
      }
    </script>
  </body>
  </html>


